<section class="sb-contact-form" data-sb-reveal>
  <div class="sb-contact-form__inner">
    {% assign contact_posted_in_query = request.query_string | default: '' | downcase | contains: 'contact_posted=true' %}
    {% form 'contact', class: 'sb-contact-form__form' %}
      <input type="hidden" name="return_to" value="{{ request.path | append: '?contact_posted=true' }}">

      {% if form.posted_successfully? or contact_posted_in_query %}
        <h3 class="sb-contact-form__success-title font-title weight-bold">
          Thank you for contacting us. We'll get back as soon as possible.
        </h3>
      {% elsif form.errors %}
        <p class="sb-contact-form__status font-caption weight-regular">{{ form.errors | default_errors }}</p>
      {% endif %}

      <div class="sb-contact-form__grid">
        {% for block in section.blocks %}
          {% assign field_id = 'ContactFormField-' | append: section.id | append: '-' | append: block.id %}

          {% case block.type %}
            {% when 'name_field' %}
              <div class="sb-contact-form__field" {{ block.shopify_attributes }}>
                <input
                  class="font-form-input weight-regular"
                  id="{{ field_id }}"
                  type="text"
                  name="contact[name]"
                  value="{{ form.name }}"
                  autocomplete="name"
                  placeholder="Full name"
                  required
                >
              </div>

            {% when 'email_field' %}
              <div class="sb-contact-form__field" {{ block.shopify_attributes }}>
                <input
                  class="font-form-input weight-regular"
                  id="{{ field_id }}"
                  type="email"
                  name="contact[email]"
                  value="{% if form.email %}{{ form.email }}{% elsif customer %}{{ customer.email }}{% endif %}"
                  autocomplete="email"
                  spellcheck="false"
                  autocapitalize="off"
                  placeholder="Email"
                  required
                >
              </div>

            {% when 'open_text_50' %}
              {% assign key = block.settings.label | handleize %}
              {% if key == blank %}{% assign key = block.id %}{% endif %}
              <div class="sb-contact-form__field" {{ block.shopify_attributes }}>
                <input
                  class="font-form-input weight-regular"
                  id="{{ field_id }}"
                  type="text"
                  name="contact[{{ key }}]"
                  value=""
                  placeholder="{{ block.settings.label }}"
                  {% if block.settings.required %}required{% endif %}
                >
              </div>

            {% when 'open_text_100' %}
              <div class="sb-contact-form__field sb-contact-form__field--full" {{ block.shopify_attributes }}>
                <textarea
                  class="font-form-input weight-regular"
                  id="{{ field_id }}"
                  name="contact[body]"
                  rows="6"
                  placeholder="{{ block.settings.label }}"
                  {% if block.settings.required %}required{% endif %}
                >{{ form.body }}</textarea>
              </div>
          {% endcase %}
        {% endfor %}
      </div>

      <div class="sb-contact-form__submit-row">
        {% render 'radiant-button',
          label: 'Send',
          size: 'large',
          icon_position: 'trailing',
          button_type: 'submit',
          extra_class: 'sb-contact-form__submit'
        %}
      </div>

      {% for block in section.blocks %}
        {% if block.type == 'subtitle' and block.settings.content != blank %}
          <div class="sb-contact-form__subtitle-block font-body weight-regular rte sb-flow-24" {{ block.shopify_attributes }}>
            {{ block.settings.content }}
          </div>
        {% endif %}
      {% endfor %}
    {% endform %}
  </div>
</section>

{% stylesheet %}
  .sb-contact-form__inner {
    width: 100%;
  }

  .sb-contact-form__form {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-20);
    width: 100%;
  }

  .sb-contact-form__status {
    color: var(--sb-color-neutral-900);
    margin: 0;
  }

  .sb-contact-form__success-title {
    color: var(--sb-color-neutral-900);
    margin: 0 0 var(--sb-space-48);
  }

  .sb-contact-form__subtitle-block {
    color: var(--sb-color-neutral-800);
    grid-column: 1 / -1;
    margin: 0;
  }

  .sb-contact-form__subtitle-block a,
  .sb-contact-form__subtitle-block a:visited {
    color: var(--sb-color-primary-500);
    text-decoration: none;
  }

  .sb-contact-form__subtitle-block a:hover,
  .sb-contact-form__subtitle-block a:focus-visible,
  .sb-contact-form__subtitle-block a:active {
    color: var(--sb-color-primary-500);
    text-decoration: underline;
  }

  .sb-contact-form__grid {
    display: flex;
    flex-wrap: wrap;
    gap: var(--sb-space-20);
  }

  .sb-contact-form__field {
    flex: 1 1 calc((100% - var(--sb-space-20)) / 2);
    min-width: 0;
  }

  .sb-contact-form__field--full {
    flex: 1 1 100%;
    position: relative;
  }

  .sb-contact-form input,
  .sb-contact-form textarea {
    background: var(--sb-color-always-white);
    border: 0;
    box-shadow: 0 0 10px 0 var(--sb-color-always-black-12);
    color: var(--sb-color-always-black);
    font-family: var(--sb-font-primary);
    font-size: var(--font-size-form-input);
    font-weight: 400;
    line-height: 1.4;
    width: 100%;
    -webkit-appearance: none;
    appearance: none;
  }

  .sb-contact-form input {
    border-radius: 999px;
    box-sizing: border-box;
    height: var(--sb-space-48);
    padding-inline: var(--sb-space-20);
  }

  .sb-contact-form textarea {
    border-radius: 24px;
    box-sizing: border-box;
    min-height: 160px;
    padding: var(--sb-space-20);
    padding-bottom: calc(var(--sb-space-20) + var(--sb-space-16) + var(--sb-space-8));
    padding-right: calc(var(--sb-space-20) + var(--sb-space-16) + var(--sb-space-8));
    resize: vertical;
  }

  .sb-contact-form textarea::-webkit-resizer {
    background: transparent;
  }

  .sb-contact-form__field--full::after {
    background:
      linear-gradient(135deg, transparent 28%, var(--sb-color-neutral-800) 28% 34%, transparent 34% 100%),
      linear-gradient(135deg, transparent 52%, var(--sb-color-neutral-800) 52% 58%, transparent 58% 100%);
    content: '';
    height: var(--sb-space-16);
    pointer-events: none;
    position: absolute;
    right: 8px;
    bottom: 12px;
    width: var(--sb-space-16);
  }

  .sb-contact-form input::placeholder,
  .sb-contact-form textarea::placeholder {
    color: var(--sb-color-neutral-800);
    opacity: 1;
  }

  .sb-contact-form input:focus,
  .sb-contact-form textarea:focus,
  .sb-contact-form input:focus-visible,
  .sb-contact-form textarea:focus-visible {
    outline: none;
    box-shadow: 0 0 10px 0 var(--sb-color-always-black-12);
  }

  .sb-contact-form__submit-row {
    margin: 0;
    width: 100%;
  }

  .sb-contact-form__submit-row .sb-button-radiant,
  .sb-contact-form__submit {
    display: flex !important;
    flex: 0 0 100% !important;
    width: 100% !important;
  }

  @media (max-width: 749px) {
    .sb-contact-form__field {
      flex-basis: 100%;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Contact form",
  "settings": [],
  "blocks": [
    {
      "type": "subtitle",
      "name": "Subtitle",
      "settings": [
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Subtitle</p>"
        }
      ]
    },
    {
      "type": "name_field",
      "name": "Full name"
    },
    {
      "type": "email_field",
      "name": "Email"
    },
    {
      "type": "open_text_50",
      "name": "Universal input small",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "University"
        },
        {
          "type": "checkbox",
          "id": "required",
          "label": "Required",
          "default": false
        }
      ]
    },
    {
      "type": "open_text_100",
      "name": "Universal input large",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Comment"
        },
        {
          "type": "checkbox",
          "id": "required",
          "label": "Required",
          "default": true
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Contact form",
      "blocks": [
        {
          "type": "name_field"
        },
        {
          "type": "email_field"
        },
        {
          "type": "open_text_100",
          "settings": {
            "label": "Comment",
            "required": true
          }
        }
      ]
    }
  ]
}
{% endschema %}
