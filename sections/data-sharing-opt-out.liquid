<section class="sb-data-sharing-opt-out" data-sb-reveal>
  <div class="sb-data-sharing-opt-out__title" data-sb-reveal-item>
    <h1 class="font-title weight-bold">{{ page.title }}</h1>
  </div>

  <div class="sb-data-sharing-opt-out__content rte font-body weight-regular sb-flow-24" data-sb-reveal-item>
    {{ page.content }}
  </div>

  {% unless page.content contains 'pc--optOutFormContainer' or page.content contains 'pc--opt-out-form-container' %}
    <div id="pc--optOutFormContainer" data-sb-reveal-item></div>
  {% endunless %}
</section>

{% stylesheet %}
  .sb-data-sharing-opt-out__title {
    color: var(--sb-color-neutral-900);
  }

  .sb-data-sharing-opt-out__title h1 {
    margin: 0;
  }

  .sb-data-sharing-opt-out__content {
    color: var(--sb-color-neutral-900);
    margin-top: var(--sb-space-24);
  }

  .sb-data-sharing-opt-out #pc--optOutFormContainer {
    margin-top: var(--sb-space-24);
  }

  .sb-data-sharing-opt-out #pc--opt-out-form-container {
    width: 100%;
  }

  .sb-data-sharing-opt-out #pc--opt-out-form,
  .sb-data-sharing-opt-out .pc--opt-out-form-container {
    align-items: flex-start;
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-20);
    text-align: left;
    width: 100%;
  }

  .sb-data-sharing-opt-out #optout,
  .sb-data-sharing-opt-out #pc--opt-out-not-applicable,
  .sb-data-sharing-opt-out .pc--opt-out-form-message {
    color: var(--sb-color-neutral-900);
    margin: 0;
  }

  .sb-data-sharing-opt-out .pc--show-email-field label {
    align-items: center;
    color: var(--sb-color-neutral-900);
    display: inline-flex;
    font-family: var(--font-primary--family);
    font-size: var(--font-size-body);
    font-weight: 400;
    gap: 10px;
  }

  .sb-data-sharing-opt-out .pc--show-email-field {
    margin-top: var(--sb-space-24);
    margin-bottom: 0;
  }

  .sb-data-sharing-opt-out #pc--show-email-field {
    accent-color: var(--sb-color-primary-500);
    block-size: var(--sb-space-20);
    inline-size: var(--sb-space-20);
    margin: 0;
  }

  .sb-data-sharing-opt-out #pc--opt-out-form-field-email label {
    display: none !important;
  }

  .sb-data-sharing-opt-out #pc--opt-out-email_input {
    background: var(--sb-color-always-white) !important;
    border: 0 !important;
    border-radius: 999px !important;
    box-shadow: 0 0 10px 0 var(--sb-color-always-black-12);
    box-sizing: border-box;
    color: var(--sb-color-always-black) !important;
    font-family: var(--font-primary--family) !important;
    font-size: var(--font-size-form-input) !important;
    font-weight: 400 !important;
    height: var(--sb-space-48);
    line-height: var(--sb-space-48);
    padding-inline: var(--sb-space-20);
    width: 100%;
    -webkit-appearance: none !important;
    appearance: none !important;
  }

  .sb-data-sharing-opt-out #pc--opt-out-email_input::placeholder {
    color: var(--sb-color-neutral-800);
    opacity: 1;
  }

  .sb-data-sharing-opt-out #pc--opt-out-email_input:focus,
  .sb-data-sharing-opt-out #pc--opt-out-email_input:focus-visible {
    outline: none !important;
    box-shadow: 0 0 10px 0 var(--sb-color-always-black-12) !important;
  }

  .sb-data-sharing-opt-out #pc--opt-out-button.sb-button-radiant {
    max-width: 400px !important;
    width: min(100%, 400px) !important;
  }

  @media (max-width: 989px) {
    .sb-data-sharing-opt-out #pc--opt-out-form,
    .sb-data-sharing-opt-out .pc--opt-out-form-container {
      align-items: flex-start;
      text-align: left;
    }

    .sb-data-sharing-opt-out #pc--opt-out-button.sb-button-radiant {
      align-self: flex-start !important;
      margin-left: 0 !important;
      margin-right: 0 !important;
    }
  }

  .sb-data-sharing-opt-out #pc--opt-out-button .sb-button-radiant__label {
    align-items: center;
    display: inline-flex;
    justify-content: center;
    letter-spacing: 0 !important;
    line-height: 1 !important;
    text-transform: none !important;
  }

  .sb-data-sharing-opt-out .pc--opt-out-form-message--success {
    align-items: center;
    color: var(--sb-color-primary-500) !important;
    display: inline-flex !important;
    font-family: var(--font-primary--family) !important;
    font-size: var(--font-size-body) !important;
    font-weight: 700 !important;
    gap: var(--sb-space-12);
    justify-content: flex-start;
    margin-top: 0 !important;
    text-align: left !important;
  }

  .sb-data-sharing-opt-out #pc--opt-out-success {
    display: none !important;
  }

  .sb-data-sharing-opt-out .pc--opt-out-form-message--success .icon-success {
    display: none !important;
    margin: 0 !important;
    width: 0 !important;
  }

  .sb-data-sharing-opt-out__success-icon {
    color: var(--sb-color-primary-500);
    display: inline-flex;
    flex: 0 0 auto;
    height: var(--sb-space-20);
    min-width: var(--sb-space-20);
    width: var(--sb-space-20);
  }

  .sb-data-sharing-opt-out__success-icon svg {
    display: block;
    height: 100%;
    width: 100%;
  }

  .sb-data-sharing-opt-out__success-icon svg path:not([fill='none']),
  .sb-data-sharing-opt-out__success-icon svg circle:not([fill='none']),
  .sb-data-sharing-opt-out__success-icon svg rect:not([fill='none']) {
    fill: currentColor;
  }
{% endstylesheet %}

<script>
  (() => {
    const root = document.querySelector('.sb-data-sharing-opt-out');
    if (!root) return;
    const arrowSvg = {{ 'arrow-reduced-padding.svg' | inline_asset_content | json }};
    const checkSvg = {{ 'icon-check.svg' | inline_asset_content | json }};

    const applyOptOutOverrides = () => {
      const button = root.querySelector('#pc--opt-out-button');
      const emailInput = root.querySelector('#pc--opt-out-email_input');
      const primarySuccessMessage = root.querySelector('#pc--opt-out-message.pc--opt-out-form-message--success');
      const secondarySuccessMessage = root.querySelector('#pc--opt-out-success.pc--opt-out-form-message--success');
      if (primarySuccessMessage && secondarySuccessMessage) {
        secondarySuccessMessage.style.display = 'none';
      }

      root.querySelectorAll('.sb-data-sharing-opt-out__success-icon').forEach((iconNode) => iconNode.remove());
      const activeSuccessMessage = [primarySuccessMessage, secondarySuccessMessage]
        .find((node) => node && window.getComputedStyle(node).display !== 'none');
      if (activeSuccessMessage) {
        activeSuccessMessage.querySelectorAll('.icon-success').forEach((node) => node.remove());
        const iconNode = document.createElement('span');
        iconNode.className = 'sb-data-sharing-opt-out__success-icon';
        iconNode.setAttribute('aria-hidden', 'true');
        iconNode.innerHTML = checkSvg;
        activeSuccessMessage.prepend(iconNode);
      }

      if (!button) return;

      button.classList.add('sb-button-radiant', 'sb-button-radiant--large', 'sb-button-radiant--trailing-icon');

      if (emailInput) {
        if (!emailInput.getAttribute('placeholder')) {
          emailInput.setAttribute('placeholder', 'Email');
        }
      }

      const hasLabel = button.querySelector('.sb-button-radiant__label');
      if (!hasLabel) {
        const buttonLabelText = (button.textContent || '').trim() || 'Opt out';
        button.textContent = '';

        const labelNode = document.createElement('span');
        labelNode.className = 'sb-button-radiant__label';
        labelNode.textContent = buttonLabelText;

        const iconNode = document.createElement('span');
        iconNode.className = 'sb-button-radiant__icon';
        iconNode.setAttribute('aria-hidden', 'true');
        iconNode.innerHTML = arrowSvg;

        button.append(labelNode, iconNode);
      }
    };

    const observer = new MutationObserver(applyOptOutOverrides);
    observer.observe(root, { childList: true, subtree: true });

    applyOptOutOverrides();
    window.setTimeout(applyOptOutOverrides, 300);
    window.setTimeout(applyOptOutOverrides, 1200);
  })();
</script>

{% schema %}
{
  "name": "Data sharing opt out",
  "settings": []
}
{% endschema %}
