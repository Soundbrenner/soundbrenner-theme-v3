<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "name": {{ shop.name | json }},
    {% if settings.logo %}
      "logo": {{ settings.logo | image_url: width: 500 | prepend: "https:" | json }},
    {% endif %}
    "url": {{ request.origin | append: page.url | json }}
  }
</script>

{% liquid
  assign primary_navigation = section.settings.primary_navigation
  assign seasonal_sale_name = settings.seasonal_sale_name | strip
  assign announcement_text = settings.seasonal_announcement_copy | strip
  assign announcement_text = announcement_text | replace: '{{ Seasonal sale name }}', seasonal_sale_name
  assign show_announcement = false
  if announcement_text != blank
    assign show_announcement = true
  endif
  assign sale_end_date = settings.seasonal_sale_end_date | strip
  assign show_announcement_countdown = false
  if show_announcement and sale_end_date != blank
    assign show_announcement_countdown = true
  endif
  assign announcement_gradient = settings.seasonal_announcement_gradient | default: 'linear-gradient(90deg, #E9CC92 0%, #92734F 33%, #92734F 66%, #E9CC92 100%)'
  assign announcement_emoji_asset = 'emoji-sale-new-year.png'
  assign trustpilot_entry = metaobjects.trustpilot.values | first
  assign trustpilot_url = 'https://www.trustpilot.com/review/soundbrenner.com'
  assign trustpilot_rating_raw = trustpilot_entry.rating.value | default: trustpilot_entry.rating
  if trustpilot_rating_raw != blank
    assign trustpilot_rating_text = trustpilot_rating_raw | append: ' out of 5'
  else
    assign trustpilot_rating_text = 'X.X out of 5'
  endif
  assign review_month_number = 'now' | date: '%m' | plus: 0
  assign review_year_number = 'now' | date: '%Y' | plus: 0
  if review_month_number == 1
    assign review_month_number = 12
    assign review_year_number = review_year_number | minus: 1
  else
    assign review_month_number = review_month_number | minus: 1
  endif
  case review_month_number
    when 1
      assign review_month_label = 'Jan'
    when 2
      assign review_month_label = 'Feb'
    when 3
      assign review_month_label = 'Mar'
    when 4
      assign review_month_label = 'Apr'
    when 5
      assign review_month_label = 'May'
    when 6
      assign review_month_label = 'Jun'
    when 7
      assign review_month_label = 'Jul'
    when 8
      assign review_month_label = 'Aug'
    when 9
      assign review_month_label = 'Sep'
    when 10
      assign review_month_label = 'Oct'
    when 11
      assign review_month_label = 'Nov'
    else
      assign review_month_label = 'Dec'
  endcase
  assign review_date_text = '8 ' | append: review_month_label | append: ', ' | append: review_year_number
  assign metronome_rating_raw = trustpilot_entry.the_metronome_app_review_rating.value | default: trustpilot_entry.the_metronome_app_review_rating
  assign metronome_count_raw = trustpilot_entry.the_metronome_app_review_count.value | default: trustpilot_entry.the_metronome_app_review_count
  assign metronome_rating_display = metronome_rating_raw | strip
  assign metronome_count_display = metronome_count_raw | strip

  case announcement_gradient
    when 'linear-gradient(90deg, #E9CC92 0%, #92734F 33%, #92734F 66%, #E9CC92 100%)'
      assign announcement_emoji_asset = 'emoji-sale-new-year.png'
    when 'linear-gradient(90deg, #F3C1DE 0%, #C77CA5 33%, #C77CA5 66%, #F3C1DE 100%)'
      assign announcement_emoji_asset = 'emoji-sale-valentines-day.png'
    when 'linear-gradient(90deg, #A4CF83 0%, #768E57 33%, #768E57 66%, #A4CF83 100%)'
      assign announcement_emoji_asset = 'emoji-sale-spring.png'
    when 'linear-gradient(90deg, #B19CD9 0%, #7B5EA7 33%, #7B5EA7 66%, #B19CD9 100%)'
      assign announcement_emoji_asset = 'emoji-sale-easter.png'
    when 'linear-gradient(90deg, #9CBDCD 0%, #F08835 33%, #F08835 66%, #9CBDCD 100%)'
      assign announcement_emoji_asset = 'emoji-sale-summer.png'
    when 'linear-gradient(90deg, #E6A53C 0%, #1E4F8F 33%, #1E4F8F 66%, #E6A53C 100%)'
      assign announcement_emoji_asset = 'emoji-sale-back-to-school.png'
    when 'linear-gradient(90deg, #1F3937 0%, #57522A 33%, #E58C56 66%, #6F351F 100%)'
      assign announcement_emoji_asset = 'emoji-sale-fall.png'
    when 'linear-gradient(90deg, #2F173A 0%, #D84418 33%, #D84418 66%, #2F173A 100%)'
      assign announcement_emoji_asset = 'emoji-sale-halloween.png'
    when 'linear-gradient(90deg, #8759F1 0%, #023CFB 33%, #8759F1 66%, #023CFB 100%)'
      assign announcement_emoji_asset = 'emoji-sale-bfcm.png'
    when 'linear-gradient(90deg, #B49F76 0%, #C32B2E 33%, #C32B2E 66%, #B49F76 100%)'
      assign announcement_emoji_asset = 'emoji-sale-holiday.png'
    when 'linear-gradient(90deg, var(--sb-color-primary-500) 0%, var(--sb-color-primary-700) 33%, var(--sb-color-primary-700) 66%, var(--sb-color-primary-500) 100%)'
      assign announcement_emoji_asset = 'emoji-sale-anniversary.png'
  endcase
%}

<header
  class="header full-width{% if show_announcement %} has-announcement{% endif %}"
  {% if show_announcement %}
    style="--sb-announcement-background: {{ announcement_gradient }};"
  {% endif %}
>
  {% if show_announcement %}
    <div class="header__announcement">
      <div class="header__announcement-content">
        <div class="header__announcement-emojis" aria-hidden="true">
          <span class="header__announcement-emoji header__announcement-emoji--left">
            <img src="{{ announcement_emoji_asset | asset_url }}" alt="" loading="eager" width="20" height="20">
          </span>
          <span class="header__announcement-emoji header__announcement-emoji--right">
            <img src="{{ announcement_emoji_asset | asset_url }}" alt="" loading="eager" width="20" height="20">
          </span>
        </div>

        <div class="header__announcement-top">
          <p class="header__announcement-text font-caption weight-semibold">{{ announcement_text | escape | newline_to_br }}</p>
        </div>

        {% if show_announcement_countdown %}
          <div class="header__announcement-countdown" data-announcement-countdown data-sale-end-date="{{ sale_end_date | escape }}" hidden>
            <div class="header__announcement-countdown-group">
              <span class="header__announcement-countdown-value font-caption weight-bold" data-countdown-days>00</span>
              <span class="header__announcement-countdown-label font-caption2 weight-semibold">days</span>
            </div>
            <div class="header__announcement-countdown-group">
              <span class="header__announcement-countdown-value font-caption weight-bold" data-countdown-hours>00</span>
              <span class="header__announcement-countdown-label font-caption2 weight-semibold">hours</span>
            </div>
            <div class="header__announcement-countdown-group">
              <span class="header__announcement-countdown-value font-caption weight-bold" data-countdown-mins>00</span>
              <span class="header__announcement-countdown-label font-caption2 weight-semibold">mins</span>
            </div>
            <div class="header__announcement-countdown-group">
              <span class="header__announcement-countdown-value font-caption weight-bold" data-countdown-secs>00</span>
              <span class="header__announcement-countdown-label font-caption2 weight-semibold">secs</span>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  {% endif %}

  <div class="header__inner">
    <div class="header__icons header__icons--left">
      <button
        type="button"
        class="header__icon-link header__icon-link--menu"
        aria-label="Menu"
        aria-expanded="false"
        data-mobile-menu-toggle
      >
        <span class="header__icon-asset" aria-hidden="true">
          {{ 'icon-hamburger-padded.svg' | inline_asset_content }}
        </span>
      </button>
      <a class="header__icon-link header__icon-link--search" href="{{ routes.search_url }}" aria-label="Search">
        <span class="header__icon-asset" aria-hidden="true">
          {{ 'icon-search-padded.svg' | inline_asset_content }}
        </span>
      </a>
    </div>

    <a class="header__brand" href="{{ routes.root_url }}" aria-label="{{ shop.name | escape }}">
      <span class="header__brand-logo" aria-hidden="true">
        {{ 'logo-soundbrenner-wordmark.svg' | inline_asset_content }}
      </span>
    </a>

    <nav class="header__menu" aria-label="Primary">
      {% if primary_navigation != blank and primary_navigation.links.size > 0 %}
        {% for link in primary_navigation.links %}
          {% liquid
            assign link_index = forloop.index
            assign link_path = link.url | split: '?' | first
            assign is_active_link = false
            if link.current or request.path == link_path
              assign is_active_link = true
            endif

            assign has_mega_cards = false
            assign dropdown_card_count = 0

            for block in section.blocks
              if block.type == 'mega_menu_item_product' or block.type == 'mega_menu_item_collection' or block.type == 'mega_menu_item_page' or block.type == 'mega_menu_item_app'
                assign card_menu_index = block.settings.menu_item_index | plus: 0
                if card_menu_index == link_index
                  assign has_mega_cards = true
                  assign dropdown_card_count = dropdown_card_count | plus: 1
                endif
              endif
            endfor

            assign has_dropdown = false
            if has_mega_cards
              assign has_dropdown = true
            endif

            assign dropdown_card_count = dropdown_card_count | at_least: 1 | at_most: 4
          %}

          <div class="header__menu-item{% if has_dropdown %} has-dropdown{% endif %}">
            <a
              class="header__menu-link font-caption weight-regular{% if is_active_link %} is-active{% endif %}"
              href="{{ link.url }}"
            >
              {{ link.title }}
            </a>

            {% if has_dropdown %}
              <div class="header__mega-menu" aria-label="{{ link.title | escape }}" style="--sb-mega-columns: {{ dropdown_card_count }};">
                <div class="header__mega-menu-panel">
                  <div class="header__mega-menu-panel-inner">
                  <a class="header__mega-menu-title font-title weight-bold" href="{{ link.url }}">{{ link.title }}</a>
                  <div class="header__mega-menu-grid">
                    {% for block in section.blocks %}
                      {% liquid
                        if block.type != 'mega_menu_item_product' and block.type != 'mega_menu_item_collection' and block.type != 'mega_menu_item_page' and block.type != 'mega_menu_item_app'
                          continue
                        endif

                        assign block_menu_index = block.settings.menu_item_index | plus: 0
                        if block_menu_index != link_index
                          continue
                        endif
                        assign app_mode = false
                        assign card_product = blank
                        assign card_collection = blank
                        assign card_page = blank
                        assign hide_on_mobile = false

                        case block.type
                          when 'mega_menu_item_product'
                            assign card_product = block.settings.product
                          when 'mega_menu_item_collection'
                            assign card_collection = block.settings.collection
                            assign hide_on_mobile = block.settings.hide_on_mobile
                          when 'mega_menu_item_page'
                            assign card_page = block.settings.page
                          when 'mega_menu_item_app'
                            assign app_mode = true
                        endcase
                        assign card_image = block.settings.image
                        assign card_title = blank
                        assign card_body = blank
                        assign card_link = blank
                        assign card_rating_value = 4.8
                        assign card_rating_display = metronome_rating_display | default: '4.8'
                        assign card_rating_count_display = metronome_count_display | default: '100K+'
                        assign card_star_icon_url = 'icon-review-star.svg' | asset_url
                        assign card_app_store_link = 'https://apps.apple.com/us/app/the-metronome-by-soundbrenner/id1048954353'
                        assign card_google_play_link = 'https://play.google.com/store/apps/details?id=com.soundbrenner.pulse'

                        if app_mode == true
                          assign app_page = block.settings.app_page
                          if app_page != blank
                            assign card_link = app_page.url
                          else
                            assign card_link = routes.root_url | append: 'pages/the-app'
                          endif
                          assign card_title = 'The Metronome app'
                          assign card_body = 'Download for iOS and Android'
                          assign parsed_rating_value = card_rating_display | split: ' ' | first | plus: 0
                          if parsed_rating_value > 0
                            assign card_rating_value = parsed_rating_value
                          endif
                        else
                          if card_product != blank
                            assign card_link = card_product.url
                            assign card_title = card_product.title
                            assign product_settings_ref = card_product.metafields.custom.sbv2_product_settings.value | default: card_product.metafields.custom.sbv2_product_settings
                            if product_settings_ref != blank
                              assign card_body = product_settings_ref.tagline.value | default: product_settings_ref.tagline
                            endif
                            if card_body == blank and card_product.description != blank
                              assign card_body = card_product.description | strip_html
                            endif
                          elsif card_collection != blank
                            assign card_link = card_collection.url
                            assign card_title = card_collection.title
                            assign card_body = card_collection.description | strip_html
                          elsif card_page != blank
                            assign card_link = card_page.url
                            assign card_title = card_page.title
                            assign card_body = card_page.content | strip_html
                          endif
                        endif

                        assign card_image_url = blank
                        if card_image != blank
                          assign card_image_url = card_image | image_url: width: 502
                        endif

                        assign card_badge_label = blank
                        assign card_badge_type = blank
                        if card_product != blank and card_product.tags != blank
                          for product_tag in card_product.tags
                            assign product_tag_downcase = product_tag | downcase
                            if product_tag_downcase == 'bestseller'
                              assign card_badge_label = 'Bestseller'
                              assign card_badge_type = 'bestseller'
                              break
                            endif
                            if product_tag_downcase == 'new'
                              assign card_badge_label = 'New'
                              assign card_badge_type = 'new'
                            endif
                          endfor
                        endif
                      %}

                      <article class="header__mega-card" data-hide-on-mobile="{{ hide_on_mobile }}" {{ block.shopify_attributes }}>
                        <a class="header__mega-card-media" href="{{ card_link | default: '#' }}">
                          {% if card_badge_label != blank %}
                            <span class="header__mega-card-badge header__mega-card-badge--{{ card_badge_type }} font-caption weight-semibold">
                              {{ card_badge_label }}
                            </span>
                          {% endif %}

                          {% if card_image_url != blank %}
                            <img
                              class="header__mega-card-image"
                              src="{{ card_image_url }}"
                              alt="{{ card_title | default: link.title | escape }}"
                              loading="eager"
                              fetchpriority="low"
                              decoding="async"
                              width="502"
                              height="502"
                            >
                          {% else %}
                            <img
                              class="header__mega-card-image"
                              src="{{ 'mega-menu-item-placeholder.jpg' | asset_url }}"
                              alt="{{ card_title | default: link.title | escape }}"
                              loading="eager"
                              fetchpriority="low"
                              decoding="async"
                              width="502"
                              height="502"
                            >
                          {% endif %}
                        </a>

                        <p class="header__mega-card-title font-callout weight-bold">
                          <a class="header__mega-card-title-link" href="{{ card_link | default: '#' }}">{{ card_title | default: link.title }}</a>
                        </p>

                        {% if app_mode == true %}
                          <div class="header__mega-card-app">
                            <p class="header__mega-card-rating font-body weight-semibold">
                              <span class="header__mega-card-stars" aria-hidden="true">
                                {% for star_index in (1..5) %}
                                  {% assign prior_stars = star_index | minus: 1 %}
                                  {% assign star_fill = 0 %}
                                  {% if card_rating_value >= star_index %}
                                    {% assign star_fill = 100 %}
                                  {% elsif card_rating_value > prior_stars %}
                                    {% assign star_fill = card_rating_value | minus: prior_stars | times: 100 | round %}
                                  {% endif %}
                                  <span class="header__mega-card-star" style="--sb-star-fill: {{ star_fill }}%; --sb-star-icon-url: url('{{ card_star_icon_url }}');"></span>
                                {% endfor %}
                              </span>
                              <span>{{ card_rating_display }}</span>
                            </p>
                            <p class="header__mega-card-rating-count font-body weight-regular">{{ card_rating_count_display }} ratings</p>

                            <div class="header__mega-card-app-links">
                              <a href="{{ card_app_store_link }}" target="_blank" rel="noopener noreferrer" aria-label="Download on the App Store">
                                <img
                                  src="{{ 'app-download-app-store.png' | asset_url }}"
                                  alt="Download on the App Store"
                                  loading="lazy"
                                  width="100"
                                  height="30"
                                >
                              </a>
                              <a href="{{ card_google_play_link }}" target="_blank" rel="noopener noreferrer" aria-label="Get it on Google Play">
                                <img
                                  src="{{ 'app-download-google-play.png' | asset_url }}"
                                  alt="Get it on Google Play"
                                  loading="lazy"
                                  width="100"
                                  height="30"
                                >
                              </a>
                            </div>
                          </div>
                        {% else %}
                          {% if card_body != blank %}
                            <p class="header__mega-card-body font-body weight-regular">{{ card_body }}</p>
                          {% endif %}

                          {% if block.type == 'mega_menu_item_product' %}
                            {% assign accessories_collection = block.settings.accessories_collection %}
                            {% if accessories_collection == blank and card_product != blank and card_product.collections != blank %}
                              {% for candidate_collection in card_product.collections %}
                                {% assign candidate_handle = candidate_collection.handle | downcase %}
                                {% assign candidate_title = candidate_collection.title | downcase %}
                                {% if candidate_handle contains 'accessor' or candidate_title contains 'accessor' %}
                                  {% assign accessories_collection = candidate_collection %}
                                  {% break %}
                                {% endif %}
                              {% endfor %}
                              {% if accessories_collection == blank %}
                                {% assign accessories_collection = card_product.collections.first %}
                              {% endif %}
                            {% endif %}
                            {% if accessories_collection != blank %}
                              <ul class="header__mega-card-links font-body weight-semibold" role="list">
                                <li>
                                  <a href="{{ accessories_collection.url }}">Accessories</a>
                                </li>
                              </ul>
                            {% endif %}
                          {% elsif block.type == 'mega_menu_item_collection' %}
                            {% assign linked_product_1 = block.settings.related_product_1 %}
                            {% assign linked_product_2 = block.settings.related_product_2 %}
                            {% assign linked_product_3 = block.settings.related_product_3 %}
                            {% assign has_card_links = false %}
                            {% if linked_product_1 != blank or linked_product_2 != blank or linked_product_3 != blank %}
                              {% assign has_card_links = true %}
                            {% endif %}
                            {% if has_card_links %}
                              <ul class="header__mega-card-links font-body weight-semibold" role="list">
                                {% if linked_product_1 != blank %}
                                  {% assign linked_product_1_settings = linked_product_1.metafields.custom.sbv2_product_settings.value | default: linked_product_1.metafields.custom.sbv2_product_settings %}
                                  {% assign linked_product_1_tagline = blank %}
                                  {% if linked_product_1_settings != blank %}
                                    {% assign linked_product_1_tagline = linked_product_1_settings.tagline.value | default: linked_product_1_settings.tagline %}
                                  {% endif %}
                                  <li>
                                    <a
                                      href="{{ linked_product_1.url }}"
                                      data-mobile-product-title="{{ linked_product_1.title | escape }}"
                                      data-mobile-product-description="{{ linked_product_1.description | strip_html | escape }}"
                                      data-mobile-product-tagline="{{ linked_product_1_tagline | escape }}"
                                    >
                                      {{ linked_product_1.title }}
                                    </a>
                                  </li>
                                {% endif %}
                                {% if linked_product_2 != blank %}
                                  {% assign linked_product_2_settings = linked_product_2.metafields.custom.sbv2_product_settings.value | default: linked_product_2.metafields.custom.sbv2_product_settings %}
                                  {% assign linked_product_2_tagline = blank %}
                                  {% if linked_product_2_settings != blank %}
                                    {% assign linked_product_2_tagline = linked_product_2_settings.tagline.value | default: linked_product_2_settings.tagline %}
                                  {% endif %}
                                  <li>
                                    <a
                                      href="{{ linked_product_2.url }}"
                                      data-mobile-product-title="{{ linked_product_2.title | escape }}"
                                      data-mobile-product-description="{{ linked_product_2.description | strip_html | escape }}"
                                      data-mobile-product-tagline="{{ linked_product_2_tagline | escape }}"
                                    >
                                      {{ linked_product_2.title }}
                                    </a>
                                  </li>
                                {% endif %}
                                {% if linked_product_3 != blank %}
                                  {% assign linked_product_3_settings = linked_product_3.metafields.custom.sbv2_product_settings.value | default: linked_product_3.metafields.custom.sbv2_product_settings %}
                                  {% assign linked_product_3_tagline = blank %}
                                  {% if linked_product_3_settings != blank %}
                                    {% assign linked_product_3_tagline = linked_product_3_settings.tagline.value | default: linked_product_3_settings.tagline %}
                                  {% endif %}
                                  <li>
                                    <a
                                      href="{{ linked_product_3.url }}"
                                      data-mobile-product-title="{{ linked_product_3.title | escape }}"
                                      data-mobile-product-description="{{ linked_product_3.description | strip_html | escape }}"
                                      data-mobile-product-tagline="{{ linked_product_3_tagline | escape }}"
                                    >
                                      {{ linked_product_3.title }}
                                    </a>
                                  </li>
                                {% endif %}
                              </ul>
                            {% endif %}
                          {% endif %}
                        {% endif %}
                      </article>
                    {% endfor %}
                  </div>
                  </div>
                </div>
              </div>
            {% endif %}
          </div>
        {% endfor %}
      {% endif %}
    </nav>

    <div class="header__icons header__icons--right">
      <a
        class="header__icon-link header__icon-link--search header__icon-link--desktop-only"
        href="{{ routes.search_url }}"
        aria-label="Search"
      >
        <span class="header__icon-asset" aria-hidden="true">
          {{ 'icon-search-padded.svg' | inline_asset_content }}
        </span>
      </a>
      <a class="header__icon-link header__icon-link--account" href="{{ routes.account_url }}" aria-label="Account">
        <span class="header__icon-asset" aria-hidden="true">
          {{ 'icon-account-padded.svg' | inline_asset_content }}
        </span>
      </a>

      <a class="header__icon-link header__icon-link--cart" href="{{ routes.cart_url }}" data-header-cart-link aria-label="Cart">
        <sup class="header__cart-count-badge font-caption2 weight-semibold" data-header-cart-count {% if cart.item_count == 0 %}hidden{% endif %}>
          {{ cart.item_count }}
        </sup>
        <span class="header__icon-asset" aria-hidden="true">
          {{ 'icon-cart-padded.svg' | inline_asset_content }}
        </span>
      </a>
    </div>
  </div>
</header>
<div class="menu-drawer-container" data-mobile-menu-drawer>
  <div class="menu-drawer" data-mobile-menu-panel>
    <button
      class="menu-drawer__close-button"
      type="button"
      aria-label="Close menu"
      data-mobile-menu-close
    >
      <span class="menu-drawer__close-icon-circle" aria-hidden="true">
        {{ 'icon-cancel-circle.svg' | inline_asset_content }}
      </span>
      <span class="menu-drawer__close-icon-x" aria-hidden="true">
        {{ 'icon-cancel-x.svg' | inline_asset_content }}
      </span>
    </button>
    <nav class="menu-drawer__navigation" aria-label="Primary navigation">
      <ul class="menu-drawer__menu has-submenu" role="list">
        {% if primary_navigation != blank and primary_navigation.links.size > 0 %}
          {% for link in primary_navigation.links %}
            {% liquid
              assign drawer_link_index = forloop.index
              assign has_drawer_submenu = false

              for block in section.blocks
                if block.type == 'mega_menu_item_product' or block.type == 'mega_menu_item_collection' or block.type == 'mega_menu_item_page' or block.type == 'mega_menu_item_app'
                  assign block_menu_index = block.settings.menu_item_index | plus: 0
                  if block_menu_index == drawer_link_index
                    assign has_drawer_submenu = true
                    break
                  endif
                endif
              endfor
            %}
            <li class="menu-drawer__list-item" style="--menu-drawer-animation-index: {{ forloop.index }};">
              {% if has_drawer_submenu %}
                <details class="menu-drawer__menu-container">
                  <summary class="menu-drawer__menu-item menu-drawer__menu-item--mainlist menu-drawer__animated-element">
                    <span class="menu-drawer__menu-item-text font-callout weight-semibold">{{ link.title | escape }}</span>
                    <span class="menu-drawer__menu-item-indicator" aria-hidden="true">
                      <span class="menu-drawer__menu-item-indicator-plus">{{ 'icon-accordion-add.svg' | inline_asset_content }}</span>
                      <span class="menu-drawer__menu-item-indicator-close">{{ 'icon-accordion-close.svg' | inline_asset_content }}</span>
                    </span>
                  </summary>
                  <ul class="menu-drawer__menu menu-drawer__menu--childlist" role="list">
                    {% for block in section.blocks %}
                      {% liquid
                        if block.type != 'mega_menu_item_product' and block.type != 'mega_menu_item_collection' and block.type != 'mega_menu_item_page' and block.type != 'mega_menu_item_app'
                          continue
                        endif

                        assign block_menu_index = block.settings.menu_item_index | plus: 0
                        if block_menu_index != drawer_link_index
                          continue
                        endif

                        assign drawer_card_link = blank
                        assign drawer_card_title = blank
                        assign drawer_card_body = blank
                        assign drawer_card_image_url = blank
                        assign drawer_badge_label = blank
                        assign drawer_badge_type = blank
                        assign drawer_is_app = false
                        assign drawer_star_icon_url = 'icon-review-star.svg' | asset_url
                        assign drawer_rating_display = metronome_rating_display | default: '4.8'
                        assign drawer_rating_count_display = metronome_count_display | default: '100K+'
                        assign drawer_rating_value = 4.8
                        assign drawer_app_store_link = 'https://apps.apple.com/us/app/the-metronome-by-soundbrenner/id1048954353'
                        assign drawer_google_play_link = 'https://play.google.com/store/apps/details?id=com.soundbrenner.pulse'
                        assign drawer_card_product = blank
                        assign drawer_card_collection = blank
                        assign drawer_card_page = blank
                        assign drawer_hide_primary_tile = false
                        assign drawer_accessories_collection = blank
                        assign drawer_related_product_1 = blank
                        assign drawer_related_product_2 = blank
                        assign drawer_related_product_3 = blank
                        assign drawer_related_product_1_image = blank
                        assign drawer_related_product_2_image = blank
                        assign drawer_related_product_3_image = blank
                        assign drawer_related_product_1_show_on_mobile = true
                        assign drawer_related_product_2_show_on_mobile = true
                        assign drawer_related_product_3_show_on_mobile = true

                        case block.type
                          when 'mega_menu_item_product'
                            assign drawer_card_product = block.settings.product
                          when 'mega_menu_item_collection'
                            assign drawer_card_collection = block.settings.collection
                            assign drawer_hide_primary_tile = block.settings.hide_on_mobile
                            assign drawer_related_product_1 = block.settings.related_product_1
                            assign drawer_related_product_2 = block.settings.related_product_2
                            assign drawer_related_product_3 = block.settings.related_product_3
                            assign drawer_related_product_1_image = block.settings.related_product_1_image
                            assign drawer_related_product_2_image = block.settings.related_product_2_image
                            assign drawer_related_product_3_image = block.settings.related_product_3_image
                            assign drawer_related_product_1_show_on_mobile = block.settings.related_product_1_show_on_mobile
                            assign drawer_related_product_2_show_on_mobile = block.settings.related_product_2_show_on_mobile
                            assign drawer_related_product_3_show_on_mobile = block.settings.related_product_3_show_on_mobile
                          when 'mega_menu_item_page'
                            assign drawer_card_page = block.settings.page
                          when 'mega_menu_item_app'
                            assign drawer_is_app = true
                            assign drawer_card_page = block.settings.app_page
                            assign drawer_card_title = 'The Metronome app'
                        endcase

                        if drawer_card_product != blank
                          assign drawer_card_link = drawer_card_product.url
                          assign drawer_card_title = drawer_card_product.title
                          assign drawer_product_settings_ref = drawer_card_product.metafields.custom.sbv2_product_settings.value | default: drawer_card_product.metafields.custom.sbv2_product_settings
                          if drawer_product_settings_ref != blank
                            assign drawer_card_body = drawer_product_settings_ref.tagline.value | default: drawer_product_settings_ref.tagline
                          endif
                          if drawer_card_body == blank and drawer_card_product.description != blank
                            assign drawer_card_body = drawer_card_product.description | strip_html
                          endif

                          if drawer_card_product.tags != blank
                            for drawer_product_tag in drawer_card_product.tags
                              assign drawer_product_tag_downcase = drawer_product_tag | downcase
                              if drawer_product_tag_downcase == 'bestseller'
                                assign drawer_badge_label = 'Bestseller'
                                assign drawer_badge_type = 'bestseller'
                                break
                              endif
                              if drawer_product_tag_downcase == 'new'
                                assign drawer_badge_label = 'New'
                                assign drawer_badge_type = 'new'
                              endif
                            endfor
                          endif

                          assign drawer_accessories_collection = block.settings.accessories_collection
                          if drawer_accessories_collection == blank and drawer_card_product.collections != blank
                            for drawer_candidate_collection in drawer_card_product.collections
                              assign drawer_candidate_handle = drawer_candidate_collection.handle | downcase
                              assign drawer_candidate_title = drawer_candidate_collection.title | downcase
                              if drawer_candidate_handle contains 'accessor' or drawer_candidate_title contains 'accessor'
                                assign drawer_accessories_collection = drawer_candidate_collection
                                break
                              endif
                            endfor
                            if drawer_accessories_collection == blank
                              assign drawer_accessories_collection = drawer_card_product.collections.first
                            endif
                          endif
                        elsif drawer_card_collection != blank
                          assign drawer_card_link = drawer_card_collection.url
                          assign drawer_card_title = drawer_card_collection.title
                          assign drawer_card_body = drawer_card_collection.description | strip_html
                        elsif drawer_card_page != blank
                          assign drawer_card_link = drawer_card_page.url
                          if drawer_card_title == blank
                            assign drawer_card_title = drawer_card_page.title
                          endif
                          if drawer_is_app
                            assign drawer_card_body = 'Download for iOS and Android'
                            assign parsed_drawer_rating_value = drawer_rating_display | split: ' ' | first | plus: 0
                            if parsed_drawer_rating_value > 0
                              assign drawer_rating_value = parsed_drawer_rating_value
                            endif
                          else
                            assign drawer_card_body = drawer_card_page.content | strip_html
                          endif
                        endif

                        if drawer_card_link == blank or drawer_card_title == blank
                          continue
                        endif

                        assign drawer_image = block.settings.image
                        if drawer_image != blank
                          assign drawer_card_image_url = drawer_image | image_url: width: 502
                        endif
                      %}
                      <li class="menu-drawer__submenu-item">
                        {% unless drawer_hide_primary_tile %}
                          <a class="menu-drawer__submenu-card menu-drawer__animated-element{% if drawer_is_app %} menu-drawer__submenu-card--app{% endif %}{% if drawer_badge_label != blank %} menu-drawer__submenu-card--has-badge menu-drawer__submenu-card--{{ drawer_badge_type }}{% endif %}" href="{{ drawer_card_link }}">
                            <span class="menu-drawer__submenu-media" aria-hidden="true">
                              {% if drawer_card_image_url != blank %}
                                <img
                                  class="menu-drawer__submenu-image"
                                  src="{{ drawer_card_image_url }}"
                                  alt=""
                                  loading="lazy"
                                  decoding="async"
                                  width="502"
                                  height="502"
                                >
                              {% else %}
                                <img
                                  class="menu-drawer__submenu-image"
                                  src="{{ 'mega-menu-item-placeholder.jpg' | asset_url }}"
                                  alt=""
                                  loading="lazy"
                                  decoding="async"
                                  width="502"
                                  height="502"
                                >
                              {% endif %}
                            </span>
                            <span class="menu-drawer__submenu-copy">
                              <span class="menu-drawer__submenu-title font-body weight-bold">{{ drawer_card_title | escape }}</span>
                              {% if drawer_is_app %}
                                <p class="menu-drawer__app-rating font-caption weight-semibold">
                                  <span class="menu-drawer__app-stars" aria-hidden="true">
                                    {% for star_index in (1..5) %}
                                      {% assign drawer_prior_stars = star_index | minus: 1 %}
                                      {% assign drawer_star_fill = 0 %}
                                      {% if drawer_rating_value >= star_index %}
                                        {% assign drawer_star_fill = 100 %}
                                      {% elsif drawer_rating_value > drawer_prior_stars %}
                                        {% assign drawer_star_fill = drawer_rating_value | minus: drawer_prior_stars | times: 100 | round %}
                                      {% endif %}
                                      <span class="menu-drawer__app-star" style="--sb-star-fill: {{ drawer_star_fill }}%; --sb-star-icon-url: url('{{ drawer_star_icon_url }}');"></span>
                                    {% endfor %}
                                  </span>
                                  <span>{{ drawer_rating_display }}</span>
                                </p>
                                <p class="menu-drawer__app-rating-count font-caption weight-regular">{{ drawer_rating_count_display }} ratings</p>
                              {% elsif drawer_card_body != blank %}
                                <span class="menu-drawer__submenu-body font-caption weight-regular">{{ drawer_card_body | truncate: 120 }}</span>
                              {% endif %}
                            </span>
                            {% if drawer_badge_label != blank %}
                              <span class="menu-drawer__submenu-badge menu-drawer__submenu-badge--{{ drawer_badge_type }} font-caption weight-semibold">
                                {{ drawer_badge_label }}
                              </span>
                            {% endif %}
                          </a>
                        {% endunless %}

                        {% if drawer_accessories_collection != blank %}
                          <a class="menu-drawer__submenu-secondary font-caption weight-semibold menu-drawer__animated-element" href="{{ drawer_accessories_collection.url }}">
                            Accessories
                          </a>
                        {% endif %}

                        {% for drawer_related_index in (1..3) %}
                          {% liquid
                            assign drawer_related_product = blank
                            assign drawer_related_product_image = blank
                            assign drawer_related_product_show_on_mobile = true
                            case drawer_related_index
                              when 1
                                assign drawer_related_product = drawer_related_product_1
                                assign drawer_related_product_image = drawer_related_product_1_image
                                assign drawer_related_product_show_on_mobile = drawer_related_product_1_show_on_mobile
                              when 2
                                assign drawer_related_product = drawer_related_product_2
                                assign drawer_related_product_image = drawer_related_product_2_image
                                assign drawer_related_product_show_on_mobile = drawer_related_product_2_show_on_mobile
                              when 3
                                assign drawer_related_product = drawer_related_product_3
                                assign drawer_related_product_image = drawer_related_product_3_image
                                assign drawer_related_product_show_on_mobile = drawer_related_product_3_show_on_mobile
                            endcase

                            if drawer_related_product == blank or drawer_related_product_show_on_mobile == false
                              continue
                            endif

                            assign drawer_related_image_url = blank
                            if drawer_related_product_image != blank
                              assign drawer_related_image_url = drawer_related_product_image | image_url: width: 502
                            elsif drawer_related_product.featured_image != blank
                              assign drawer_related_image_url = drawer_related_product.featured_image | image_url: width: 502
                            endif

                            assign drawer_related_body = blank
                            assign drawer_related_settings_ref = drawer_related_product.metafields.custom.sbv2_product_settings.value | default: drawer_related_product.metafields.custom.sbv2_product_settings
                            if drawer_related_settings_ref != blank
                              assign drawer_related_body = drawer_related_settings_ref.tagline.value | default: drawer_related_settings_ref.tagline
                            endif
                            if drawer_related_body == blank and drawer_related_product.description != blank
                              assign drawer_related_body = drawer_related_product.description | strip_html
                            endif

                            assign drawer_related_badge_label = blank
                            assign drawer_related_badge_type = blank
                            if drawer_related_product.tags != blank
                              for drawer_related_tag in drawer_related_product.tags
                                assign drawer_related_tag_downcase = drawer_related_tag | downcase
                                if drawer_related_tag_downcase == 'bestseller'
                                  assign drawer_related_badge_label = 'Bestseller'
                                  assign drawer_related_badge_type = 'bestseller'
                                  break
                                endif
                                if drawer_related_tag_downcase == 'new'
                                  assign drawer_related_badge_label = 'New'
                                  assign drawer_related_badge_type = 'new'
                                endif
                              endfor
                            endif
                          %}
                          <a class="menu-drawer__submenu-card menu-drawer__submenu-card--related menu-drawer__animated-element{% if drawer_related_badge_label != blank %} menu-drawer__submenu-card--has-badge menu-drawer__submenu-card--{{ drawer_related_badge_type }}{% endif %}" href="{{ drawer_related_product.url }}">
                            <span class="menu-drawer__submenu-media" aria-hidden="true">
                              {% if drawer_related_image_url != blank %}
                                <img
                                  class="menu-drawer__submenu-image"
                                  src="{{ drawer_related_image_url }}"
                                  alt=""
                                  loading="lazy"
                                  decoding="async"
                                  width="502"
                                  height="502"
                                >
                              {% else %}
                                <img
                                  class="menu-drawer__submenu-image"
                                  src="{{ 'mega-menu-item-placeholder.jpg' | asset_url }}"
                                  alt=""
                                  loading="lazy"
                                  decoding="async"
                                  width="502"
                                  height="502"
                                >
                              {% endif %}
                            </span>
                            <span class="menu-drawer__submenu-copy">
                              <span class="menu-drawer__submenu-title font-body weight-bold">{{ drawer_related_product.title | escape }}</span>
                              {% if drawer_related_body != blank %}
                                <span class="menu-drawer__submenu-body font-caption weight-regular">{{ drawer_related_body | truncate: 120 }}</span>
                              {% endif %}
                            </span>
                            {% if drawer_related_badge_label != blank %}
                              <span class="menu-drawer__submenu-badge menu-drawer__submenu-badge--{{ drawer_related_badge_type }} font-caption weight-semibold">
                                {{ drawer_related_badge_label }}
                              </span>
                            {% endif %}
                          </a>
                        {% endfor %}

                        {% if drawer_is_app %}
                          <a class="menu-drawer__submenu-secondary menu-drawer__submenu-store font-caption weight-semibold menu-drawer__animated-element" href="{{ drawer_app_store_link }}" target="_blank" rel="noopener noreferrer" aria-label="Download on the App Store">
                            <span>App Store</span>
                            <span class="menu-drawer__submenu-store-badge" aria-hidden="true">
                              <img
                                src="{{ 'app-download-app-store.png' | asset_url }}"
                                alt=""
                                loading="lazy"
                                width="100"
                                height="30"
                              >
                            </span>
                          </a>
                          <a class="menu-drawer__submenu-secondary menu-drawer__submenu-store font-caption weight-semibold menu-drawer__animated-element" href="{{ drawer_google_play_link }}" target="_blank" rel="noopener noreferrer" aria-label="Get it on Google Play">
                            <span>Google Play</span>
                            <span class="menu-drawer__submenu-store-badge" aria-hidden="true">
                              <img
                                src="{{ 'app-download-google-play.png' | asset_url }}"
                                alt=""
                                loading="lazy"
                                width="100"
                                height="30"
                              >
                            </span>
                          </a>
                        {% endif %}
                      </li>
                    {% endfor %}
                  </ul>
                </details>
              {% else %}
                <a
                  class="menu-drawer__menu-item menu-drawer__menu-item--mainlist menu-drawer__animated-element"
                  href="{{ link.url }}"
                  {% if link.current %}
                    aria-current="page"
                  {% endif %}
                >
                  <span class="menu-drawer__menu-item-text font-callout weight-semibold">{{ link.title | escape }}</span>
                </a>
              {% endif %}
            </li>
          {% endfor %}
        {% endif %}
      </ul>
      <div class="menu-drawer__trustpilot menu-drawer__animated-element" style="--menu-drawer-animation-index: 7;">
        <a
          class="menu-drawer__trustpilot-link menu-drawer__trustpilot-link--logo"
          href="{{ trustpilot_url }}"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Trustpilot logo link"
        >
          <span class="menu-drawer__trustpilot-logo" aria-hidden="true">
            {{ 'trustpilot-logo-multicolor.svg' | inline_asset_content }}
          </span>
        </a>
        <a
          class="menu-drawer__trustpilot-link menu-drawer__trustpilot-link--stars"
          href="{{ trustpilot_url }}"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Trustpilot stars link"
        >
          <span class="menu-drawer__trustpilot-stars" aria-hidden="true">
            {{ 'trustpilot-stars-multicolor.svg' | inline_asset_content }}
          </span>
        </a>
        <a
          class="menu-drawer__trustpilot-link menu-drawer__trustpilot-link--text font-body weight-semibold"
          href="{{ trustpilot_url }}"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Read Soundbrenner reviews on Trustpilot"
        >
          {{ trustpilot_rating_text }}
        </a>
      </div>

      <div class="menu-drawer__review menu-drawer__animated-element" style="--menu-drawer-animation-index: 8;">
        <div class="menu-drawer__review-row">
          <span class="menu-drawer__review-name font-caption weight-semibold">Wesley G.</span>
          <span class="menu-drawer__review-verified font-caption weight-semibold">
            <span class="menu-drawer__review-verified-icon" aria-hidden="true">
              {{ 'icon-verified-badge.svg' | inline_asset_content }}
            </span>
            <span>Verified buyer</span>
          </span>
          <span class="menu-drawer__review-stars" aria-hidden="true" style="--sb-review-star-icon-url: url('{{ 'icon-review-star.svg' | asset_url }}');">
            <span class="menu-drawer__review-star"></span>
            <span class="menu-drawer__review-star"></span>
            <span class="menu-drawer__review-star"></span>
            <span class="menu-drawer__review-star"></span>
            <span class="menu-drawer__review-star"></span>
          </span>
        </div>
        <p class="menu-drawer__review-text font-caption weight-regular">
          I have the in-ear monitors and the Pulse. They work exactly as promised. Shipping was good and without bad surprises. Thank you Soundbrenner!
        </p>
        <p class="menu-drawer__review-date font-caption weight-regular">{{ review_date_text }}</p>
      </div>

      <div class="menu-drawer__social menu-drawer__animated-element" style="--menu-drawer-animation-index: 9;" aria-label="Social links">
        <a class="menu-drawer__social-link" href="https://www.instagram.com/soundbrenner" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
          {{ 'icon-instagram.svg' | inline_asset_content }}
        </a>
        <a class="menu-drawer__social-link" href="https://www.facebook.com/soundbrenner" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
          {{ 'icon-facebook.svg' | inline_asset_content }}
        </a>
        <a class="menu-drawer__social-link" href="https://www.tiktok.com/@soundbrenner" target="_blank" rel="noopener noreferrer" aria-label="TikTok">
          {{ 'icon-tiktok.svg' | inline_asset_content }}
        </a>
        <a class="menu-drawer__social-link" href="https://x.com/soundbrenner" target="_blank" rel="noopener noreferrer" aria-label="X">
          {{ 'icon-x.svg' | inline_asset_content }}
        </a>
        <a class="menu-drawer__social-link" href="https://www.youtube.com/soundbrenner" target="_blank" rel="noopener noreferrer" aria-label="YouTube">
          {{ 'icon-youtube.svg' | inline_asset_content }}
        </a>
      </div>
    </nav>
  </div>
  <button
    class="menu-drawer__backdrop menu-drawer__backdrop--local"
    type="button"
    aria-label="Close menu"
    data-mobile-menu-close
  ></button>
</div>
<div class="header__mega-backdrop header__mega-backdrop--top" data-header-mega-backdrop="top" aria-hidden="true"></div>
<div
  class="header__mega-backdrop header__mega-backdrop--bottom"
  data-header-mega-backdrop="bottom"
  aria-hidden="true"
></div>

<div class="header__cart-drawer" data-cart-drawer hidden>
  <div class="header__cart-drawer-backdrop" data-cart-drawer-close></div>
  <aside class="header__cart-drawer-panel" role="dialog" aria-modal="true" aria-label="Cart drawer">
    <div class="header__cart-drawer-header">
      <h3 class="header__cart-drawer-title">Your cart</h3>
      <button type="button" class="header__cart-drawer-close" data-cart-drawer-close aria-label="Close cart">Close</button>
    </div>
    <p class="header__cart-drawer-status" data-cart-drawer-status>Loading cart...</p>
    <ul class="header__cart-drawer-items" data-cart-drawer-items></ul>
    <div class="header__cart-drawer-actions">
      <button type="button" class="header__cart-drawer-action" data-cart-drawer-refresh>Refresh</button>
      <button type="button" class="header__cart-drawer-action" data-cart-drawer-clear>Clear cart</button>
      <a class="header__cart-drawer-action" href="{{ routes.cart_url }}">View cart</a>
      <a class="header__cart-drawer-action" href="/checkout">Checkout</a>
    </div>
  </aside>
</div>

{% stylesheet %}
  .header {
    --sb-header-height: calc(var(--sb-space-48) + var(--sb-space-12));
    --sb-announcement-min-height: 0px;
    --sb-announcement-row-gap: 6px;
    background-color: var(--sb-color-neutral-200);
    border-bottom: 1px solid var(--sb-color-neutral-600);
    left: 0;
    position: fixed;
    right: 0;
    top: 0;
    transform: translateY(0);
    transition: none;
    z-index: 50;
  }

  .header.has-announcement {
    --sb-announcement-min-height: 42px;
  }

  .header__announcement {
    align-items: center;
    background: var(--sb-announcement-background, var(--sb-gradient-default-1));
    display: flex;
    justify-content: center;
    min-height: var(--sb-announcement-min-height);
    padding: var(--sb-space-8) var(--page-margin, 16px);
    width: 100%;
  }

  .header__announcement-content {
    align-items: center;
    display: flex;
    flex-direction: column;
    gap: var(--sb-announcement-row-gap);
    max-width: calc(100% - ((var(--sb-space-20) + var(--sb-space-16)) * 2));
    position: relative;
    width: fit-content;
  }

  .header__announcement-emojis {
    align-items: center;
    display: flex;
    inset: 0 calc(-1 * (var(--sb-space-20) + var(--sb-space-16)));
    justify-content: space-between;
    pointer-events: none;
    position: absolute;
  }

  .header__announcement-top {
    display: block;
    width: 100%;
  }

  .header__announcement-emoji {
    align-items: center;
    display: inline-flex;
    flex: 0 0 auto;
    height: var(--sb-space-20);
    justify-content: center;
    overflow: hidden;
    width: var(--sb-space-20);
  }

  .header__announcement-emoji img {
    display: block;
    height: 100%;
    width: 100%;
  }

  .header__announcement-text {
    color: var(--sb-color-always-white);
    margin: 0;
    max-width: 100%;
    min-width: 0;
    text-align: center;
    white-space: normal;
    word-break: break-word;
  }

  .header__announcement-countdown {
    align-items: center;
    display: flex;
    flex-wrap: wrap;
    gap: var(--sb-space-12);
    justify-content: center;
    width: 100%;
  }

  .header__announcement-countdown[hidden] {
    display: none;
  }

  .header__announcement-countdown-group {
    align-items: center;
    color: var(--sb-color-always-white);
    display: inline-flex;
    gap: var(--sb-space-6);
  }

  .header__announcement-countdown-value {
    align-items: center;
    background: var(--sb-color-always-black-25);
    box-sizing: border-box;
    border-radius: 4px;
    display: inline-flex;
    font-variant-numeric: tabular-nums;
    justify-content: center;
    line-height: 1;
    min-width: var(--sb-space-24);
    padding: var(--sb-space-2);
    text-align: center;
    width: var(--sb-space-24);
  }

  .header__announcement-countdown-label {
    color: var(--sb-color-always-white);
    line-height: 1;
  }

  .header.is-hidden {
    transform: translateY(-100%);
  }

  .header__inner {
    align-items: center;
    background-color: var(--sb-color-neutral-200);
    display: flex;
    height: var(--sb-header-height);
    justify-content: space-between;
    margin-inline: auto;
    max-width: var(--page-width, 1240px);
    position: relative;
    width: min(
      var(--page-width, 1240px),
      calc(100% - (var(--page-margin, 16px) * 2))
    );
    z-index: 1;
  }

  .header a {
    text-decoration: none;
  }

  .header__brand {
    align-items: center;
    color: var(--sb-color-neutral-900);
    display: inline-flex;
    line-height: 0;
    position: relative;
    z-index: 1;
  }

  .header__brand:hover,
  .header__brand:focus-visible {
    color: var(--sb-color-primary-500);
  }

  .header__brand-logo {
    display: inline-flex;
    height: var(--sb-space-36);
    width: auto;
  }

  .header__brand-logo svg {
    display: block;
    height: 100%;
    width: auto;
  }

  .header__menu {
    align-items: center;
    display: flex;
    gap: var(--sb-space-24);
    justify-content: center;
    left: 50%;
    min-width: calc((var(--sb-space-128) * 4) + var(--sb-space-64) + var(--sb-space-24));
    position: absolute;
    top: 50%;
    transform: translate(-50%, -50%);
    white-space: nowrap;
    width: fit-content;
    z-index: 1;
  }

  .header__menu-item {
    align-items: center;
    display: inline-flex;
  }

  .header__menu-link {
    align-items: center;
    color: var(--sb-color-neutral-900);
    display: inline-flex;
    justify-content: center;
    line-height: 1;
    min-height: var(--sb-space-36);
    position: relative;
    z-index: 2;
  }

  .header__menu-link:hover,
  .header__menu-link:focus-visible {
    color: var(--sb-color-primary-500);
  }

  .header__menu-link.is-active {
    color: var(--sb-color-primary-500);
  }

  .header__mega-menu {
    --sb-mega-max-width: min(
      calc(100vw - (var(--page-margin, 16px) * 2)),
      var(--page-width, 1240px)
    );
    --sb-mega-card-width: calc(
      (
        var(--sb-mega-max-width)
        - (var(--sb-space-36) * 3)
        - (var(--sb-space-64) * 2)
      ) / 4
    );
    --sb-mega-min-width: calc((var(--sb-space-128) * 4) + var(--sb-space-64) + var(--sb-space-24));
    left: 50%;
    border-radius: var(--sb-space-24);
    display: grid;
    grid-template-rows: 0fr;
    pointer-events: none;
    position: absolute;
    top: calc(100% + var(--sb-space-16) + ((var(--sb-header-height) - var(--sb-space-36)) / 2));
    transform: translate(-50%, 0);
    min-width: min(var(--sb-mega-max-width), var(--sb-mega-min-width));
    width: min(
      var(--sb-mega-max-width),
      calc(
        (var(--sb-mega-card-width) * var(--sb-mega-columns, 4))
        + (var(--sb-space-36) * (var(--sb-mega-columns, 4) - 1))
        + (var(--sb-space-64) * 2)
      )
    );
    isolation: isolate;
    z-index: 0;
    transition: grid-template-rows 460ms cubic-bezier(0.22, 1, 0.36, 1);
  }

  .header__menu-item.has-dropdown.is-open > .header__mega-menu {
    grid-template-rows: 1fr;
    pointer-events: auto;
  }

  .header.is-mega-switching .header__menu-item.has-dropdown:not(.is-open) > .header__mega-menu {
    transition-duration: 0s;
    transition-delay: 0s;
    grid-template-rows: 0fr;
  }

  .header.is-mega-switching .header__menu-item.has-dropdown.is-open > .header__mega-menu {
    grid-template-rows: 1fr;
    transition: width 460ms cubic-bezier(0.22, 1, 0.36, 1);
  }

  .header__mega-menu-panel {
    background: var(--sb-color-neutral-200);
    border-radius: var(--sb-space-24);
    box-shadow: 0 var(--sb-space-48) var(--sb-space-48) 0 var(--sb-color-always-black-50, rgba(0, 0, 0, 0.5));
    overflow: hidden;
    min-height: 0;
    position: relative;
    white-space: normal;
    z-index: 1;
  }

  .header__mega-menu-panel-inner {
    padding: var(--sb-space-36) var(--sb-space-64) var(--sb-space-48);
  }

  .header__mega-menu-grid {
    display: grid;
    margin-top: var(--sb-space-36);
    gap: var(--sb-space-36);
    grid-template-columns: repeat(var(--sb-mega-columns, 4), minmax(0, 1fr));
    justify-content: center;
  }

  .header__mega-menu-title {
    align-items: center;
    color: var(--sb-color-neutral-900);
    display: flex;
    justify-content: center;
    margin: 0 auto;
    text-align: center;
    width: fit-content;
  }

  .header__mega-menu-title:hover,
  .header__mega-menu-title:focus-visible {
    color: var(--sb-color-primary-500);
  }

  .header__mega-card {
    min-width: 0;
    width: min(100%, var(--sb-mega-card-width));
    justify-self: center;
  }

  .header__mega-card-media {
    border-radius: var(--sb-space-24);
    display: block;
    overflow: hidden;
    position: relative;
    transform: scale(1);
    transform-origin: center center;
    transition: transform 220ms ease;
  }

  .header__mega-card-image {
    aspect-ratio: 1 / 1;
    display: block;
    height: auto;
    object-fit: cover;
    width: 100%;
  }

  .header__mega-card-media:hover,
  .header__mega-card-media:focus-visible {
    transform: scale(1.015);
  }

  .header__mega-card-badge {
    border-radius: var(--sb-space-12);
    color: var(--sb-color-always-white);
    left: var(--sb-space-16);
    padding: var(--sb-space-8) var(--sb-space-12);
    position: absolute;
    top: var(--sb-space-16);
    z-index: 1;
  }

  .header__mega-card-badge--bestseller {
    background: var(--sb-color-red-500);
  }

  .header__mega-card-badge--new {
    background: var(--sb-color-primary-500);
  }

  .header__mega-card-title {
    margin: var(--sb-space-20) 0 0;
  }

  .header__mega-card-title-link {
    color: var(--sb-color-neutral-900);
    overflow-wrap: normal;
  }

  .header__mega-card-title-link:hover,
  .header__mega-card-title-link:focus-visible {
    color: var(--sb-color-primary-500);
  }

  .header__mega-card-body {
    color: var(--sb-color-neutral-900);
    margin: var(--sb-space-12) 0 0;
    overflow-wrap: anywhere;
  }

  .header__mega-card-links {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-20);
    list-style: none;
    margin: var(--sb-space-20) 0 0;
    padding: 0;
  }

  .header__mega-card-links a {
    color: var(--sb-color-neutral-900);
    overflow-wrap: anywhere;
  }

  .header__mega-card-links a:hover,
  .header__mega-card-links a:focus-visible {
    color: var(--sb-color-primary-500);
  }

  .header__mega-card-app {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-6);
    margin-top: var(--sb-space-12);
  }

  .header__mega-card-rating {
    align-items: center;
    color: var(--sb-color-neutral-900);
    display: flex;
    gap: var(--sb-space-12);
    margin: 0;
  }

  .header__mega-card-rating-count {
    color: var(--sb-color-neutral-900);
    margin: 0;
  }

  .header__mega-card-stars {
    display: inline-flex;
    gap: var(--sb-space-4);
    line-height: 0;
    transform: translateY(calc(-1 * var(--sb-space-2)));
  }

  .header__mega-card-star {
    display: inline-block;
    height: var(--sb-space-20);
    position: relative;
    width: var(--sb-space-20);
  }

  .header__mega-card-star::before,
  .header__mega-card-star::after {
    content: '';
    display: block;
    left: 0;
    height: 100%;
    mask: center / contain no-repeat var(--sb-star-icon-url);
    overflow: hidden;
    position: absolute;
    top: 0;
    width: 100%;
    -webkit-mask: center / contain no-repeat var(--sb-star-icon-url);
  }

  .header__mega-card-star::before {
    background: var(--sb-color-neutral-900);
    opacity: 0.5;
  }

  .header__mega-card-star::after {
    background: var(--sb-color-neutral-900);
    clip-path: inset(0 calc(100% - var(--sb-star-fill)) 0 0);
    -webkit-clip-path: inset(0 calc(100% - var(--sb-star-fill)) 0 0);
  }

  .header__mega-card-app-links {
    align-items: flex-start;
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-20);
    margin-top: var(--sb-space-20);
  }

  .header__mega-card-app-links a {
    align-self: flex-start;
    display: inline-flex;
    line-height: 0;
    width: fit-content;
  }

  .header__mega-card-app-links a:hover,
  .header__mega-card-app-links a:focus-visible {
    opacity: 0.75;
  }

  .header__mega-card-app-links img {
    display: block;
    height: var(--sb-space-30);
    width: auto;
  }

  .header__icons {
    align-items: center;
    display: flex;
    gap: var(--sb-space-16);
    margin-left: auto;
    position: relative;
    z-index: 2;
  }

  .header__icons--left {
    display: none;
    margin-left: 0;
    z-index: 3;
  }

  .header__icon-link {
    align-items: center;
    background: transparent;
    border: 0;
    color: var(--sb-color-neutral-900);
    cursor: pointer;
    display: inline-flex;
    justify-content: center;
    line-height: 0;
    padding: 0;
    position: relative;
    text-decoration: none;
  }

  .header__icon-link:hover,
  .header__icon-link:focus-visible {
    color: var(--sb-color-primary-500);
  }

  .header__icon-asset {
    align-items: center;
    display: inline-flex;
    height: var(--sb-space-24);
    justify-content: center;
    width: var(--sb-space-24);
  }

  .header__icon-asset svg,
  .header__icon-asset img {
    display: block;
    height: 100%;
    width: 100%;
  }

  .header__icon-link--menu svg [fill] {
    fill: currentColor;
  }

  .header__icon-link--search svg [fill] {
    fill: currentColor;
  }

  .header__icon-link--account svg [fill] {
    fill: currentColor;
  }

  .header__icon-link--cart svg [fill] {
    fill: currentColor;
  }

  .header [data-header-cart-link] {
    align-items: center;
    display: inline-flex;
  }

  .header [data-header-cart-link]:hover,
  .header [data-header-cart-link]:focus-visible {
    color: var(--sb-color-primary-500);
  }

  .header__cart-count-badge {
    align-items: center;
    background: var(--sb-color-primary-500);
    border: 1px solid var(--sb-color-neutral-200);
    border-radius: 999px;
    box-sizing: border-box;
    color: var(--sb-color-always-white);
    display: inline-flex;
    height: var(--sb-space-20);
    justify-content: center;
    min-width: var(--sb-space-20);
    padding: 0 var(--sb-space-4);
    position: absolute;
    right: calc(-1 * var(--sb-space-6));
    top: calc(-1 * var(--sb-space-6));
    transform: scale(1);
    transform-origin: center;
    z-index: 1;
  }

  .header__cart-count-badge[hidden] {
    display: none;
  }

  .header__cart-count-badge.is-double-digit {
    padding: 0 var(--sb-space-6);
  }

  .header__cart-count-badge.is-bump {
    animation: header-cart-badge-bump 420ms cubic-bezier(0.2, 0.9, 0.2, 1.15);
  }

  @keyframes header-cart-badge-bump {
    0% {
      transform: scale(0.72);
    }
    55% {
      transform: scale(1.18);
    }
    100% {
      transform: scale(1);
    }
  }

  .menu-drawer-container {
    --sb-drawer-animation-speed: 320ms;
    inset: 0;
    pointer-events: none;
    position: fixed;
    z-index: 78;
  }

  .menu-drawer-container.menu-open {
    pointer-events: auto;
  }

  .menu-drawer__menu-container > summary {
    list-style: none;
  }

  .menu-drawer__menu-container > summary::-webkit-details-marker {
    display: none;
  }

  .menu-drawer {
    --sb-drawer-close-offset-top: var(--sb-space-20);
    --sb-drawer-close-offset-inline: var(--sb-space-20);
    --sb-drawer-close-size: var(--sb-space-30);
    --sb-drawer-navigation-top-padding: calc(var(--sb-drawer-close-offset-top) + var(--sb-drawer-close-size) + var(--sb-space-20));
    background: var(--sb-color-neutral-200);
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    height: 100dvh;
    left: 0;
    max-width: 500px;
    opacity: 0;
    overflow: hidden;
    overscroll-behavior: contain;
    padding: 0;
    position: fixed;
    top: 0;
    transform: translateX(-100%);
    transition:
      transform var(--sb-drawer-animation-speed) ease,
      visibility var(--sb-drawer-animation-speed) ease,
      opacity var(--sb-drawer-animation-speed) ease;
    visibility: hidden;
    width: min(100vw, 500px);
    box-shadow: 0 var(--sb-space-4) var(--sb-space-20) 0 var(--sb-color-primary-500);
    z-index: 79;
    -webkit-overflow-scrolling: touch;
  }

  .menu-drawer__backdrop {
    -webkit-backdrop-filter: brightness(0.75);
    backdrop-filter: brightness(0.75);
    background: var(--sb-color-always-black-25);
    border: 0;
    inset: 0;
    opacity: 0;
    pointer-events: none;
    position: fixed;
    transition: opacity var(--sb-drawer-animation-speed) ease;
    z-index: 78;
  }

  .menu-drawer-container.menu-open > .menu-drawer {
    opacity: 1;
    transform: translateX(0);
    visibility: visible;
  }

  .menu-drawer-container.menu-open > .menu-drawer__backdrop {
    opacity: 1;
    pointer-events: auto;
  }

  .menu-drawer__backdrop--local {
    display: block;
  }

  html.sb-scroll-locked,
  body.sb-scroll-locked {
    overflow: hidden;
    overscroll-behavior: none;
  }

  .menu-drawer__close-button {
    align-items: center;
    background: transparent;
    border: 0;
    cursor: pointer;
    display: inline-flex;
    flex: 0 0 auto;
    height: var(--sb-space-30);
    justify-content: center;
    left: var(--sb-drawer-close-offset-inline);
    margin: 0;
    padding: 0;
    position: absolute;
    top: var(--sb-drawer-close-offset-top);
    width: var(--sb-space-30);
    z-index: 2;
  }

  .menu-drawer__close-icon-circle,
  .menu-drawer__close-icon-x {
    display: inline-flex;
    inset: 0;
    position: absolute;
  }

  .menu-drawer__close-icon-circle {
    color: var(--sb-color-neutral-800);
  }

  .menu-drawer__close-icon-x {
    color: var(--sb-color-neutral-100);
  }

  .menu-drawer__close-button:hover .menu-drawer__close-icon-x,
  .menu-drawer__close-button:focus-visible .menu-drawer__close-icon-x {
    color: var(--sb-color-primary-500);
  }

  .menu-drawer__close-icon-circle svg,
  .menu-drawer__close-icon-x svg {
    display: block;
    height: var(--sb-space-30);
    width: var(--sb-space-30);
  }

  .menu-drawer__navigation {
    flex: 1 1 auto;
    min-height: 0;
    overflow-x: hidden;
    overflow-y: auto;
    overscroll-behavior: contain;
    padding: var(--sb-drawer-navigation-top-padding) 0 var(--sb-space-24);
    -webkit-overflow-scrolling: touch;
  }

  .menu-drawer__menu {
    list-style: none;
    margin: 0;
    padding: 0 var(--sb-space-20);
  }

  .menu-drawer__menu.has-submenu {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .menu-drawer__menu.has-submenu::after {
    background: var(--sb-color-neutral-600);
    content: '';
    display: block;
    height: 1px;
  }

  .menu-drawer__list-item {
    gap: var(--sb-space-20);
    display: flex;
    flex-direction: column;
    min-height: 0;
    padding: var(--sb-space-20) 0;
  }

  .menu-drawer__list-item + .menu-drawer__list-item {
    border-top: 1px solid var(--sb-color-neutral-600);
  }

  .menu-drawer__menu-item {
    align-items: center;
    background: transparent;
    border: 0;
    color: var(--sb-color-neutral-900);
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    min-height: 0;
    padding: 0;
    text-align: left;
    text-decoration: none;
    width: 100%;
  }

  .menu-drawer__menu-item:hover,
  .menu-drawer__menu-item:focus-visible {
    color: var(--sb-color-neutral-900);
  }

  .menu-drawer__menu-container > .menu-drawer__menu-item:hover,
  .menu-drawer__menu-container > .menu-drawer__menu-item:focus-visible {
    color: var(--sb-color-neutral-900);
  }

  .menu-drawer__list-item > a.menu-drawer__menu-item:hover,
  .menu-drawer__list-item > a.menu-drawer__menu-item:focus-visible {
    color: var(--sb-color-primary-500);
  }

  .menu-drawer__menu-item--mainlist {
    min-height: var(--sb-space-20);
  }

  .menu-drawer__menu-item-text {
    min-width: 0;
  }

  .menu-drawer__menu-item-indicator {
    color: var(--sb-color-primary-500);
    display: inline-flex;
    flex: 0 0 auto;
    height: var(--sb-space-20);
    line-height: 0;
    position: relative;
    width: var(--sb-space-20);
  }

  .menu-drawer__menu-item-indicator svg {
    display: block;
    height: var(--sb-space-20);
    width: var(--sb-space-20);
  }

  .menu-drawer__menu-item-indicator svg path:not([fill='none']),
  .menu-drawer__menu-item-indicator svg circle:not([fill='none']),
  .menu-drawer__menu-item-indicator svg rect:not([fill='none']) {
    fill: currentColor !important;
  }

  .menu-drawer__menu-item-indicator svg path:not([stroke='none']),
  .menu-drawer__menu-item-indicator svg circle:not([stroke='none']),
  .menu-drawer__menu-item-indicator svg rect:not([stroke='none']) {
    stroke: currentColor !important;
  }

  .menu-drawer__menu-item-indicator-plus,
  .menu-drawer__menu-item-indicator-close {
    display: inline-flex;
    inset: 0;
    position: absolute;
    transition:
      opacity 220ms ease,
      transform 260ms cubic-bezier(0.22, 1, 0.36, 1);
  }

  .menu-drawer__menu-item-indicator-plus {
    opacity: 1;
    transform: rotate(0deg) scale(1);
  }

  .menu-drawer__menu-item-indicator-close {
    opacity: 0;
    transform: rotate(-90deg) scale(0.85);
  }

  .menu-drawer__menu-container[open] > .menu-drawer__menu-item .menu-drawer__menu-item-indicator-plus {
    opacity: 0;
    transform: rotate(90deg) scale(0.85);
  }

  .menu-drawer__menu-container[open] > .menu-drawer__menu-item .menu-drawer__menu-item-indicator-close {
    opacity: 1;
    transform: rotate(0deg) scale(1);
  }

  .menu-drawer__menu--childlist {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-20);
    margin-top: var(--sb-space-20);
    padding: 0;
  }

  .menu-drawer__trustpilot {
    align-items: center;
    background: var(--sb-color-neutral-100);
    border-radius: 12px;
    color: var(--sb-color-neutral-900);
    display: flex;
    gap: var(--sb-space-24);
    justify-content: center;
    margin: var(--sb-space-20);
    padding: var(--sb-space-20);
  }

  .menu-drawer__trustpilot-link {
    align-items: center;
    color: inherit;
    display: inline-flex;
    text-decoration: none;
  }

  .menu-drawer__trustpilot-link--text {
    line-height: 1;
    white-space: nowrap;
  }

  .menu-drawer__trustpilot-logo,
  .menu-drawer__trustpilot-stars {
    display: inline-flex;
    line-height: 0;
  }

  .menu-drawer__trustpilot-logo svg {
    display: block;
    height: var(--sb-space-30);
    width: auto;
  }

  .menu-drawer__trustpilot-stars svg {
    display: block;
    height: var(--sb-space-20);
    width: auto;
  }

  .menu-drawer__trustpilot-logo svg > g > g path[fill='white'],
  .menu-drawer__trustpilot-stars svg > g > path[fill='white'] {
    fill: currentColor !important;
  }

  .menu-drawer__trustpilot-link--logo:hover .menu-drawer__trustpilot-logo,
  .menu-drawer__trustpilot-link--logo:focus-visible .menu-drawer__trustpilot-logo {
    opacity: 0.75;
  }

  .menu-drawer__trustpilot-link--stars:hover .menu-drawer__trustpilot-stars,
  .menu-drawer__trustpilot-link--stars:focus-visible .menu-drawer__trustpilot-stars {
    opacity: 0.75;
  }

  .menu-drawer__trustpilot-link--text:hover,
  .menu-drawer__trustpilot-link--text:focus-visible {
    text-decoration: underline;
  }

  .menu-drawer__review {
    background: var(--sb-color-neutral-100);
    border-radius: 12px;
    color: var(--sb-color-neutral-900);
    margin: var(--sb-space-20);
    padding: var(--sb-space-20);
  }

  .menu-drawer__review-row {
    align-items: center;
    display: flex;
    flex-wrap: wrap;
    gap: var(--sb-space-24);
    justify-content: center;
  }

  .menu-drawer__review-name {
    color: var(--sb-color-neutral-900);
  }

  .menu-drawer__review-verified {
    align-items: center;
    color: var(--sb-color-primary-500);
    display: inline-flex;
    gap: var(--sb-space-8);
  }

  .menu-drawer__review-verified-icon {
    display: inline-flex;
    line-height: 0;
  }

  .menu-drawer__review-verified-icon svg {
    display: block;
    height: var(--sb-space-20);
    width: var(--sb-space-20);
  }

  .menu-drawer__review-verified-icon svg path:not([fill='none']),
  .menu-drawer__review-verified-icon svg circle:not([fill='none']),
  .menu-drawer__review-verified-icon svg rect:not([fill='none']) {
    fill: currentColor !important;
  }

  .menu-drawer__review-stars {
    color: var(--sb-color-reviews);
    display: inline-flex;
    gap: 4px;
    line-height: 0;
  }

  .menu-drawer__review-star {
    background: currentColor;
    display: inline-block;
    height: var(--sb-space-16);
    mask: center / contain no-repeat var(--sb-review-star-icon-url);
    width: var(--sb-space-16);
    -webkit-mask: center / contain no-repeat var(--sb-review-star-icon-url);
  }

  .menu-drawer__review-text {
    color: var(--sb-color-neutral-900);
    margin: var(--sb-space-16) 0 0;
    text-align: center;
  }

  .menu-drawer__review-date {
    color: var(--sb-color-neutral-800);
    margin: var(--sb-space-16) 0 0;
    text-align: center;
  }

  .menu-drawer__social {
    align-items: center;
    background: var(--sb-color-neutral-100);
    border-radius: 12px;
    display: flex;
    gap: var(--sb-space-36);
    justify-content: center;
    margin: var(--sb-space-20);
    padding: var(--sb-space-20);
  }

  .menu-drawer__social-link {
    color: var(--sb-color-neutral-900);
    display: inline-flex;
    line-height: 0;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .menu-drawer__social-link:hover,
  .menu-drawer__social-link:focus-visible {
    color: var(--sb-color-neutral-900-75);
    text-decoration: none;
  }

  .menu-drawer__social-link svg {
    display: block;
    height: var(--sb-space-30);
    width: auto;
  }

  .menu-drawer__social-link svg path:not([fill='none']),
  .menu-drawer__social-link svg circle:not([fill='none']),
  .menu-drawer__social-link svg rect:not([fill='none']) {
    fill: currentColor !important;
  }

  .menu-drawer__submenu-item {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-12);
  }

  .menu-drawer__submenu-card {
    align-items: stretch;
    background: var(--sb-color-neutral-100);
    border-radius: 12px;
    color: var(--sb-color-neutral-900);
    display: flex;
    gap: var(--sb-space-20);
    min-height: var(--sb-space-128);
    overflow: visible;
    position: relative;
    text-decoration: none;
  }

  .menu-drawer__submenu-card--app {
    height: var(--sb-space-128);
  }

  .menu-drawer__submenu-item > .menu-drawer__submenu-card + .menu-drawer__submenu-card {
    margin-top: var(--sb-space-12);
  }

  .menu-drawer__submenu-item > .menu-drawer__submenu-card + .menu-drawer__submenu-card.menu-drawer__submenu-card--has-badge {
    margin-top: var(--sb-space-24);
  }

  .menu-drawer__submenu-card:hover,
  .menu-drawer__submenu-card:focus-visible {
    background: var(--sb-color-neutral-300);
    color: var(--sb-color-neutral-900);
  }

  .menu-drawer__submenu-media {
    border-bottom-left-radius: 12px;
    border-top-left-radius: 12px;
    display: block;
    flex: 0 0 var(--sb-space-128);
    height: var(--sb-space-128);
    overflow: hidden;
    position: relative;
    width: var(--sb-space-128);
  }

  .menu-drawer__submenu-card--has-badge {
    --sb-submenu-card-border-color: transparent;
    margin-top: calc(var(--sb-space-12) + var(--sb-space-2));
  }

  .menu-drawer__submenu-card--has-badge::after {
    border: 2px solid var(--sb-submenu-card-border-color);
    border-radius: 12px;
    box-sizing: border-box;
    content: '';
    inset: 0;
    pointer-events: none;
    position: absolute;
    z-index: 1;
  }

  .menu-drawer__submenu-card--bestseller {
    --sb-submenu-card-border-color: var(--sb-color-red-500);
  }

  .menu-drawer__submenu-card--new {
    --sb-submenu-card-border-color: var(--sb-color-primary-500);
  }

  .menu-drawer__submenu-image {
    display: block;
    height: 100%;
    object-fit: cover;
    width: 100%;
  }

  .menu-drawer__submenu-badge {
    border-radius: 12px;
    color: var(--sb-color-always-white);
    padding: var(--sb-space-8) var(--sb-space-12);
    position: absolute;
    right: var(--sb-space-16);
    top: var(--sb-space-2);
    transform: translateY(-50%);
    z-index: 3;
  }

  .menu-drawer__submenu-badge--bestseller {
    background: var(--sb-color-red-500);
  }

  .menu-drawer__submenu-badge--new {
    background: var(--sb-color-primary-500);
  }

  .menu-drawer__submenu-copy {
    align-items: flex-start;
    display: flex;
    flex: 1 1 auto;
    flex-direction: column;
    gap: var(--sb-space-8);
    justify-content: center;
    min-width: 0;
    padding: var(--sb-space-20) var(--sb-space-20) var(--sb-space-20) 0;
  }

  .menu-drawer__submenu-card--app .menu-drawer__submenu-copy {
    align-items: flex-start;
    gap: 0;
    justify-content: center;
    padding: 0 var(--sb-space-20) 0 0;
    text-align: left;
  }

  .menu-drawer__submenu-title {
    color: currentColor;
    margin: 0;
  }

  .menu-drawer__submenu-body {
    color: currentColor;
    display: -webkit-box;
    margin: 0;
    overflow: hidden;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
  }

  .menu-drawer__app-rating {
    align-items: center;
    color: currentColor;
    display: flex;
    gap: var(--sb-space-8);
    line-height: 1;
    margin: var(--sb-space-8) 0 0;
  }

  .menu-drawer__submenu-card--app .menu-drawer__app-rating {
    justify-content: flex-start;
  }

  .menu-drawer__app-stars {
    display: inline-flex;
    gap: var(--sb-space-8);
    line-height: 0;
    padding-bottom: var(--sb-space-4);
    transform: translateY(var(--sb-space-4));
  }

  .menu-drawer__app-star {
    display: inline-block;
    height: var(--sb-space-16);
    position: relative;
    width: var(--sb-space-16);
  }

  .menu-drawer__app-star::before,
  .menu-drawer__app-star::after {
    content: '';
    display: block;
    height: 100%;
    left: 0;
    mask: center / contain no-repeat var(--sb-star-icon-url);
    position: absolute;
    top: 0;
    width: 100%;
    -webkit-mask: center / contain no-repeat var(--sb-star-icon-url);
  }

  .menu-drawer__app-star::before {
    background: currentColor;
    opacity: 0.5;
  }

  .menu-drawer__app-star::after {
    background: currentColor;
    clip-path: inset(0 calc(100% - var(--sb-star-fill)) 0 0);
    -webkit-clip-path: inset(0 calc(100% - var(--sb-star-fill)) 0 0);
  }

  .menu-drawer__app-rating-count {
    color: currentColor;
    margin: var(--sb-space-8) 0 0;
  }

  .menu-drawer__submenu-secondary {
    align-items: center;
    background: var(--sb-color-neutral-100);
    box-sizing: border-box;
    border-radius: 12px;
    color: var(--sb-color-neutral-900);
    display: flex;
    margin-left: var(--sb-space-128);
    min-height: var(--sb-space-48);
    padding: 0 var(--sb-space-20);
    text-decoration: none;
    width: calc(100% - var(--sb-space-128));
  }

  .menu-drawer__submenu-secondary:hover,
  .menu-drawer__submenu-secondary:focus-visible {
    background: var(--sb-color-neutral-300);
    color: var(--sb-color-neutral-900);
  }

  .menu-drawer__submenu-store {
    align-items: center;
    display: flex;
    height: var(--sb-space-48);
    justify-content: space-between;
    min-height: var(--sb-space-48);
  }

  .menu-drawer__submenu-store-badge {
    align-items: center;
    display: inline-flex;
    flex: 0 0 auto;
    height: var(--sb-space-30);
    justify-content: center;
  }

  .menu-drawer__submenu-store-badge img {
    display: block;
    height: var(--sb-space-30);
    width: auto;
  }

  .menu-drawer-container.menu-open .menu-drawer__animated-element {
    animation: menu-drawer-nav-open var(--sb-drawer-animation-speed) ease-in-out;
    animation-delay: calc(var(--sb-drawer-animation-speed) + (var(--menu-drawer-animation-index, 1) - 1) * 100ms);
    animation-fill-mode: backwards;
  }

  @keyframes menu-drawer-nav-open {
    0% {
      visibility: hidden;
      opacity: 0;
      transform: translateX(calc(-1 * var(--sb-space-8)));
    }

    100% {
      visibility: visible;
      opacity: 1;
      transform: translateX(0);
    }
  }

  @media screen and (max-width: 989px) {
    .header {
      transform: none;
    }

    .header.is-hidden {
      transform: none;
      top: calc(-1 * (var(--sb-header-height) + var(--sb-announcement-min-height)));
    }

    .header__inner {
      justify-content: space-between;
    }

    .header__brand {
      left: 50%;
      position: absolute;
      transform: translateX(-50%);
    }

    .header__menu {
      display: none;
    }

    .header__mega-menu {
      display: none;
    }

    .header__icons--left {
      display: flex;
    }

    .header__icons--right .header__icon-link--desktop-only {
      display: none;
    }
  }

  .header__mega-backdrop {
    opacity: 0;
    pointer-events: none;
    position: fixed;
    transition: opacity 180ms ease;
    z-index: 49;
  }

  @media screen and (min-width: 990px) {
    .header__mega-backdrop {
      -webkit-backdrop-filter: blur(var(--sb-space-8));
      backdrop-filter: blur(var(--sb-space-8));
      background: var(--sb-color-always-black-25);
      left: 0;
      right: 0;
    }

    .header__mega-backdrop--top {
      top: 0;
    }

    .header__mega-backdrop--bottom {
      bottom: 0;
    }

    .header__mega-backdrop.is-active {
      opacity: 1;
    }
  }

  .header .header__cart-drawer-action,
  .header .header__cart-drawer-close {
    align-items: center;
    background: transparent;
    border: 1px solid var(--sb-color-neutral-600);
    border-radius: 999px;
    color: var(--sb-color-neutral-900);
    cursor: pointer;
    display: inline-flex;
    font: inherit;
    min-height: var(--sb-space-36);
    padding: 0 var(--sb-space-12);
  }

  .header__cart-drawer {
    inset: 0;
    position: fixed;
    z-index: 80;
  }

  .header__cart-drawer[hidden] {
    display: none;
  }

  .header__cart-drawer-backdrop {
    background: var(--sb-color-always-black-25);
    inset: 0;
    position: absolute;
  }

  .header__cart-drawer-panel {
    background: var(--sb-color-neutral-100);
    border-left: 1px solid var(--sb-color-neutral-600);
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-12);
    height: 100%;
    max-width: 420px;
    padding: var(--sb-space-16);
    position: absolute;
    right: 0;
    top: 0;
    width: min(100%, 420px);
  }

  .header__cart-drawer-header {
    align-items: center;
    display: flex;
    justify-content: space-between;
    gap: var(--sb-space-12);
  }

  .header__cart-drawer-title {
    color: var(--sb-color-neutral-900);
    margin: 0;
  }

  .header__cart-drawer-status {
    color: var(--sb-color-neutral-800);
    margin: 0;
  }

  .header__cart-drawer-items {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-8);
    list-style: none;
    margin: 0;
    min-height: 0;
    overflow: auto;
    padding: 0;
    flex: 1 1 auto;
  }

  .header__cart-drawer-item {
    border-bottom: 1px solid var(--sb-color-neutral-600);
    display: flex;
    justify-content: space-between;
    gap: var(--sb-space-12);
    padding: var(--sb-space-8) 0;
  }

  .header__cart-drawer-item-info {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-4);
    min-width: 0;
  }

  .header__cart-drawer-item-title {
    color: var(--sb-color-neutral-900);
    margin: 0;
  }

  .header__cart-drawer-item-variant,
  .header__cart-drawer-item-price {
    color: var(--sb-color-neutral-800);
    margin: 0;
  }

  .header__cart-drawer-item-qty {
    color: var(--sb-color-neutral-900);
    white-space: nowrap;
  }

  .header__cart-drawer-actions {
    display: flex;
    flex-wrap: wrap;
    gap: var(--sb-space-8);
  }

  .header__cart-drawer-action {
    text-decoration: none;
  }

  .shopify-section:has(> .header) {
    min-height: calc(var(--sb-header-height) + var(--sb-announcement-min-height, 0px));
  }

{% endstylesheet %}

<script>
  (() => {
    const header = document.querySelector('.header');
    if (!header || header.dataset.headerInit === 'true') return;
    header.dataset.headerInit = 'true';

    const mobileMenuDrawer = document.querySelector('[data-mobile-menu-drawer]');
    const mobileMenuToggle = header.querySelector('[data-mobile-menu-toggle]');
    const mobileMenuCloseControls = mobileMenuDrawer
      ? mobileMenuDrawer.querySelectorAll('[data-mobile-menu-close]')
      : [];
    let mobileMenuCloseTimer = null;
    const mobileMenuPreloadedSources = new Set();
    let pageScrollLockY = 0;
    const isDesktopViewport = () => window.matchMedia('(min-width: 990px)').matches;
    const isMobileMenuOpen = () => Boolean(mobileMenuDrawer && mobileMenuDrawer.classList.contains('menu-open'));
    const closeAllMobileAccordions = () => {
      if (!mobileMenuDrawer) return;
      mobileMenuDrawer.querySelectorAll('.menu-drawer__menu-container[open]').forEach((accordion) => {
        accordion.removeAttribute('open');
      });
    };
    const clearMobileMenuCloseTimer = () => {
      if (!mobileMenuCloseTimer) return;
      window.clearTimeout(mobileMenuCloseTimer);
      mobileMenuCloseTimer = null;
    };
    const shouldSkipMobileMenuPreload = () => {
      const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      if (!connection) return false;
      if (connection.saveData) return true;
      const effectiveType = `${connection.effectiveType || ''}`.toLowerCase();
      return effectiveType.includes('2g');
    };
    const preloadMobileMenuImageSource = (source) => {
      if (!source || mobileMenuPreloadedSources.has(source)) return;
      mobileMenuPreloadedSources.add(source);
      const preloadImage = new Image();
      preloadImage.decoding = 'async';
      preloadImage.src = source;
    };
    const preloadMobileMenuImages = () => {
      if (!mobileMenuDrawer || isDesktopViewport() || shouldSkipMobileMenuPreload()) return;
      const imageNodes = mobileMenuDrawer.querySelectorAll('.menu-drawer__submenu-image');
      imageNodes.forEach((imageNode) => {
        const source = imageNode.getAttribute('src');
        preloadMobileMenuImageSource(source);
      });
    };
    const scheduleMobileMenuPreload = () => {
      if (typeof window.requestIdleCallback === 'function') {
        window.requestIdleCallback(() => {
          preloadMobileMenuImages();
        }, { timeout: 1200 });
        return;
      }

      window.setTimeout(() => {
        preloadMobileMenuImages();
      }, 180);
    };
    const syncPageScrollLock = () => {
      const cartDrawerElement = document.querySelector('[data-cart-drawer]');
      const cartOpen = Boolean(cartDrawerElement && !cartDrawerElement.hasAttribute('hidden'));
      const shouldLock = isMobileMenuOpen() || cartOpen;
      if (shouldLock) {
        if (document.body.dataset.sbScrollLocked === 'true') return;
        pageScrollLockY = window.scrollY || window.pageYOffset || 0;
        document.documentElement.classList.add('sb-scroll-locked');
        document.body.classList.add('sb-scroll-locked');
        document.documentElement.style.overflow = 'hidden';
        document.body.style.position = 'fixed';
        document.body.style.top = `-${pageScrollLockY}px`;
        document.body.style.left = '0';
        document.body.style.right = '0';
        document.body.style.width = '100%';
        document.body.dataset.sbScrollLocked = 'true';
        return;
      }

      if (document.body.dataset.sbScrollLocked !== 'true') return;
      document.documentElement.classList.remove('sb-scroll-locked');
      document.body.classList.remove('sb-scroll-locked');
      document.documentElement.style.overflow = '';
      document.body.style.position = '';
      document.body.style.top = '';
      document.body.style.left = '';
      document.body.style.right = '';
      document.body.style.width = '';
      delete document.body.dataset.sbScrollLocked;
      window.scrollTo(0, pageScrollLockY);
    };
    const openMobileMenu = () => {
      if (!mobileMenuDrawer || !mobileMenuToggle || isDesktopViewport()) return;
      clearMobileMenuCloseTimer();
      mobileMenuToggle.setAttribute('aria-expanded', 'true');
      scheduleMobileMenuPreload();
      mobileMenuDrawer.classList.add('menu-open');
      document.body.classList.add('is-mobile-menu-open');
      syncPageScrollLock();
    };
    const closeMobileMenu = ({ immediate = false } = {}) => {
      if (!mobileMenuDrawer || !mobileMenuToggle) return;
      clearMobileMenuCloseTimer();
      mobileMenuDrawer.classList.remove('menu-open');
      mobileMenuToggle.setAttribute('aria-expanded', 'false');
      const finalizeClose = () => {
        closeAllMobileAccordions();
        document.body.classList.remove('is-mobile-menu-open');
        syncPageScrollLock();
      };
      if (immediate) {
        finalizeClose();
        return;
      }
      finalizeClose();
    };

    if (mobileMenuDrawer && mobileMenuToggle) {
      mobileMenuToggle.addEventListener('click', (event) => {
        event.preventDefault();
        if (isMobileMenuOpen()) {
          closeMobileMenu();
        } else {
          openMobileMenu();
        }
      });

      mobileMenuCloseControls.forEach((control) => {
        control.addEventListener('click', () => closeMobileMenu());
      });

      mobileMenuDrawer.querySelectorAll('.menu-drawer__navigation a').forEach((link) => {
        link.addEventListener('click', () => closeMobileMenu({ immediate: true }));
      });

      mobileMenuDrawer.addEventListener('keyup', (event) => {
        if (event.key !== 'Escape') return;
        closeMobileMenu();
      });

      window.addEventListener(
        'resize',
        () => {
          if (isDesktopViewport()) {
            closeMobileMenu({ immediate: true });
            return;
          }

          scheduleMobileMenuPreload();
        },
        { passive: true }
      );

      const preventBackgroundScroll = (event) => {
        if (!isMobileMenuOpen()) return;
        const withinDrawer = event.target instanceof Element && event.target.closest('.menu-drawer');
        if (withinDrawer) return;
        event.preventDefault();
      };

      document.addEventListener('touchmove', preventBackgroundScroll, { passive: false });
      document.addEventListener('wheel', preventBackgroundScroll, { passive: false });
      scheduleMobileMenuPreload();
    }

    const countdownRoot = header.querySelector('[data-announcement-countdown]');
    if (countdownRoot) {
      const endDateValue = countdownRoot.getAttribute('data-sale-end-date') || '';
      const parseSaleEndTimestamp = (value) => {
        const normalizedValue = `${value || ''}`.trim();
        if (!normalizedValue) return NaN;

        const dateOnlyMatch = normalizedValue.match(/^(\d{4})-(\d{2})-(\d{2})$/);
        if (!dateOnlyMatch) {
          const fallbackTimestamp = Date.parse(normalizedValue);
          return Number.isFinite(fallbackTimestamp) ? fallbackTimestamp : NaN;
        }

        const year = Number.parseInt(dateOnlyMatch[1], 10);
        const monthIndex = Number.parseInt(dateOnlyMatch[2], 10) - 1;
        const day = Number.parseInt(dateOnlyMatch[3], 10);
        const parsedDate = new Date(Date.UTC(year, monthIndex, day));

        if (
          parsedDate.getUTCFullYear() !== year
          || parsedDate.getUTCMonth() !== monthIndex
          || parsedDate.getUTCDate() !== day
        ) {
          return NaN;
        }

        const endOfDayUtcGuess = Date.UTC(year, monthIndex, day, 23, 59, 59);
        if (!window.Intl || typeof Intl.DateTimeFormat !== 'function') {
          return Date.parse(`${normalizedValue}T23:59:59-08:00`);
        }

        const formatter = new Intl.DateTimeFormat('en-US', {
          timeZone: 'America/Los_Angeles',
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          hourCycle: 'h23'
        });

        if (typeof formatter.formatToParts !== 'function') {
          return Date.parse(`${normalizedValue}T23:59:59-08:00`);
        }

        const getOffsetMs = (utcTimestamp) => {
          const parts = formatter.formatToParts(new Date(utcTimestamp));
          const timeParts = {};

          for (const part of parts) {
            if (part.type !== 'literal') timeParts[part.type] = Number.parseInt(part.value, 10);
          }

          const localTimeAsUtc = Date.UTC(
            timeParts.year,
            timeParts.month - 1,
            timeParts.day,
            timeParts.hour,
            timeParts.minute,
            timeParts.second
          );

          return localTimeAsUtc - utcTimestamp;
        };

        let resolvedTimestamp = endOfDayUtcGuess;
        for (let index = 0; index < 4; index += 1) {
          const nextTimestamp = endOfDayUtcGuess - getOffsetMs(resolvedTimestamp);
          if (Math.abs(nextTimestamp - resolvedTimestamp) < 1) break;
          resolvedTimestamp = nextTimestamp;
        }

        return resolvedTimestamp;
      };

      const endTimestamp = parseSaleEndTimestamp(endDateValue);
      const daysValue = countdownRoot.querySelector('[data-countdown-days]');
      const hoursValue = countdownRoot.querySelector('[data-countdown-hours]');
      const minsValue = countdownRoot.querySelector('[data-countdown-mins]');
      const secsValue = countdownRoot.querySelector('[data-countdown-secs]');

      if (!Number.isFinite(endTimestamp) || !daysValue || !hoursValue || !minsValue || !secsValue) {
        countdownRoot.setAttribute('hidden', '');
      } else {
        const formatCountdownValue = (value) => `${Math.min(99, Math.max(0, value))}`.padStart(2, '0');
        const countdownDisplayThresholdSeconds = 5 * 24 * 60 * 60;
        let countdownTimer = null;

        const updateCountdown = () => {
          const remainingSeconds = Math.max(0, Math.floor((endTimestamp - Date.now()) / 1000));
          const shouldShowCountdown = remainingSeconds > 0 && remainingSeconds <= countdownDisplayThresholdSeconds;
          const days = Math.floor(remainingSeconds / 86400);
          const hours = Math.floor((remainingSeconds % 86400) / 3600);
          const mins = Math.floor((remainingSeconds % 3600) / 60);
          const secs = remainingSeconds % 60;

          if (shouldShowCountdown) {
            countdownRoot.removeAttribute('hidden');
          } else {
            countdownRoot.setAttribute('hidden', '');
          }

          daysValue.textContent = formatCountdownValue(days);
          hoursValue.textContent = formatCountdownValue(hours);
          minsValue.textContent = formatCountdownValue(mins);
          secsValue.textContent = formatCountdownValue(secs);

          if (remainingSeconds <= 0 && countdownTimer) {
            window.clearInterval(countdownTimer);
            countdownTimer = null;
          }
        };

        updateCountdown();
        countdownTimer = window.setInterval(updateCountdown, 1000);
      }
    }

    const getWindowY = () => window.scrollY || window.pageYOffset || document.documentElement.scrollTop || 0;
    let lastY = getWindowY();
    const topThreshold = 8;
    const revealAfterUpDistance = 18;
    let upwardTravel = 0;
    let hiddenOffset = 0;
    let topExitMode = lastY <= topThreshold;

    const clamp = (value, min, max) => Math.min(max, Math.max(min, value));
    const headerHeight = () => header.getBoundingClientRect().height || 0;
    const headerSection = header.closest('.shopify-section');
    const syncHeaderSectionMinHeight = () => {
      if (!headerSection) return;
      headerSection.style.minHeight = `${headerHeight()}px`;
    };
    const applyOffset = () => {
      header.style.transform = `translateY(${-hiddenOffset}px)`;
    };
    const captureHeaderState = () => ({
      hiddenOffset,
      topExitMode,
      upwardTravel
    });
    const restoreHeaderState = (state) => {
      if (!state || typeof state !== 'object') return;
      const nextOffset = Number.parseFloat(`${state.hiddenOffset}`);
      hiddenOffset = clamp(Number.isFinite(nextOffset) ? nextOffset : 0, 0, headerHeight());
      topExitMode = typeof state.topExitMode === 'boolean'
        ? state.topExitMode
        : hiddenOffset < headerHeight();
      upwardTravel = 0;
      applyOffset();
      lastY = getWindowY();
    };

    window.SBHeaderNav = {
      ...(window.SBHeaderNav || {}),
      captureState: captureHeaderState,
      restoreState: restoreHeaderState
    };

    let syncMegaBackdropOnScroll = () => {};

    const dropdownMenuItems = header.querySelectorAll('.header__menu-item.has-dropdown');
    const plainMenuItems = header.querySelectorAll('.header__menu-item:not(.has-dropdown)');
    const megaBackdrops = Array.from(document.querySelectorAll('[data-header-mega-backdrop]'));
    if (dropdownMenuItems.length > 0) {
      let activeDropdownItem = null;
      let closeMenuTimer = null;
      let megaSwitchTimer = null;
      let pointerX = 0;
      let pointerY = 0;
      const menuSafePadding = 8;
      const megaSwitchDuration = 460;
      const headerInner = header.querySelector('.header__inner');
      const headerMenu = header.querySelector('.header__menu');
      const dropdownMenuLinks = Array.from(dropdownMenuItems)
        .map((menuItem) => menuItem.querySelector('.header__menu-link'))
        .filter(Boolean);
      const clearCloseMenuTimer = () => {
        if (!closeMenuTimer) return;
        window.clearTimeout(closeMenuTimer);
        closeMenuTimer = null;
      };
      const clearMegaSwitchTimer = () => {
        if (!megaSwitchTimer) return;
        window.clearTimeout(megaSwitchTimer);
        megaSwitchTimer = null;
      };
      const clearMegaSwitchInlineWidths = () => {
        dropdownMenuItems.forEach((menuItem) => {
          const menu = menuItem.querySelector('.header__mega-menu');
          if (!menu) return;
          menu.style.removeProperty('width');
        });
      };
      const endMegaSwitchMode = (menuElement) => {
        if (menuElement) menuElement.style.removeProperty('width');
        header.classList.remove('is-mega-switching');
      };
      const triggerMegaSwitchMode = (fromItem, toItem) => {
        if (!fromItem || !toItem) return;
        const fromMenu = fromItem.querySelector('.header__mega-menu');
        const toMenu = toItem.querySelector('.header__mega-menu');
        if (!fromMenu || !toMenu) return;

        const fromWidth = fromMenu.getBoundingClientRect().width;
        const toWidth = toMenu.getBoundingClientRect().width;
        if (!(fromWidth > 0) || !(toWidth > 0)) return;

        const widthDiff = Math.abs(fromWidth - toWidth);
        if (widthDiff < 1) {
          clearMegaSwitchTimer();
          header.classList.remove('is-mega-switching');
          toMenu.style.removeProperty('width');
          return;
        }

        clearMegaSwitchTimer();
        header.classList.add('is-mega-switching');
        toMenu.style.width = `${fromWidth}px`;
        window.requestAnimationFrame(() => {
          toMenu.style.width = `${toWidth}px`;
        });
        megaSwitchTimer = window.setTimeout(() => {
          endMegaSwitchMode(toMenu);
        }, megaSwitchDuration);
      };
      const syncMegaBackdropTop = () => {
        if (!headerInner || megaBackdrops.length === 0) return;
        const navRect = headerInner.getBoundingClientRect();
        const navTop = Math.max(0, navRect.top);
        const navBottom = Math.min(window.innerHeight, navRect.bottom);
        const visibleNavHeight = Math.max(0, navBottom - navTop);
        const navIsTranslatingOut = hiddenOffset > 0.5;

        // If the header row is fully out of view, remove the nav cutout entirely.
        if (visibleNavHeight <= 1 || navIsTranslatingOut) {
          megaBackdrops.forEach((backdrop) => {
            if (backdrop.dataset.headerMegaBackdrop === 'top') {
              backdrop.style.top = '0px';
              backdrop.style.bottom = '100%';
            } else {
              backdrop.style.top = '0px';
              backdrop.style.bottom = '0px';
            }
          });
          return;
        }

        megaBackdrops.forEach((backdrop) => {
          if (backdrop.dataset.headerMegaBackdrop === 'top') {
            backdrop.style.top = '0px';
            backdrop.style.bottom = `${Math.max(0, window.innerHeight - navTop)}px`;
          } else {
            backdrop.style.top = `${navBottom}px`;
            backdrop.style.bottom = '0px';
          }
        });
      };

      syncMegaBackdropOnScroll = () => {
        if (!header.classList.contains('is-mega-open')) return;
        syncMegaBackdropTop();
      };

      const updateMegaOpenState = () => {
        const isMegaOpen = Boolean(activeDropdownItem);
        if (window.matchMedia('(max-width: 989px)').matches) {
          header.classList.remove('is-mega-open');
          clearMegaSwitchTimer();
          header.classList.remove('is-mega-switching');
          clearMegaSwitchInlineWidths();
          megaBackdrops.forEach((backdrop) => backdrop.classList.remove('is-active'));
          return;
        }
        if (isMegaOpen) {
          header.classList.add('is-mega-open');
          syncMegaBackdropTop();
          megaBackdrops.forEach((backdrop) => backdrop.classList.add('is-active'));
        } else {
          header.classList.remove('is-mega-open');
          megaBackdrops.forEach((backdrop) => backdrop.classList.remove('is-active'));
        }
      };

      const setActiveDropdownItem = (nextItem) => {
        if (activeDropdownItem === nextItem) return;
        if (activeDropdownItem && nextItem) triggerMegaSwitchMode(activeDropdownItem, nextItem);
        else {
          clearMegaSwitchTimer();
          header.classList.remove('is-mega-switching');
          clearMegaSwitchInlineWidths();
        }
        if (activeDropdownItem) activeDropdownItem.classList.remove('is-open');
        activeDropdownItem = nextItem || null;
        if (activeDropdownItem) activeDropdownItem.classList.add('is-open');
        updateMegaOpenState();
      };

      const closeActiveDropdown = () => {
        setActiveDropdownItem(null);
      };

      const getDropdownTrackBounds = () => {
        if (!headerMenu || dropdownMenuLinks.length === 0) return null;
        const menuRect = headerMenu.getBoundingClientRect();
        const firstRect = dropdownMenuLinks[0].getBoundingClientRect();
        const lastRect = dropdownMenuLinks[dropdownMenuLinks.length - 1].getBoundingClientRect();
        return {
          left: firstRect.left,
          right: lastRect.right,
          top: menuRect.top,
          bottom: menuRect.bottom
        };
      };

      const pointerInSafeCorridor = (menuItem) => {
        if (!menuItem || !headerInner) return false;
        const megaMenu = menuItem.querySelector('.header__mega-menu');
        if (!megaMenu) return false;
        const headerInnerRect = headerInner.getBoundingClientRect();
        const menuRect = megaMenu.getBoundingClientRect();
        const corridorTop = Math.min(headerInnerRect.bottom, menuRect.top);
        const corridorBottom = Math.max(headerInnerRect.bottom, menuRect.top);
        // Gap-safe zone follows the actual mega menu width.
        const corridorLeft = menuRect.left;
        const corridorRight = menuRect.right;
        return (
          pointerX >= corridorLeft
          && pointerX <= corridorRight
          && pointerY >= corridorTop
          && pointerY <= corridorBottom
        );
      };

      const pointerInMenuStrip = () => {
        const trackBounds = getDropdownTrackBounds();
        if (!trackBounds) return false;
        return (
          pointerY >= trackBounds.top
          && pointerY <= trackBounds.bottom
          && pointerX >= trackBounds.left - menuSafePadding
          && pointerX <= trackBounds.right + menuSafePadding
        );
      };

      const scheduleCloseActiveDropdown = () => {
        clearCloseMenuTimer();
        closeMenuTimer = window.setTimeout(() => {
          const activeMegaMenu = activeDropdownItem && activeDropdownItem.querySelector('.header__mega-menu');
          const megaHovered = Boolean(activeMegaMenu && activeMegaMenu.matches(':hover'));
          const inSafeCorridor = pointerInSafeCorridor(activeDropdownItem);
          const inMenuStrip = pointerInMenuStrip();
          if (megaHovered || inSafeCorridor || inMenuStrip) {
            scheduleCloseActiveDropdown();
            return;
          }
          closeActiveDropdown();
        }, 120);
      };

      dropdownMenuItems.forEach((menuItem) => {
        const menuLink = menuItem.querySelector('.header__menu-link');
        const megaMenu = menuItem.querySelector('.header__mega-menu');
        if (menuLink) {
          menuLink.addEventListener('mouseenter', () => {
            clearCloseMenuTimer();
            setActiveDropdownItem(menuItem);
          });
        }

        menuItem.addEventListener('focusin', () => {
          clearCloseMenuTimer();
          setActiveDropdownItem(menuItem);
        });

        menuItem.addEventListener('focusout', (event) => {
          if (menuItem.contains(event.relatedTarget)) return;
          window.requestAnimationFrame(() => {
            if (!header.contains(document.activeElement)) closeActiveDropdown();
            else updateMegaOpenState();
          });
        });

        if (megaMenu) {
          megaMenu.addEventListener('mouseenter', () => {
            clearCloseMenuTimer();
            setActiveDropdownItem(menuItem);
          });

          megaMenu.addEventListener('mouseleave', () => {
            scheduleCloseActiveDropdown();
          });
        }
      });

      plainMenuItems.forEach((menuItem) => {
        const menuLink = menuItem.querySelector('.header__menu-link');
        if (!menuLink) return;
        menuLink.addEventListener('mouseenter', () => {
          clearCloseMenuTimer();
          closeActiveDropdown();
        });
      });

      header.addEventListener('mouseenter', () => {
        clearCloseMenuTimer();
      });

      header.addEventListener('mouseleave', () => {
        scheduleCloseActiveDropdown();
      });

      if (headerInner) {
        headerInner.addEventListener('mousemove', (event) => {
          if (!activeDropdownItem) return;
          if (window.matchMedia('(max-width: 989px)').matches) return;
          const trackBounds = getDropdownTrackBounds();
          if (!trackBounds) return;
          const aboveMenuStrip = event.clientY < (trackBounds.top - menuSafePadding);
          if (aboveMenuStrip) {
            clearCloseMenuTimer();
            closeActiveDropdown();
            return;
          }
          const withinMenuBand = event.clientY >= trackBounds.top && event.clientY <= trackBounds.bottom;
          const outsideMenuHorizontally = event.clientX < (trackBounds.left - menuSafePadding)
            || event.clientX > (trackBounds.right + menuSafePadding);
          if (!withinMenuBand || !outsideMenuHorizontally) return;
          clearCloseMenuTimer();
          closeActiveDropdown();
        });
      }

      document.addEventListener('pointerdown', (event) => {
        if (header.contains(event.target)) return;
        clearCloseMenuTimer();
        closeActiveDropdown();
      });

      document.addEventListener(
        'pointermove',
        (event) => {
          pointerX = event.clientX;
          pointerY = event.clientY;
        },
        { passive: true }
      );

      window.addEventListener(
        'resize',
        () => {
          clearCloseMenuTimer();
          closeActiveDropdown();
          syncMegaBackdropTop();
          updateMegaOpenState();
        },
        { passive: true }
      );

      syncMegaBackdropTop();
    }

    const sync = (currentY, { force = false } = {}) => {
      const delta = currentY - lastY;
      const maxOffset = headerHeight();

      if (force || currentY <= topThreshold) {
        hiddenOffset = 0;
        upwardTravel = 0;
        topExitMode = true;
        applyOffset();
        lastY = currentY;
        return;
      }

      if (delta > 0) {
        upwardTravel = 0;
        if (topExitMode) {
          // Only when leaving the top, follow page scroll.
          hiddenOffset = clamp(currentY, 0, maxOffset);
          if (hiddenOffset >= maxOffset - 0.5 || currentY > maxOffset) topExitMode = false;
        } else {
          // Everywhere else, hide instantly on downward scroll.
          hiddenOffset = maxOffset;
        }
        applyOffset();
      } else if (delta < 0) {
        upwardTravel += Math.abs(delta);
        if (upwardTravel >= revealAfterUpDistance) {
          hiddenOffset = 0;
          upwardTravel = 0;
          applyOffset();
        }
      }

      lastY = currentY;
    };

    const onWindowScroll = () => {
      sync(getWindowY());
      syncMegaBackdropOnScroll();
    };

    window.addEventListener('scroll', onWindowScroll, { passive: true });
    window.addEventListener(
      'resize',
      () => {
        sync(getWindowY(), { force: true });
        syncHeaderSectionMinHeight();
      },
      { passive: true }
    );
    window.requestAnimationFrame(() => {
      sync(getWindowY(), { force: true });
      syncHeaderSectionMinHeight();
    });
    window.setTimeout(syncHeaderSectionMinHeight, 300);

    const cartDrawer = document.querySelector('[data-cart-drawer]');
    const cartDrawerStatus = document.querySelector('[data-cart-drawer-status]');
    const cartDrawerItems = document.querySelector('[data-cart-drawer-items]');
    const cartDrawerRefresh = document.querySelector('[data-cart-drawer-refresh]');
    const cartDrawerClear = document.querySelector('[data-cart-drawer-clear]');
    const cartDrawerCloseButtons = document.querySelectorAll('[data-cart-drawer-close]');
    const headerCartLink = header.querySelector('[data-header-cart-link]');
    const headerCartCount = header.querySelector('[data-header-cart-count]');
    const shopRoot = (() => {
      const root = window.Shopify && window.Shopify.routes && typeof window.Shopify.routes.root === 'string'
        ? window.Shopify.routes.root
        : '/';
      return root.endsWith('/') ? root : `${root}/`;
    })();
    const cartUrl = (path) => `${shopRoot}${path}`;

    let previousCartCount = (() => {
      if (!headerCartCount) return 0;
      const parsed = Number.parseInt(`${headerCartCount.textContent || '0'}`, 10);
      return Number.isFinite(parsed) ? parsed : 0;
    })();

    const triggerCartBadgeAnimation = () => {
      if (!headerCartCount || headerCartCount.hidden) return;
      headerCartCount.classList.remove('is-bump');
      void headerCartCount.offsetWidth;
      headerCartCount.classList.add('is-bump');
    };

    const setCartCount = (count, { animate = true } = {}) => {
      if (!headerCartCount) return;
      const parsedCount = Number.parseInt(`${count}`, 10);
      const normalizedCount = Number.isFinite(parsedCount) ? Math.max(0, parsedCount) : 0;
      const wasHidden = headerCartCount.hidden;
      if (normalizedCount <= 0) {
        headerCartCount.textContent = '';
        headerCartCount.hidden = true;
        headerCartCount.classList.remove('is-double-digit', 'is-bump');
        previousCartCount = 0;
        return;
      }
      const displayCount = normalizedCount > 99 ? '99+' : `${normalizedCount}`;
      headerCartCount.textContent = displayCount;
      headerCartCount.hidden = false;
      headerCartCount.classList.toggle('is-double-digit', displayCount.length > 1);
      const shouldAnimate = animate && normalizedCount > 0 && (wasHidden || normalizedCount !== previousCartCount);
      previousCartCount = normalizedCount;
      if (shouldAnimate) triggerCartBadgeAnimation();
    };

    if (headerCartCount) {
      headerCartCount.addEventListener('animationend', () => {
        headerCartCount.classList.remove('is-bump');
      });
    }

    const formatMoney = (cents, currency = 'USD') => {
      const normalizedCents = Number.isFinite(Number(cents)) ? Number(cents) : 0;
      try {
        return new Intl.NumberFormat(undefined, { style: 'currency', currency }).format(normalizedCents / 100);
      } catch (_) {
        return `${(normalizedCents / 100).toFixed(2)} ${currency}`;
      }
    };

    const renderCartItems = (cart) => {
      if (!cartDrawerItems || !cartDrawerStatus) return;
      cartDrawerItems.innerHTML = '';
      setCartCount(cart.item_count || 0);

      if (!cart.items || cart.items.length === 0) {
        cartDrawerStatus.textContent = 'Cart is empty.';
        return;
      }

      cartDrawerStatus.textContent = `${cart.item_count} item${cart.item_count === 1 ? '' : 's'} in cart`;
      cart.items.forEach((item) => {
        const row = document.createElement('li');
        row.className = 'header__cart-drawer-item';
        const variantTitle = item.variant_title && item.variant_title !== 'Default Title' ? item.variant_title : '';
        row.innerHTML = `
          <div class="header__cart-drawer-item-info">
            <p class="header__cart-drawer-item-title">${item.product_title}</p>
            ${variantTitle ? `<p class="header__cart-drawer-item-variant">${variantTitle}</p>` : ''}
            <p class="header__cart-drawer-item-price">${formatMoney(item.final_line_price, cart.currency || 'USD')}</p>
          </div>
          <span class="header__cart-drawer-item-qty">x${item.quantity}</span>
        `;
        cartDrawerItems.appendChild(row);
      });
    };

    const fetchCart = async () => {
      const response = await fetch(cartUrl('cart.js'), {
        method: 'GET',
        headers: { Accept: 'application/json' }
      });
      if (!response.ok) throw new Error('Cart fetch failed');
      return response.json();
    };

    const openCartDrawer = () => {
      if (!cartDrawer) return;
      cartDrawer.removeAttribute('hidden');
      syncPageScrollLock();
    };

    const closeCartDrawer = () => {
      if (!cartDrawer) return;
      cartDrawer.setAttribute('hidden', '');
      syncPageScrollLock();
    };

    const refreshCartDrawer = async () => {
      if (!cartDrawerStatus) return;
      cartDrawerStatus.textContent = 'Loading cart...';
      try {
        const cart = await fetchCart();
        renderCartItems(cart);
        return cart;
      } catch (error) {
        cartDrawerStatus.textContent = 'Unable to load cart.';
        throw error;
      }
    };

    const dispatchCartChanged = (cart, source = 'unknown', itemCount = 0) => {
      const detail = { cart, source, itemCount };
      document.dispatchEvent(new CustomEvent('sb:cart:changed', { detail }));
      document.dispatchEvent(new CustomEvent('cart:updated', { detail }));
      document.dispatchEvent(
        new CustomEvent('cart:update', {
          bubbles: true,
          detail: {
            resource: cart,
            sourceId: 'header-cart',
            data: {
              source,
              itemCount
            }
          }
        })
      );
    };

    const clearCart = async () => {
      if (cartDrawerStatus) cartDrawerStatus.textContent = 'Clearing cart...';
      const response = await fetch(cartUrl('cart/clear.js'), {
        method: 'POST',
        headers: { Accept: 'application/json' }
      });
      if (!response.ok) throw new Error('Cart clear failed');
      const cart = await fetchCart();
      renderCartItems(cart);
      dispatchCartChanged(cart, 'clear');
      return cart;
    };

    const animateFlyToCart = ({ sourceElement, imageSrc }) => {
      if (!sourceElement || !headerCartLink || !imageSrc) return;
      const sourceRect = sourceElement.getBoundingClientRect();
      const targetRect = headerCartLink.getBoundingClientRect();
      if (!sourceRect.width || !sourceRect.height || !targetRect.width || !targetRect.height) return;

      const fly = document.createElement('img');
      fly.src = imageSrc;
      fly.alt = '';
      fly.setAttribute('aria-hidden', 'true');
      fly.style.position = 'fixed';
      fly.style.left = `${sourceRect.left + sourceRect.width / 2 - 24}px`;
      fly.style.top = `${sourceRect.top + sourceRect.height / 2 - 24}px`;
      fly.style.width = `${Math.max(48, Math.min(96, sourceRect.width * 0.35))}px`;
      fly.style.height = fly.style.width;
      fly.style.borderRadius = '999px';
      fly.style.objectFit = 'cover';
      fly.style.pointerEvents = 'none';
      fly.style.zIndex = '120';
      fly.style.boxShadow = '0 0 24px 0 var(--sb-color-always-black-25)';
      document.body.appendChild(fly);

      const deltaX = targetRect.left + targetRect.width / 2 - (sourceRect.left + sourceRect.width / 2);
      const deltaY = targetRect.top + targetRect.height / 2 - (sourceRect.top + sourceRect.height / 2);
      const animation = fly.animate(
        [
          { transform: 'translate3d(0, 0, 0) scale(1)', opacity: 1 },
          { transform: `translate3d(${deltaX}px, ${deltaY}px, 0) scale(0.2)`, opacity: 0.2 }
        ],
        { duration: 420, easing: 'cubic-bezier(.2,.8,.2,1)', fill: 'forwards' }
      );
      animation.addEventListener('finish', () => fly.remove(), { once: true });
      animation.addEventListener('cancel', () => fly.remove(), { once: true });
    };

    const addToCart = async (variantId, { quantity = 1, sourceElement = null, imageSrc = '' } = {}) => {
      const variantIdValue = `${variantId}`.trim();
      const parsedQuantity = Number.parseInt(`${quantity}`, 10);
      if (!variantIdValue) throw new Error('Invalid variant id');
      if (!Number.isFinite(parsedQuantity) || parsedQuantity <= 0) throw new Error('Invalid quantity');

      const formData = new FormData();
      formData.append('id', variantIdValue);
      formData.append('quantity', `${parsedQuantity}`);

      const response = await fetch(cartUrl('cart/add.js'), {
        method: 'POST',
        headers: {
          Accept: 'application/json'
        },
        credentials: 'same-origin',
        body: formData
      });
      if (!response.ok) {
        const errorBody = await response.text();
        throw new Error(`Add to cart failed: ${errorBody || response.status}`);
      }
      const cart = await fetchCart();
      renderCartItems(cart);
      dispatchCartChanged(cart, 'add', parsedQuantity);
      animateFlyToCart({ sourceElement, imageSrc });
      openCartDrawer();
      return cart;
    };

    window.SBCart = {
      ...(window.SBCart || {}),
      fetch: fetchCart,
      refresh: refreshCartDrawer,
      open: openCartDrawer,
      close: closeCartDrawer,
      clear: clearCart,
      add: addToCart
    };

    if (headerCartLink) {
      headerCartLink.addEventListener('click', (event) => {
        event.preventDefault();
        openCartDrawer();
        refreshCartDrawer();
      });
    }

    cartDrawerCloseButtons.forEach((button) => {
      button.addEventListener('click', () => closeCartDrawer());
    });

    if (cartDrawerRefresh) {
      cartDrawerRefresh.addEventListener('click', () => {
        refreshCartDrawer();
      });
    }

    if (cartDrawerClear) {
      cartDrawerClear.addEventListener('click', async () => {
        try {
          await clearCart();
        } catch (error) {
          if (cartDrawerStatus) cartDrawerStatus.textContent = 'Unable to clear cart.';
        }
      });
    }

    document.addEventListener('keydown', (event) => {
      if (event.key !== 'Escape') return;
      if (isMobileMenuOpen()) {
        closeMobileMenu();
        return;
      }
      if (!cartDrawer || cartDrawer.hasAttribute('hidden')) return;
      closeCartDrawer();
    });

    document.addEventListener('sb:cart:changed', (event) => {
      const cart = event.detail && event.detail.cart;
      if (cart) {
        renderCartItems(cart);
        return;
      }
      refreshCartDrawer();
    });

    document.addEventListener('cart:update', (event) => {
      const cart = event.detail && event.detail.resource;
      if (cart) {
        renderCartItems(cart);
        const source = event.detail && event.detail.data && event.detail.data.source;
        if (source && source !== 'header-cart') {
          openCartDrawer();
        }
        return;
      }
      refreshCartDrawer();
    });

    document.addEventListener('sb:cart-badge:debug-bump', (event) => {
      const requestedCount = event.detail && Number.parseInt(`${event.detail.count}`, 10);
      const nextCount = Number.isFinite(requestedCount)
        ? Math.max(0, requestedCount)
        : Math.max(1, previousCartCount + 1);
      setCartCount(nextCount, { animate: true });
    });

    refreshCartDrawer();
  })();
</script>

{% schema %}
{
  "name": "t:general.header",
  "settings": [
    {
      "type": "link_list",
      "id": "primary_navigation",
      "label": "Primary navigation",
      "info": "Top-level navigation. Dropdown content is configured with mega menu items below."
    }
  ],
  "blocks": [
    {
      "type": "mega_menu_item_product",
      "name": "Mega menu product",
      "settings": [
        {
          "type": "select",
          "id": "menu_item_index",
          "label": "Menu item index",
          "default": "1",
          "options": [
            {
              "value": "1",
              "label": "1"
            },
            {
              "value": "2",
              "label": "2"
            },
            {
              "value": "3",
              "label": "3"
            },
            {
              "value": "4",
              "label": "4"
            },
            {
              "value": "5",
              "label": "5"
            },
            {
              "value": "6",
              "label": "6"
            }
          ]
        },
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "Target minimum 251x251 at 2x export (502x502)."
        },
        {
          "type": "collection",
          "id": "accessories_collection",
          "label": "Accessories collection"
        }
      ]
    },
    {
      "type": "mega_menu_item_collection",
      "name": "Mega menu collection",
      "settings": [
        {
          "type": "select",
          "id": "menu_item_index",
          "label": "Menu item index",
          "default": "1",
          "options": [
            { "value": "1", "label": "1" },
            { "value": "2", "label": "2" },
            { "value": "3", "label": "3" },
            { "value": "4", "label": "4" },
            { "value": "5", "label": "5" },
            { "value": "6", "label": "6" }
          ]
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "checkbox",
          "id": "hide_on_mobile",
          "label": "Hide umbrella collection on mobile",
          "info": "Only shows the links below on mobile.",
          "default": false
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "Target minimum 251x251 at 2x export (502x502)."
        },
        {
          "type": "product",
          "id": "related_product_1",
          "label": "Linked product 1"
        },
        {
          "type": "image_picker",
          "id": "related_product_1_image",
          "label": "Linked product 1 image",
          "info": "Target minimum 251x251 at 2x export (502x502)."
        },
        {
          "type": "checkbox",
          "id": "related_product_1_show_on_mobile",
          "label": "Show linked product 1 on mobile",
          "default": true
        },
        {
          "type": "product",
          "id": "related_product_2",
          "label": "Linked product 2"
        },
        {
          "type": "image_picker",
          "id": "related_product_2_image",
          "label": "Linked product 2 image",
          "info": "Target minimum 251x251 at 2x export (502x502)."
        },
        {
          "type": "checkbox",
          "id": "related_product_2_show_on_mobile",
          "label": "Show linked product 2 on mobile",
          "default": true
        },
        {
          "type": "product",
          "id": "related_product_3",
          "label": "Linked product 3"
        },
        {
          "type": "image_picker",
          "id": "related_product_3_image",
          "label": "Linked product 3 image",
          "info": "Target minimum 251x251 at 2x export (502x502)."
        },
        {
          "type": "checkbox",
          "id": "related_product_3_show_on_mobile",
          "label": "Show linked product 3 on mobile",
          "default": true
        }
      ]
    },
    {
      "type": "mega_menu_item_page",
      "name": "Mega menu page",
      "settings": [
        {
          "type": "select",
          "id": "menu_item_index",
          "label": "Menu item index",
          "default": "1",
          "options": [
            { "value": "1", "label": "1" },
            { "value": "2", "label": "2" },
            { "value": "3", "label": "3" },
            { "value": "4", "label": "4" },
            { "value": "5", "label": "5" },
            { "value": "6", "label": "6" }
          ]
        },
        {
          "type": "page",
          "id": "page",
          "label": "Page"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "Target minimum 251x251 at 2x export (502x502)."
        }
      ]
    },
    {
      "type": "mega_menu_item_app",
      "name": "Mega menu mobile app",
      "settings": [
        {
          "type": "select",
          "id": "menu_item_index",
          "label": "Menu item index",
          "default": "1",
          "options": [
            { "value": "1", "label": "1" },
            { "value": "2", "label": "2" },
            { "value": "3", "label": "3" },
            { "value": "4", "label": "4" },
            { "value": "5", "label": "5" },
            { "value": "6", "label": "6" }
          ]
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "Target minimum 251x251 at 2x export (502x502)."
        },
        {
          "type": "page",
          "id": "app_page",
          "label": "App page"
        }
      ]
    }
  ],
  "max_blocks": 32,
  "presets": [
    {
      "name": "t:general.header",
      "blocks": [
        {
          "type": "mega_menu_item_product",
          "settings": {
            "menu_item_index": "1"
          }
        }
      ]
    }
  ]
}
{% endschema %}
