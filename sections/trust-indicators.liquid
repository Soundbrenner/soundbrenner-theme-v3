<section class="sb-trust-indicators" data-sb-reveal>
  {% assign trustpilot_entry = metaobjects.trustpilot.values | first %}
  {% assign metronome_rating_raw = trustpilot_entry.the_metronome_app_review_rating.value | default: trustpilot_entry.the_metronome_app_review_rating %}
  {% assign metronome_count_raw = trustpilot_entry.the_metronome_app_review_count.value | default: trustpilot_entry.the_metronome_app_review_count %}
  {% assign metronome_rating_display = metronome_rating_raw | strip %}
  {% assign metronome_count_display = metronome_count_raw | strip %}
  {% if metronome_rating_display != blank and metronome_count_display != blank %}
    {% assign metronome_summary = metronome_rating_display | append: ' rating, ' | append: metronome_count_display | append: ' reviews' %}
  {% else %}
    {% assign metronome_summary = '' %}
  {% endif %}

  {% if section.settings.title != blank %}
    <h2 class="sb-trust-indicators__title font-title weight-bold" data-sb-reveal-item>
      {{ section.settings.title }}
    </h2>
  {% endif %}

  <div class="sb-trust-indicators__items">
    {% for block in section.blocks %}
      {% assign icon_url = '' %}
      {% if block.settings.icon != blank %}
        {% assign icon_url = block.settings.icon | image_url: width: 200 %}
      {% else %}
        {% assign icon_url = 'icon-trust-indicator-placeholder.svg' | asset_url %}
      {% endif %}

      <article
        class="sb-trust-indicators__item"
        style="--sb-trust-icon-mask-url: url('{{ icon_url }}');"
        data-sb-reveal-item
        {{ block.shopify_attributes }}
      >
        <div class="sb-trust-indicators__icon" aria-hidden="true">
          <span class="sb-trust-indicators__icon-glyph"></span>
        </div>

        {% if block.settings.show_metronome_app_ratings and metronome_summary != blank %}
          <div class="sb-trust-indicators__text font-body weight-regular rte">
            <p>{{ metronome_summary }}</p>
          </div>
        {% elsif block.settings.text != blank %}
          <div class="sb-trust-indicators__text font-body weight-regular rte">
            {{ block.settings.text }}
          </div>
        {% endif %}
      </article>
    {% endfor %}
  </div>
</section>

{% stylesheet %}
  .sb-trust-indicators {
    width: 100%;
  }

  .sb-trust-indicators__title {
    color: var(--sb-color-neutral-900);
    margin: 0 0 var(--sb-space-48);
    text-align: center;
  }

  .sb-trust-indicators__items {
    align-items: stretch;
    display: flex;
    flex-wrap: wrap;
    gap: var(--sb-space-36);
    justify-content: center;
    width: 100%;
  }

  .sb-trust-indicators__item {
    align-items: center;
    display: flex;
    flex: 1 1 0;
    flex-direction: column;
    max-width: 240px;
    min-width: 0;
    text-align: center;
    width: 100%;
  }

  .sb-trust-indicators__icon {
    width: 100%;
  }

  .sb-trust-indicators__icon-glyph {
    aspect-ratio: 200 / 61;
    background: var(--sb-color-neutral-900);
    display: block;
    height: auto;
    mask-image: var(--sb-trust-icon-mask-url);
    mask-position: center;
    mask-repeat: no-repeat;
    mask-size: contain;
    -webkit-mask-image: var(--sb-trust-icon-mask-url);
    -webkit-mask-position: center;
    -webkit-mask-repeat: no-repeat;
    -webkit-mask-size: contain;
    width: 100%;
  }

  .sb-trust-indicators__text {
    color: var(--sb-color-neutral-900);
    margin-top: var(--sb-space-8);
  }

  .sb-trust-indicators__text > * {
    margin: 0;
  }

  .sb-trust-indicators__text > * + * {
    margin-top: var(--sb-space-8);
  }

  @media (max-width: 749px) {
    .sb-trust-indicators__items {
      display: grid;
      gap: var(--sb-space-20);
      grid-template-columns: repeat(2, minmax(0, 1fr));
      justify-items: center;
    }

    .sb-trust-indicators__item {
      max-width: 240px;
      width: 100%;
    }

    .sb-trust-indicators__item:last-child:nth-child(odd) {
      grid-column: 1 / -1;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Trust indicators",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Trust indicators"
    }
  ],
  "blocks": [
    {
      "type": "item",
      "name": "Trust indicator",
      "settings": [
        {
          "type": "image_picker",
          "id": "icon",
          "label": "Icon",
          "info": "Target minimum 200x61. White SVG files only."
        },
        {
          "type": "checkbox",
          "id": "show_metronome_app_ratings",
          "label": "Show The Metronome app ratings and reviews",
          "default": false
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Trust indicator.</p>",
          "visible_if": "{{ block.settings.show_metronome_app_ratings == false }}"
        }
      ]
    }
  ],
  "max_blocks": 5,
  "presets": [
    {
      "name": "Trust indicators",
      "blocks": [
        {
          "type": "item"
        },
        {
          "type": "item"
        },
        {
          "type": "item"
        }
      ]
    }
  ]
}
{% endschema %}
