<section class="sb-feature-carousel" data-sb-carousel data-sb-reveal>
  {% if section.settings.title != blank %}
    <h2 class="sb-feature-carousel__title font-title weight-bold" data-sb-reveal-item>{{ section.settings.title }}</h2>
  {% endif %}

  <div class="sb-feature-carousel__viewport" data-sb-carousel-viewport>
    <div class="sb-feature-carousel__track" data-sb-carousel-track>
      {% for block in section.blocks %}
        {% assign item_image = block.settings.image %}
        {% assign item_video = block.settings.video %}
        {% if item_image != blank %}
          {% assign item_image_request_width = item_image.width | at_most: 864 %}
          {% assign item_image_url = item_image | image_url: width: item_image_request_width %}
        {% else %}
          {% assign item_image_url = 'placeholder-feature-carousel.jpg' | asset_url %}
        {% endif %}

        <article class="sb-feature-carousel__item" data-sb-carousel-item data-sb-reveal-item {{ block.shopify_attributes }}>
          <div class="sb-feature-carousel__media">
            {% if item_video != blank %}
              {{
                item_video
                | video_tag:
                  class: 'sb-feature-carousel__media-video',
                  controls: true,
                  autoplay: false,
                  loop: false,
                  muted: false,
                  image_size: '864x',
                  preload: 'metadata'
              }}
            {% else %}
              <img
                src="{{ item_image_url }}"
                alt="{{ item_image.alt | default: block.settings.body | strip_html | truncate: 80 | escape }}"
                loading="lazy"
                width="283"
                height="283"
              >
            {% endif %}
          </div>
          <div class="sb-feature-carousel__body font-body weight-regular rte">
            {{ block.settings.body }}
          </div>
        </article>
      {% endfor %}
    </div>
  </div>

  <div class="sb-feature-carousel__controls" data-sb-carousel-controls>
    <button type="button" class="sb-feature-carousel__arrow" data-sb-carousel-prev aria-label="Previous" disabled>
      <span class="sb-feature-carousel__arrow-icon sb-feature-carousel__arrow-icon--left" aria-hidden="true">
        {{ 'icon-carousel-arrow-left-filled.svg' | inline_asset_content }}
      </span>
    </button>

    <button type="button" class="sb-feature-carousel__arrow" data-sb-carousel-next aria-label="Next" disabled>
      <span class="sb-feature-carousel__arrow-icon sb-feature-carousel__arrow-icon--right" aria-hidden="true">
        {{ 'icon-carousel-arrow-left-filled.svg' | inline_asset_content }}
      </span>
    </button>
  </div>
</section>

{% stylesheet %}
  .sb-feature-carousel {
    --sb-carousel-gap: var(--sb-space-36);
    --sb-carousel-bleed-inline: var(--page-margin);
    width: 100%;
  }

  .sb-feature-carousel__title {
    color: var(--sb-color-neutral-900);
    margin: 0 0 var(--sb-space-48);
    text-align: center;
  }

  .sb-feature-carousel__viewport {
    margin-left: calc(-1 * var(--sb-carousel-bleed-inline));
    margin-right: calc(-1 * var(--sb-carousel-bleed-inline));
    overflow-x: auto;
    overflow-y: hidden;
    padding-left: var(--sb-carousel-bleed-inline);
    padding-right: var(--sb-carousel-bleed-inline);
    scrollbar-width: none;
    width: calc(100% + (var(--sb-carousel-bleed-inline) * 2));
    -webkit-overflow-scrolling: touch;
  }

  .sb-feature-carousel__viewport::-webkit-scrollbar {
    display: none;
  }

  .sb-feature-carousel__track {
    display: flex;
    gap: var(--sb-carousel-gap);
    padding: 0;
    width: max-content;
  }

  .sb-feature-carousel__item {
    flex: 0 0 283px;
    max-width: 283px;
    min-width: 283px;
  }

  .sb-feature-carousel__media {
    border-radius: 24px;
    overflow: hidden;
  }

  .sb-feature-carousel__media img {
    aspect-ratio: 1 / 1;
    display: block;
    height: auto;
    object-fit: cover;
    width: 100%;
  }

  .sb-feature-carousel__media-video {
    aspect-ratio: 1 / 1;
    display: block;
    height: auto;
    object-fit: cover;
    width: 100%;
  }

  .sb-feature-carousel__body {
    color: var(--sb-color-neutral-900);
    margin-top: var(--sb-space-24);
  }

  .sb-feature-carousel__body > * {
    margin: 0;
  }

  .sb-feature-carousel__body > * + * {
    margin-top: var(--sb-space-20);
  }

  .sb-feature-carousel__controls {
    align-items: center;
    display: none;
    gap: var(--sb-space-16);
    justify-content: flex-end;
    margin-bottom: 0;
    margin-top: var(--sb-space-48);
    padding-bottom: 0;
  }

  .sb-feature-carousel.is-overflowing .sb-feature-carousel__controls {
    display: flex;
  }

  .sb-feature-carousel__arrow {
    align-items: center;
    background: transparent;
    border: 0;
    cursor: pointer;
    display: inline-flex;
    height: var(--sb-space-48);
    justify-content: center;
    padding: 0;
    width: var(--sb-space-48);
  }

  .sb-feature-carousel__arrow[disabled] {
    cursor: default;
    opacity: 0.5;
  }

  .sb-feature-carousel__arrow-icon {
    display: inline-flex;
    height: var(--sb-space-48);
    width: var(--sb-space-48);
  }

  .sb-feature-carousel__arrow-icon--right {
    transform: scaleX(-1);
  }

  .sb-feature-carousel__arrow-icon svg {
    display: block;
    height: 100%;
    width: 100%;
  }

  .sb-feature-carousel__arrow-icon svg path:first-child {
    fill: var(--sb-color-neutral-200);
  }

  .sb-feature-carousel__arrow-icon svg path:last-child {
    fill: var(--sb-color-neutral-800);
    transition: fill 180ms ease;
  }

  .sb-feature-carousel__arrow:hover:not([disabled]) .sb-feature-carousel__arrow-icon svg path:last-child,
  .sb-feature-carousel__arrow:focus-visible:not([disabled]) .sb-feature-carousel__arrow-icon svg path:last-child {
    fill: var(--sb-color-primary-500);
  }

  .sb-feature-carousel.is-not-overflowing .sb-feature-carousel__track {
    margin-inline: auto;
  }

  @media (max-width: 749px) {
    .sb-feature-carousel__viewport {
      overflow-x: auto;
    }

    .sb-feature-carousel__controls {
      justify-content: flex-end;
    }
  }
{% endstylesheet %}

{% render 'sb-carousel-init' %}

{% schema %}
{
  "name": "Feature carousel",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Feature carousel"
    }
  ],
  "blocks": [
    {
      "type": "item",
      "name": "Carousel item",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "Target minimum 288x288 at 3x export (864x864)."
        },
        {
          "type": "video",
          "id": "video",
          "label": "Video",
          "info": "Target minimum 288x288 at 3x export (864x864). If both are set, video is shown."
        },
        {
          "type": "richtext",
          "id": "body",
          "label": "Text",
          "default": "<p><strong>Placeholder.</strong> Placeholder 2.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Feature carousel",
      "blocks": [
        {
          "type": "item"
        },
        {
          "type": "item"
        },
        {
          "type": "item"
        },
        {
          "type": "item"
        }
      ]
    }
  ]
}
{% endschema %}
