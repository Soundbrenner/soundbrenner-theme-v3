{% liquid
  assign product_badge_label = blank
  assign product_badge_type = blank
  assign product_tagline = blank
  assign product_tagline_html = blank
  assign product_has_tagline_override = false
  assign product_variant_explainer_body = blank
  assign product_hide_reviews = false
  assign product_rating = 0
  assign product_reviews_count = 0
  assign product_hide_purchase_guarantees = false
  assign product_delivery_explainer_box = blank
  assign product_delivery_explainer_title = blank
  assign product_delivery_explainer_body_html = blank
  assign product_delivery_explainer_progress_percent = 0
  assign product_delivery_explainer_progress_subtitle = blank
  assign delivery_ship_days = 0
  assign product_usps_values_collection = blank
  assign has_non_color_variant_options = false
  assign has_color_variant_options = false
  assign selector_list_mode = 'none'
  assign selector_list_heading = blank
  assign selector_list_option_position = 0
  assign product_multipack_items = blank
  assign product_video_story_items = blank
  assign product_in_the_box_items = blank
  assign product_addon_products = blank
  assign selected_multipack_variant_id = blank
  assign selected_multipack_variant_available = false
  assign selected_multipack_variant_price = blank
  assign selected_multipack_variant_compare_at_price = blank
  assign use_variant_media_gallery = false
  assign product_media_tokens = blank
  assign show_shop_pay_guarantee = false
  assign product_settings_ref = product.metafields.custom.sbv2_product_settings.value | default: product.metafields.custom.sbv2_product_settings
  assign product_delivery_explainer_ref = product.metafields.custom.sbv2_delivery_explainer_box
  assign product_multipack_ref = product.metafields.custom.sbv2_multipack
  assign product_video_stories_ref = product.metafields.custom.sbv2_see_it_in_action_video_carousel
  assign product_in_the_box_ref = product.metafields.custom.sbv2_what_s_in_the_box
  assign product_addon_products_ref = product.metafields.custom.addon_products
  assign product_usps_ref = product.metafields.custom.product_usps
  assign product_usps_root = product_usps_ref.value | default: product_usps_ref.reference | default: product_usps_ref
  assign add_to_cart_icon_type = section.settings.add_to_cart_icon | default: 'cart'
  assign product_module_block_types = '|media_gallery|variant_explainer_box|delivery_explainer_box|video_stories|in_the_box|description|popular_add_ons|'

  if product.metafields.reviews.rating.value != blank
    assign rating_value = product.metafields.reviews.rating.value
    assign product_rating = rating_value.rating | default: rating_value | plus: 0
  endif
  assign product_reviews_count = product.metafields.reviews.rating_count.value | default: 0 | plus: 0 | round: 0

  if product_settings_ref != blank
    assign product_tagline = product_settings_ref.tagline.value | default: product_settings_ref.tagline
    assign product_tagline_html = product_settings_ref.tagline | metafield_tag
    if product_tagline != blank or product_tagline_html != blank
      assign product_has_tagline_override = true
    endif
    assign product_variant_explainer_body = product_settings_ref.variant_explainer_box_body.value | default: product_settings_ref.variant_explainer_box_body
    assign product_hide_reviews_value = product_settings_ref.hide_reviews.value | default: product_settings_ref.hide_reviews
    if product_hide_reviews_value == true or product_hide_reviews_value == 'true' or product_hide_reviews_value == 1 or product_hide_reviews_value == '1'
      assign product_hide_reviews = true
    endif
    assign product_hide_purchase_guarantees_value = product_settings_ref.purchase_guarantees_box.value | default: product_settings_ref.purchase_guarantees_box
    if product_hide_purchase_guarantees_value == true or product_hide_purchase_guarantees_value == 'true' or product_hide_purchase_guarantees_value == 1 or product_hide_purchase_guarantees_value == '1'
      assign product_hide_purchase_guarantees = true
    endif
    assign variant_selector_list_value = product_settings_ref.variant_selector_list.value | default: product_settings_ref.variant_selector_list
    if variant_selector_list_value == true or variant_selector_list_value == 'true' or variant_selector_list_value == 1 or variant_selector_list_value == '1'
      assign selector_list_mode = 'variant'
    endif

  endif

  assign product_delivery_explainer_box = product_delivery_explainer_ref.value | default: product_delivery_explainer_ref.reference | default: product_delivery_explainer_ref
  if product_delivery_explainer_box == blank and product_settings_ref != blank
    assign product_delivery_explainer_box = product_settings_ref.delivery_explainer_box.value | default: product_settings_ref.delivery_explainer_box.reference | default: product_settings_ref.delivery_explainer_box
  endif

  if product_delivery_explainer_box != blank
    assign product_delivery_explainer_title = product_delivery_explainer_box.title.value | default: product_delivery_explainer_box.title
    assign product_delivery_explainer_body_html = product_delivery_explainer_box.body | metafield_tag
    assign product_delivery_explainer_progress_percent = product_delivery_explainer_box.progress_bar_percent.value | default: product_delivery_explainer_box.progress_bar_percent | default: 0
    assign product_delivery_explainer_progress_subtitle = product_delivery_explainer_box.progress_bar_subtitle.value | default: product_delivery_explainer_box.progress_bar_subtitle
    assign delivery_ship_days = product_delivery_explainer_box.days_until_shipping_date.value | default: product_delivery_explainer_box.days_until_shipping_date | default: 0
  endif

  assign product_multipack_root = product_multipack_ref.value | default: product_multipack_ref.reference | default: product_multipack_ref
  if product_multipack_root != blank
    assign product_multipack_definition = product_multipack_root.sbv2_multipack.value | default: product_multipack_root.sbv2_multipack.reference | default: product_multipack_root.sbv2_multipack
    if product_multipack_definition == blank
      assign product_multipack_definition = product_multipack_root
    endif

    assign product_multipack_items = product_multipack_definition.products.value | default: product_multipack_definition.products.references | default: product_multipack_definition.products
    if product_multipack_items == blank
      assign product_multipack_items = product_multipack_definition.sbv2_multipack_item.value | default: product_multipack_definition.sbv2_multipack_item.references | default: product_multipack_definition.sbv2_multipack_item
    endif
    if product_multipack_items == blank
      assign product_multipack_items = product_multipack_definition.items.value | default: product_multipack_definition.items.references | default: product_multipack_definition.items
    endif
  endif

  assign product_video_stories_root = product_video_stories_ref.value | default: product_video_stories_ref.reference | default: product_video_stories_ref
  if product_video_stories_root != blank
    assign product_video_stories_carousel = product_video_stories_root.video_carousel.value | default: product_video_stories_root.video_carousel.reference | default: product_video_stories_root.video_carousel
    if product_video_stories_carousel == blank
      assign product_video_stories_carousel = product_video_stories_root
    endif

    assign product_video_story_items = product_video_stories_carousel.videos.value | default: product_video_stories_carousel.videos.references | default: product_video_stories_carousel.videos
  endif

  assign product_addon_products_source = product_addon_products_ref.value | default: product_addon_products_ref.references | default: product_addon_products_ref
  if product_addon_products_source != blank and product_addon_products_source.products != blank
    assign product_addon_products_source = product_addon_products_source.products.value | default: product_addon_products_source.products.references | default: product_addon_products_source.products
  endif
  assign product_addon_products = product_addon_products_source

  if product_delivery_explainer_title != blank or product_delivery_explainer_body_html != blank or product_delivery_explainer_progress_subtitle != blank
    assign delivery_now_timestamp = 'now' | date: '%s' | plus: 0
    assign delivery_ship_offset_seconds = delivery_ship_days | plus: 0 | times: 86400
    assign delivery_shipping_timestamp = delivery_now_timestamp | plus: delivery_ship_offset_seconds
    assign delivery_shipping_date_text = delivery_shipping_timestamp | date: '%B %-d'

    assign delivery_current_day = 'now' | date: '%-d' | plus: 0
    assign delivery_current_week_index = delivery_current_day | minus: 1 | divided_by: 7 | plus: 1
    assign delivery_target_week_index = delivery_current_week_index

    assign delivery_week_label = 'first'
    case delivery_target_week_index
      when 2
        assign delivery_week_label = 'second'
      when 3
        assign delivery_week_label = 'third'
      when 4
        assign delivery_week_label = 'fourth'
      when 5
        assign delivery_week_label = 'fifth'
    endcase

    assign delivery_first_of_month_text = 'now' | date: '%Y-%m-01 00:00:00'
    assign delivery_first_of_month_timestamp = delivery_first_of_month_text | date: '%s' | plus: 0
    assign delivery_next_month_timestamp = delivery_first_of_month_timestamp | plus: 2764800
    assign delivery_next_month_name = delivery_next_month_timestamp | date: '%B'
    assign delivery_next_batch_text = delivery_week_label | append: ' week of ' | append: delivery_next_month_name

    assign product_delivery_explainer_title = product_delivery_explainer_title | replace: '{{ Delivery explainer box shipping date }}', delivery_shipping_date_text
    assign product_delivery_explainer_title = product_delivery_explainer_title | replace: '{{ Delivery explainer box next batch date }}', delivery_next_batch_text
    assign product_delivery_explainer_body_html = product_delivery_explainer_body_html | replace: '{{ Delivery explainer box shipping date }}', delivery_shipping_date_text
    assign product_delivery_explainer_body_html = product_delivery_explainer_body_html | replace: '{{ Delivery explainer box next batch date }}', delivery_next_batch_text
    assign product_delivery_explainer_progress_subtitle = product_delivery_explainer_progress_subtitle | replace: '{{ Delivery explainer box shipping date }}', delivery_shipping_date_text
    assign product_delivery_explainer_progress_subtitle = product_delivery_explainer_progress_subtitle | replace: '{{ Delivery explainer box next batch date }}', delivery_next_batch_text
  endif

  if product_tagline == blank and product_tagline_html == blank and product.description != blank
    assign product_tagline_html = product.description
  endif

  if product_usps_root != blank
    assign product_usps_values_collection = product_usps_root.items.value | default: product_usps_root.items.references | default: product_usps_root.items
  endif

  if product.tags != blank
    for product_tag in product.tags
      assign product_tag_downcase = product_tag | downcase
      if product_tag_downcase == 'bestseller'
        assign product_badge_label = 'Bestseller'
        assign product_badge_type = 'bestseller'
        break
      endif
      if product_tag_downcase == 'new'
        assign product_badge_label = 'New'
        assign product_badge_type = 'new'
      endif
    endfor
  endif

  assign current_variant = product.selected_or_first_available_variant
  if product.has_only_default_variant == false
    assign current_variant_in_the_box_ref = current_variant.metafields.custom.sbv2_what_s_in_the_box
    if current_variant_in_the_box_ref != blank
      assign product_in_the_box_ref = current_variant_in_the_box_ref
    endif
  endif
  assign product_in_the_box_root_source = product_in_the_box_ref.value | default: product_in_the_box_ref.reference.value | default: product_in_the_box_ref.reference | default: product_in_the_box_ref
  assign product_in_the_box_root = blank
  for product_in_the_box_root_candidate in product_in_the_box_root_source limit: 1
    assign product_in_the_box_root = product_in_the_box_root_candidate
  endfor
  if product_in_the_box_root == blank
    assign product_in_the_box_root = product_in_the_box_root_source
  endif
  if product_in_the_box_root != blank and product_in_the_box_root.products == blank
    assign product_in_the_box_nested = product_in_the_box_root.sbv2_what_s_in_the_box.value | default: product_in_the_box_root.sbv2_what_s_in_the_box.reference.value | default: product_in_the_box_root.sbv2_what_s_in_the_box.reference | default: product_in_the_box_root.sbv2_what_s_in_the_box
    if product_in_the_box_nested != blank
      assign product_in_the_box_root = product_in_the_box_nested
    endif
  endif
  if product_in_the_box_root != blank
    assign product_in_the_box_items = product_in_the_box_root.products.value | default: product_in_the_box_root.products.references | default: product_in_the_box_root.products
  endif

  assign shopper_country_iso = localization.country.iso_code | upcase
  if shopper_country_iso == 'US' or shopper_country_iso == 'CA' or shopper_country_iso == 'GB'
    assign show_shop_pay_guarantee = true
  endif

  if product.options_with_values != blank
    for option in product.options_with_values
      assign option_name_downcase = option.name | downcase
      if option_name_downcase contains 'color' or option_name_downcase contains 'colour'
        if option.values.size > 1
          assign has_color_variant_options = true
        endif
      else
        if option.values.size > 1
          assign has_non_color_variant_options = true
        endif
      endif
    endfor
  endif

  if selector_list_mode == 'variant'
    for option in product.options_with_values
      assign option_name_downcase = option.name | downcase
      unless option_name_downcase contains 'color' or option_name_downcase contains 'colour'
        if option.values.size > 1
          assign selector_list_heading = option.name
          assign selector_list_option_position = option.position
          break
        endif
      endunless
    endfor
    if selector_list_option_position == 0
      assign selector_list_mode = 'none'
    endif
    if selector_list_heading == blank and selector_list_mode == 'variant'
      assign selector_list_heading = 'Variant'
    endif
  elsif product_multipack_items != blank
    assign selector_list_mode = 'multipack'
    assign selector_list_heading = 'Buy multiple and save extra'
    assign selected_multipack_variant_id = current_variant.id
    assign selected_multipack_variant_available = current_variant.available
    assign selected_multipack_variant_price = current_variant.price
    assign selected_multipack_variant_compare_at_price = current_variant.compare_at_price
    for multipack_item in product_multipack_items
      assign multipack_entry = multipack_item.value | default: multipack_item.reference.value | default: multipack_item.reference | default: multipack_item
      assign multipack_product = multipack_entry.product.value | default: multipack_entry.product
      if multipack_product == blank
        continue
      endif
      assign multipack_variant = multipack_product.selected_or_first_available_variant
      if multipack_variant == blank
        continue
      endif
      if multipack_product.id == product.id
        assign selected_multipack_variant_id = multipack_variant.id
        assign selected_multipack_variant_available = multipack_variant.available
        assign selected_multipack_variant_price = multipack_variant.price
        assign selected_multipack_variant_compare_at_price = multipack_variant.compare_at_price
      endif
    endfor
  endif

  if selector_list_mode == 'variant' and selector_list_option_position == 0
    for option in product.options_with_values
      if option.values.size > 1
        assign selector_list_heading = option.name
        break
      endif
    endfor
    if selector_list_heading == blank
      assign selector_list_heading = 'Variant'
    endif
  endif

  if product.has_only_default_variant == false
    assign use_variant_media_gallery = true
    assign current_variant_primary_image = blank

    if current_variant.featured_image != blank
      assign current_variant_primary_image = current_variant.featured_image | image_url: width: 1440
    elsif product.featured_image != blank
      assign current_variant_primary_image = product.featured_image | image_url: width: 1440
    endif

    if current_variant_primary_image != blank
      assign product_media_tokens = 'image::' | append: current_variant_primary_image
    endif

    assign current_variant_gallery_images = current_variant.metafields.custom.images.value | default: current_variant.metafields.custom.images
    if current_variant_gallery_images != blank
      for current_variant_gallery_image in current_variant_gallery_images
        assign current_variant_gallery_media = current_variant_gallery_image.value | default: current_variant_gallery_image
        assign current_variant_gallery_type = current_variant_gallery_media.media_type | default: 'image'
        assign current_variant_gallery_image_url = blank
        assign current_variant_gallery_video_url = blank
        assign current_variant_gallery_poster_url = blank

        if current_variant_gallery_type == 'video'
          if current_variant_gallery_media.sources != blank
            for current_variant_video_source in current_variant_gallery_media.sources
              assign current_variant_gallery_video_url = current_variant_video_source.url | default: current_variant_video_source.src
              if current_variant_gallery_video_url != blank
                break
              endif
            endfor
          endif
          if current_variant_gallery_media.preview_image != blank
            assign current_variant_gallery_poster_url = current_variant_gallery_media.preview_image | image_url: width: 1440
          endif
        else
          if current_variant_gallery_media.preview_image != blank
            assign current_variant_gallery_image_url = current_variant_gallery_media.preview_image | image_url: width: 1440
          elsif current_variant_gallery_media != blank
            assign current_variant_gallery_image_url = current_variant_gallery_media | image_url: width: 1440
          endif
        endif

        assign current_variant_gallery_token = blank
        if current_variant_gallery_video_url != blank
          assign current_variant_gallery_token = 'video::' | append: current_variant_gallery_video_url
          if current_variant_gallery_poster_url != blank
            assign current_variant_gallery_token = current_variant_gallery_token | append: '::' | append: current_variant_gallery_poster_url
          endif
        elsif current_variant_gallery_image_url != blank and current_variant_gallery_image_url != current_variant_primary_image
          assign current_variant_gallery_token = 'image::' | append: current_variant_gallery_image_url
        endif

        if current_variant_gallery_token != blank
          if product_media_tokens != blank
            assign product_media_tokens = product_media_tokens | append: '||'
          endif
          assign product_media_tokens = product_media_tokens | append: current_variant_gallery_token
        endif
      endfor
    endif
  endif

  assign form_variant_id = current_variant.id
  if selector_list_mode == 'multipack' and selected_multipack_variant_id != blank
    assign form_variant_id = selected_multipack_variant_id
  endif

  assign sticky_media_image_url = blank
  assign sticky_media_image = current_variant.featured_image | default: product.featured_image
  if sticky_media_image != blank
    assign sticky_media_image_width = sticky_media_image.width | default: 192 | at_most: 192
    assign sticky_media_image_url = sticky_media_image | image_url: width: sticky_media_image_width
  endif
  if sticky_media_image_url == blank
    for media in product.media
      if media.media_type == 'image'
        assign sticky_media_image_url = media | image_url: width: 192
        break
      endif
    endfor
  endif

  assign sticky_has_compare_price = false
  if current_variant.compare_at_price > current_variant.price
    assign sticky_has_compare_price = true
  endif
%}

<section
  class="sb-product-main"
  data-sb-reveal
  data-product-id="{{ product.id }}"
  data-product-title="{{ product.title | escape }}"
  data-selector-list-option-position="{{ selector_list_option_position }}"
>
  <div class="sb-product-main__sticky-bar-wrap">
    <div class="sb-product-main__sticky-bar" data-sticky-buy-bar>
      <div class="sb-product-main__sticky-info">
        <div class="sb-product-main__sticky-image-wrap" aria-hidden="true">
          {% if sticky_media_image_url != blank %}
            <img
              class="sb-product-main__sticky-image"
              data-sticky-image
              src="{{ sticky_media_image_url }}"
              alt="{{ product.title | escape }}"
              loading="lazy"
              width="48"
              height="48"
            >
          {% else %}
            <div class="sb-product-main__sticky-image sb-product-main__sticky-image--placeholder" data-sticky-image></div>
          {% endif %}
        </div>

        <div class="sb-product-main__sticky-meta{% if product_hide_reviews %} sb-product-main__sticky-meta--no-reviews{% endif %}">
          <div class="sb-product-main__sticky-price-stack">
            <span
              class="sb-product-main__sticky-compare-price font-caption weight-regular"
              data-sticky-compare-price
              {% unless sticky_has_compare_price %}
                hidden
              {% endunless %}
            >
              {{ current_variant.compare_at_price | money }}
            </span>
            <span class="sb-product-main__sticky-current-price font-caption weight-regular" data-sticky-current-price>
              {{ current_variant.price | money }}
            </span>
          </div>

          {% unless product_hide_reviews %}
            <div class="sb-product-main__sticky-reviews">
              <a
                class="sb-product-main__sticky-stars"
                href="#klaviyo-product-reviews-wrapper"
                data-sticky-reviews-link
                aria-label="Go to reviews"
              >
                {% assign sticky_star_icon_url = 'icon-review-star.svg' | asset_url %}
                {% for i in (1..5) %}
                  {% assign step = i | minus: 1 %}
                  {% assign fill_ratio = product_rating | minus: step %}
                  {% if fill_ratio >= 1 %}
                    {% assign fill_percent = 100 %}
                  {% elsif fill_ratio <= 0 %}
                    {% assign fill_percent = 0 %}
                  {% else %}
                    {% assign fill_percent = fill_ratio | times: 100 | round %}
                  {% endif %}
                  <span
                    class="sb-product-main__sticky-star"
                    style="--sb-star-fill: {{ fill_percent }}%; --sb-star-icon-url: url('{{ sticky_star_icon_url }}');"
                  ></span>
                {% endfor %}
              </a>
              <a
                class="sb-product-main__sticky-review-count font-caption weight-regular"
                href="#klaviyo-product-reviews-wrapper"
                data-sticky-reviews-link
                data-sticky-review-count
                data-sticky-review-count-value="{{ product_reviews_count | plus: 0 | round }}"
              >
                {{ product_reviews_count | plus: 0 | round | number_with_delimiter }} reviews
              </a>
            </div>
          {% endunless %}
        </div>
      </div>

      <div class="sb-product-main__sticky-segmented-wrap">
        <div
          class="sb-product-main__sticky-segmented"
          data-sticky-segmented-controls
          role="tablist"
          aria-label="Page mode"
        >
          <span class="sb-product-main__sticky-segment-indicator" aria-hidden="true"></span>
          <button
            class="sb-product-main__sticky-segment-pill is-active font-caption weight-semibold"
            type="button"
            data-sticky-segment-option="learn-more"
            aria-pressed="true"
          >
            Learn more
          </button>
          <button
            class="sb-product-main__sticky-segment-pill font-caption weight-medium"
            type="button"
            data-sticky-segment-option="buy-now"
            aria-pressed="false"
          >
            Buy now
          </button>
        </div>
      </div>

      <button
        class="sb-product-main__sticky-add-button sb-button-radiant sb-button-radiant--medium sb-button-radiant--leading-icon font-caption weight-bold"
        type="button"
        data-sticky-add-button
        {% unless current_variant.available %}
          disabled
        {% endunless %}
        aria-label="{% if current_variant.available %}Add to cart{% else %}Sold out{% endif %}"
      >
        <span class="sb-button-radiant__icon sb-product-main__sticky-add-button-icon" aria-hidden="true">
          {% if add_to_cart_icon_type == 'arrow' %}
            {{ 'icon-arrow-large-40.svg' | inline_asset_content }}
          {% else %}
            <img
              class="sb-product-main__add-button-icon-image"
              src="{{ 'icon-add-to-cart.svg' | asset_url }}"
              alt=""
              width="16"
              height="16"
            >
          {% endif %}
        </span>
        <span class="sb-button-radiant__label" data-sticky-add-button-label>
          {% if current_variant.available %}
            Add to cart
          {% else %}
            Sold out
          {% endif %}
        </span>
      </button>
    </div>
  </div>

  <div class="sb-product-main__layout">
    <div class="sb-product-main__media-column">
      {% for block in section.blocks %}
        {% if block.type == 'media_gallery' %}
          <div class="sb-product-main__media-grid" data-product-media-grid {{ block.shopify_attributes }}>
            {% if use_variant_media_gallery and product_media_tokens != blank %}
              {% assign initial_media_tokens = product_media_tokens | split: '||' %}
              {% for media_token in initial_media_tokens %}
                {% assign media_token_clean = media_token | strip %}
                {% if media_token_clean != blank %}
                  {% assign media_token_parts = media_token_clean | split: '::' %}
                  {% assign media_token_type = media_token_parts[0] %}
                  {% assign media_token_source = media_token_parts[1] %}
                  {% assign media_token_poster = media_token_parts[2] %}
                  <div class="sb-product-main__media-item{% if media_token_type == 'video' %} sb-product-main__media-item--video{% endif %}" data-sb-reveal-item>
                    {% if media_token_type == 'video' %}
                      {% if media_token_poster != blank %}
                        <img
                          class="sb-product-main__media-video-poster"
                          data-gallery-video-poster
                          src="{{ media_token_poster | escape }}"
                          alt="{{ product.title | escape }}"
                          loading="lazy"
                          width="720"
                          height="720"
                        >
                      {% endif %}
                      <video
                        class="sb-product-main__media-asset sb-product-main__media-asset--video"
                        data-gallery-video
                        style="background: var(--sb-color-neutral-200);"
                        autoplay
                        loop
                        muted
                        playsinline
                        preload="metadata"
                        {% if media_token_poster != blank %}
                          poster="{{ media_token_poster | escape }}"
                        {% endif %}
                        src="{{ media_token_source }}"
                      ></video>
                    {% else %}
                      <img
                        class="sb-product-main__media-asset"
                        src="{{ media_token_source }}"
                        alt="{{ product.title | escape }}"
                        loading="lazy"
                        width="720"
                        height="720"
                      >
                    {% endif %}
                  </div>
                {% endif %}
              {% endfor %}
            {% else %}
              {% for media in product.media %}
                <div class="sb-product-main__media-item{% if media.media_type == 'video' %} sb-product-main__media-item--video{% endif %}" data-sb-reveal-item>
                  {% case media.media_type %}
                    {% when 'image' %}
                      {{
                        media
                        | image_url: width: 1440
                        | image_tag:
                          class: 'sb-product-main__media-asset',
                          loading: 'lazy',
                          sizes: '(min-width: 990px) 720px, 100vw'
                      }}
                    {% when 'video' %}
                      {% assign media_video_poster = blank %}
                      {% if media.preview_image != blank %}
                        {% assign media_video_poster = media.preview_image | image_url: width: 1440 %}
                        <img
                          class="sb-product-main__media-video-poster"
                          data-gallery-video-poster
                          src="{{ media_video_poster | escape }}"
                          alt="{{ product.title | escape }}"
                          loading="lazy"
                          width="1440"
                          height="1440"
                          sizes="(min-width: 990px) 720px, 100vw"
                        >
                      {% endif %}
                      {{
                        media
                        | video_tag:
                          class: 'sb-product-main__media-asset sb-product-main__media-asset--video',
                          style: 'background: var(--sb-color-neutral-200);',
                          autoplay: true,
                          loop: true,
                          muted: true,
                          controls: false,
                          playsinline: true,
                          poster: media_video_poster,
                          preload: 'metadata'
                      }}
                    {% else %}
                      {{ media | media_tag: class: 'sb-product-main__media-asset' }}
                  {% endcase %}
                </div>
              {% endfor %}
            {% endif %}
          </div>
          {% break %}
        {% endif %}
      {% endfor %}
    </div>

    <div class="sb-product-main__info-column">
      <div class="sb-product-main__info-top{% if product_badge_label == blank %} sb-product-main__info-top--no-badge{% endif %}{% if product_hide_reviews %} sb-product-main__info-top--no-reviews{% endif %}">
        {% unless product_hide_reviews %}
          <div class="sb-product-main__rating" data-sb-reveal-item>
            {% for block in section.blocks %}
              {% liquid
                assign is_product_reviews_block = false
                assign block_identifier = block.type | append: ' ' | append: block.id | downcase
                if block_identifier contains 'product-reviews' or block_identifier contains 'product_reviews' or block_identifier contains 'product reviews' or block_identifier contains 'productreviews'
                  assign is_product_reviews_block = true
                endif
                assign block_type_token = '|' | append: block.type | append: '|'
                assign is_module_block = false
                if product_module_block_types contains block_type_token
                  assign is_module_block = true
                endif
              %}
              {% unless is_product_reviews_block or is_module_block %}
                {% render block %}
                {% break %}
              {% endunless %}
            {% endfor %}
          </div>
        {% endunless %}

        {% if product_badge_label != blank %}
          <div class="sb-product-main__badge-wrap" data-sb-reveal-item>
            <span class="sb-product-main__badge sb-product-main__badge--{{ product_badge_type }} font-caption weight-semibold">
              {{ product_badge_label }}
            </span>
          </div>
        {% endif %}

        <h1 class="sb-product-main__title font-title weight-bold" data-sb-reveal-item>{{ product.title }}</h1>
        {% if product_tagline_html != blank %}
          <div class="sb-product-main__tagline font-body weight-regular rte" data-sb-reveal-item>
            {{ product_tagline_html }}
          </div>
        {% elsif product_tagline != blank %}
          <p class="sb-product-main__tagline font-body weight-regular" data-sb-reveal-item>{{ product_tagline }}</p>
        {% endif %}
      </div>

      {% if product_usps_values_collection != blank %}
        <div class="sb-product-main__feature-pills" data-sb-reveal-item>
          {% for usp_item in product_usps_values_collection %}
            {% liquid
              assign usp_entry = usp_item.value | default: usp_item.reference.value | default: usp_item.reference | default: usp_item
              assign usp_icon = usp_entry.usp_icon_image.value | default: usp_entry.usp_icon_image
              assign usp_title = usp_entry.usp_title.value | default: usp_entry.usp_title
              assign usp_gradient_ref = usp_entry.gradient.value | default: usp_entry.gradient.reference | default: usp_entry.gradient
              assign usp_gradient_key = usp_gradient_ref.gradient.value | default: usp_gradient_ref.gradient | default: usp_entry.gradient.value | default: usp_entry.gradient
              assign usp_gradient_key = usp_gradient_key | downcase | strip
              assign usp_gradient = 'var(--sb-color-neutral-900)'

              case usp_gradient_key
                when 'gradient 1', 'default 1', 'gradient1', 'default1'
                  assign usp_gradient = 'var(--sb-gradient-default-1)'
                when 'gradient 2', 'default 2', 'gradient2', 'default2'
                  assign usp_gradient = 'var(--sb-gradient-default-2)'
                when 'gradient 3', 'default 3', 'gradient3', 'default3'
                  assign usp_gradient = 'var(--sb-gradient-default-3)'
                when 'gradient 4', 'default 4', 'gradient4', 'default4'
                  assign usp_gradient = 'var(--sb-gradient-default-4)'
                when 'gradient 5', 'default 5', 'gradient5', 'default5'
                  assign usp_gradient = 'var(--sb-gradient-default-5)'
                when 'spark 1', 'spark1'
                  assign usp_gradient = 'var(--sb-gradient-spark-1)'
                when 'spark 2', 'spark2'
                  assign usp_gradient = 'var(--sb-gradient-spark-2)'
                when 'spark 3', 'spark3'
                  assign usp_gradient = 'var(--sb-gradient-spark-3)'
                when 'spark 4', 'spark4'
                  assign usp_gradient = 'var(--sb-gradient-spark-4)'
                when 'spark 5', 'spark5'
                  assign usp_gradient = 'var(--sb-gradient-spark-5)'
              endcase
            %}
            {% if usp_title != blank %}
              {% if usp_icon != blank %}
                {% assign usp_icon_url = usp_icon | image_url: width: 108 %}
              {% else %}
                {% assign usp_icon_url = blank %}
              {% endif %}
              <div
                class="sb-product-main__feature-pill"
                style="--sb-product-usp-gradient: {{ usp_gradient }};{% if usp_icon_url != blank %} --sb-product-usp-mask-url: url('{{ usp_icon_url }}');{% endif %}"
              >
                {% if usp_icon_url != blank %}
                  <span class="sb-product-main__feature-pill-icon" aria-hidden="true"></span>
                {% endif %}
                <span class="sb-product-main__feature-pill-text font-caption weight-semibold">{{ usp_title }}</span>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}

      <div class="sb-product-main__purchase" data-sb-reveal-item>
        {% form 'product', product, class: 'sb-product-main__form' %}
          <input type="hidden" name="id" value="{{ form_variant_id }}" data-product-variant-id>

          {% if selector_list_mode != 'none' %}
            <div class="sb-product-main__selector-list">
              <p class="sb-product-main__variant-title font-callout weight-bold">{{ selector_list_heading }}</p>
              <div class="sb-product-main__selector-list-items">
                {% if selector_list_mode == 'variant' %}
                  {% assign selector_option_index = selector_list_option_position | minus: 1 %}
                  {% assign selector_option_values = blank %}
                  {% for option in product.options_with_values %}
                    {% if option.position == selector_list_option_position %}
                      {% assign selector_option_values = option.values %}
                      {% break %}
                    {% endif %}
                  {% endfor %}
                  {% assign selected_selector_option_value = current_variant.options[selector_option_index] %}

                  {% for option_value in selector_option_values %}
                    {% liquid
                      assign option_value_label = option_value.name | default: option_value
                      assign selector_variant = blank
                      for variant in product.variants
                        if variant.options[selector_option_index] == option_value_label
                          assign selector_variant = variant
                          break
                        endif
                      endfor
                      if selector_variant == blank
                        continue
                      endif
                      assign selector_is_selected = false
                      if option_value_label == selected_selector_option_value
                        assign selector_is_selected = true
                      endif
                      assign selector_has_compare = false
                      if selector_variant.compare_at_price > selector_variant.price
                        assign selector_has_compare = true
                      endif
                    %}
                    <button
                      type="button"
                      class="sb-product-main__selector-list-item{% if selector_is_selected %} is-selected{% endif %}"
                      data-selector-list-item
                      data-selector-list-mode="variant"
                      data-selector-option-value="{{ option_value_label | escape }}"
                      data-variant-id="{{ selector_variant.id }}"
                      data-variant-available="{% if selector_variant.available %}true{% else %}false{% endif %}"
                      data-variant-price="{{ selector_variant.price | plus: 0 }}"
                      data-variant-compare-price="{% if selector_variant.compare_at_price != blank %}{{ selector_variant.compare_at_price | plus: 0 }}{% else %}0{% endif %}"
                      aria-pressed="{% if selector_is_selected %}true{% else %}false{% endif %}"
                    >
                      <span class="sb-product-main__selector-list-item-title font-body weight-bold">{{ option_value_label }}</span>
                      <span class="sb-product-main__selector-list-item-price-row">
                        {% if selector_has_compare %}
                          <span class="sb-product-main__price sb-product-main__price--compare font-body weight-regular">
                            {{ selector_variant.compare_at_price | money }}
                          </span>
                        {% endif %}
                        <span class="sb-product-main__price sb-product-main__price--current font-body weight-regular">
                          {{ selector_variant.price | money }}
                        </span>
                      </span>
                    </button>
                  {% endfor %}
                {% elsif selector_list_mode == 'multipack' %}
                  {% liquid
                    assign current_product_has_compare = false
                    if current_variant.compare_at_price > current_variant.price
                      assign current_product_has_compare = true
                    endif
                  %}
                  <button
                    type="button"
                    class="sb-product-main__selector-list-item{% if current_variant.id == selected_multipack_variant_id %} is-selected{% endif %}"
                    data-selector-list-item
                    data-selector-list-mode="multipack"
                    data-variant-id="{{ current_variant.id }}"
                    data-variant-available="{% if current_variant.available %}true{% else %}false{% endif %}"
                    data-variant-price="{{ current_variant.price | plus: 0 }}"
                    data-variant-compare-price="{% if current_variant.compare_at_price != blank %}{{ current_variant.compare_at_price | plus: 0 }}{% else %}0{% endif %}"
                    aria-pressed="{% if current_variant.id == selected_multipack_variant_id %}true{% else %}false{% endif %}"
                  >
                    <span class="sb-product-main__selector-list-item-title font-body weight-bold">
                      {{ product.title }}
                    </span>
                    <span class="sb-product-main__selector-list-item-price-row">
                      {% if current_product_has_compare %}
                        <span class="sb-product-main__price sb-product-main__price--compare font-body weight-regular">
                          {{ current_variant.compare_at_price | money }}
                        </span>
                      {% endif %}
                      <span class="sb-product-main__price sb-product-main__price--current font-body weight-regular">
                        {{ current_variant.price | money }}
                      </span>
                    </span>
                  </button>

                  {% for multipack_item in product_multipack_items %}
                    {% liquid
                      assign multipack_entry = multipack_item.value | default: multipack_item.reference.value | default: multipack_item.reference | default: multipack_item
                      assign multipack_title = multipack_entry.title.value | default: multipack_entry.title
                      assign multipack_product = multipack_entry.product.value | default: multipack_entry.product
                      if multipack_product == blank
                        continue
                      endif
                      if multipack_product.id == product.id
                        continue
                      endif
                      assign multipack_variant = multipack_product.selected_or_first_available_variant
                      if multipack_variant == blank
                        continue
                      endif
                      assign multipack_is_selected = false
                      if multipack_variant.id == selected_multipack_variant_id
                        assign multipack_is_selected = true
                      endif
                      assign multipack_has_compare = false
                      if multipack_variant.compare_at_price > multipack_variant.price
                        assign multipack_has_compare = true
                      endif
                    %}
                    <button
                      type="button"
                      class="sb-product-main__selector-list-item{% if multipack_is_selected %} is-selected{% endif %}"
                      data-selector-list-item
                      data-selector-list-mode="multipack"
                      data-variant-id="{{ multipack_variant.id }}"
                      data-variant-available="{% if multipack_variant.available %}true{% else %}false{% endif %}"
                      data-variant-price="{{ multipack_variant.price | plus: 0 }}"
                      data-variant-compare-price="{% if multipack_variant.compare_at_price != blank %}{{ multipack_variant.compare_at_price | plus: 0 }}{% else %}0{% endif %}"
                      aria-pressed="{% if multipack_is_selected %}true{% else %}false{% endif %}"
                    >
                      <span class="sb-product-main__selector-list-item-title font-body weight-bold">
                        {{ multipack_title | default: multipack_product.title }}
                      </span>
                      <span class="sb-product-main__selector-list-item-price-row">
                        {% if multipack_has_compare %}
                          <span class="sb-product-main__price sb-product-main__price--compare font-body weight-regular">
                            {{ multipack_variant.compare_at_price | money }}
                          </span>
                        {% endif %}
                        <span class="sb-product-main__price sb-product-main__price--current font-body weight-regular">
                          {{ multipack_variant.price | money }}
                        </span>
                      </span>
                    </button>
                  {% endfor %}
                {% endif %}
              </div>
            </div>
          {% endif %}

          {% if selector_list_mode == 'none' and has_non_color_variant_options %}
            <div class="sb-product-main__variant-picker-groups">
              {% for option in product.options_with_values %}
                {% assign option_name_downcase = option.name | downcase %}
                {% unless option_name_downcase contains 'color' or option_name_downcase contains 'colour' %}
                  {% if option.values.size > 1 %}
                    {% assign option_index = option.position | minus: 1 %}
                    {% assign selected_option_value = current_variant.options[option_index] %}
                    <div class="sb-product-main__variant-group" data-option-position="{{ option.position }}">
                      <p class="sb-product-main__variant-title font-callout weight-bold">{{ option.name }}</p>
                      <div class="sb-product-main__variant-pills">
                        {% for option_value in option.values %}
                          {% assign option_value_label = option_value.name | default: option_value %}
                          {% assign option_value_selected = false %}
                          {% if option_value_label == selected_option_value %}
                            {% assign option_value_selected = true %}
                          {% endif %}
                          <button
                            type="button"
                            class="sb-product-main__variant-pill font-body weight-semibold{% if option_value_selected %} is-active{% endif %}"
                            data-option-value="{{ option_value_label | escape }}"
                            aria-pressed="{% if option_value_selected %}true{% else %}false{% endif %}"
                          >
                            {{ option_value_label }}
                          </button>
                        {% endfor %}
                      </div>
                    </div>
                  {% endif %}
                {% endunless %}
              {% endfor %}
            </div>
          {% endif %}

          {% for block in section.blocks %}
            {% if block.type == 'variant_explainer_box' and product_variant_explainer_body != blank %}
              <div class="sb-product-main__variant-explainer font-body weight-regular" {{ block.shopify_attributes }}>
                {{ product_variant_explainer_body }}
              </div>
              {% break %}
            {% endif %}
          {% endfor %}

          {% if has_color_variant_options %}
            <div class="sb-product-main__color-picker-groups">
              {% for option in product.options_with_values %}
                {% assign option_name_downcase = option.name | downcase %}
                {% if option_name_downcase contains 'color' or option_name_downcase contains 'colour' %}
                  {% if option.values.size > 1 %}
                    {% assign option_index = option.position | minus: 1 %}
                    {% assign selected_option_value = current_variant.options[option_index] %}
                    <div class="sb-product-main__color-group" data-option-position="{{ option.position }}" data-option-type="color">
                      <p class="sb-product-main__variant-title font-callout weight-bold">
                        {{ option.name }} - <span data-color-selected-label>{{ selected_option_value }}</span>
                      </p>
                      <div class="sb-product-main__color-swatches">
                        {% for option_value in option.values %}
                          {% assign option_value_label = option_value.name | default: option_value %}
                          {% assign option_value_selected = false %}
                          {% if option_value_label == selected_option_value %}
                            {% assign option_value_selected = true %}
                          {% endif %}
                          {% assign option_value_swatch_color = option_value.swatch.color | default: option_value_label %}
                          <button
                            type="button"
                            class="sb-product-main__color-swatch{% if option_value_selected %} is-selected{% endif %}"
                            style="--sb-swatch-color: {{ option_value_swatch_color }};"
                            data-option-value="{{ option_value_label | escape }}"
                            aria-label="{{ option_value_label }}"
                            aria-pressed="{% if option_value_selected %}true{% else %}false{% endif %}"
                          >
                            <span class="sb-product-main__color-swatch-fill" aria-hidden="true"></span>
                          </button>
                        {% endfor %}
                      </div>
                    </div>
                  {% endif %}
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}

          {% liquid
            assign show_compare_price = false
            assign savings_percentage = 0
            if current_variant.compare_at_price > current_variant.price
              assign show_compare_price = true
              if current_variant.compare_at_price > 0
                assign savings_percentage = current_variant.compare_at_price | minus: current_variant.price | times: 100.0 | divided_by: current_variant.compare_at_price | round
              endif
            endif
          %}
          {% if selector_list_mode == 'none' %}
            <div class="sb-product-main__price-row" data-product-price-row data-currency="{{ cart.currency.iso_code | default: shop.currency }}">
              <div class="sb-product-main__price-values">
                <p
                  class="sb-product-main__price sb-product-main__price--compare font-body weight-regular"
                  data-product-compare-price
                  {% unless show_compare_price %}
                    hidden
                  {% endunless %}
                >
                  {{ current_variant.compare_at_price | money }}
                </p>
                <p class="sb-product-main__price sb-product-main__price--current font-body weight-regular" data-product-current-price>
                  {{ current_variant.price | money }}
                </p>
              </div>
              <span
                class="sb-product-main__savings-badge font-caption weight-bold"
                data-product-savings-badge
                {% unless show_compare_price %}
                  hidden
                {% endunless %}
              >
                Save {{ savings_percentage }}%
              </span>
            </div>
          {% endif %}

          <div class="sb-product-main__checkout-buttons">
            <button
              class="sb-product-main__add-button sb-button-radiant sb-button-radiant--large sb-button-radiant--leading-icon font-caption weight-bold"
              type="submit"
              name="add"
              {% unless current_variant.available %}
                disabled
              {% endunless %}
              aria-label="{% if current_variant.available %}Add to cart{% else %}Sold out{% endif %}"
            >
              <span class="sb-product-main__add-button-icon" aria-hidden="true">
                {% if add_to_cart_icon_type == 'arrow' %}
                  {{ 'icon-arrow-large-40.svg' | inline_asset_content }}
                {% else %}
                  <img
                    class="sb-product-main__add-button-icon-image"
                    src="{{ 'icon-add-to-cart.svg' | asset_url }}"
                    alt=""
                    width="16"
                    height="16"
                  >
                {% endif %}
              </span>
              <span class="sb-product-main__add-button-label" data-add-button-label>
              {% if current_variant.available %}
                Add to cart
              {% else %}
                Sold out
              {% endif %}
              </span>
            </button>

            <button
              class="sb-product-main__shop-pay-button sb-button-radiant sb-button-radiant--large sb-button-radiant--shop-pay sb-button-radiant--trailing-icon font-caption weight-bold"
              type="button"
              data-shop-pay-button
              aria-label="Buy with Shop Pay"
            >
              <span class="sb-button-radiant__label">Buy with</span>
              <span class="sb-button-radiant__icon" aria-hidden="true">
                {{ 'icon-shop-pay-logo.svg' | inline_asset_content }}
              </span>
            </button>
          </div>

          {% unless product_hide_purchase_guarantees %}
            <div class="sb-product-main__purchase-guarantees">
              <ul class="sb-product-main__purchase-guarantees-list" aria-label="Purchase guarantees">
                <li class="sb-product-main__purchase-guarantee-item">
                  <span class="sb-product-main__purchase-guarantee-icon" aria-hidden="true">
                    {{ 'icon-purchase-guarantee-featured.svg' | inline_asset_content }}
                  </span>
                  <span class="sb-product-main__purchase-guarantee-text font-body weight-regular">Free shipping over XX</span>
                </li>
                <li class="sb-product-main__purchase-guarantee-item">
                  <span class="sb-product-main__purchase-guarantee-icon" aria-hidden="true">
                    {{ 'icon-purchase-guarantee-shipping.svg' | inline_asset_content }}
                  </span>
                  <span class="sb-product-main__purchase-guarantee-text font-body weight-regular"
                    >X-X days delivery in XX</span
                  >
                </li>
                <li class="sb-product-main__purchase-guarantee-item">
                  <span class="sb-product-main__purchase-guarantee-icon" aria-hidden="true">
                    {{ 'icon-purchase-guarantee-account-balance.svg' | inline_asset_content }}
                  </span>
                  <span class="sb-product-main__purchase-guarantee-text font-body weight-regular"
                    >All taxes &amp; duties included in price</span
                  >
                </li>
                <li class="sb-product-main__purchase-guarantee-item">
                  <span class="sb-product-main__purchase-guarantee-icon" aria-hidden="true">
                    {{ 'icon-purchase-guarantee-autorenew.svg' | inline_asset_content }}
                  </span>
                  <span class="sb-product-main__purchase-guarantee-text font-body weight-regular">30-day money-back guarantee</span>
                </li>
                <li class="sb-product-main__purchase-guarantee-item">
                  <span class="sb-product-main__purchase-guarantee-icon" aria-hidden="true">
                    {{ 'icon-purchase-guarantee-verified-user.svg' | inline_asset_content }}
                  </span>
                  <span class="sb-product-main__purchase-guarantee-text font-body weight-regular">1-year warranty</span>
                </li>
                {% if show_shop_pay_guarantee %}
                  <li class="sb-product-main__purchase-guarantee-item sb-product-main__purchase-guarantee-item--shop-pay">
                    <span class="sb-product-main__purchase-guarantee-icon" aria-hidden="true">
                      {{ 'icon-purchase-guarantee-pie-chart.svg' | inline_asset_content }}
                    </span>
                    <span class="sb-product-main__purchase-guarantee-text font-body weight-regular">
                      Shop Pay installments from&nbsp;<span data-product-monthly-price>{{ current_variant.price | times: 0.01 | divided_by: 4.0 | round | times: 100 | money_without_trailing_zeros }}</span>
                    </span>
                  </li>
                {% endif %}
              </ul>
            </div>
          {% endunless %}

          {% liquid
            assign addon_items_rendered = 0
          %}
          {% capture addon_items_markup %}
            {% for addon_item in product_addon_products %}
              {% liquid
                assign addon_product = addon_item.value | default: addon_item.product.value | default: addon_item.product | default: addon_item.reference.value | default: addon_item.reference | default: addon_item
                if addon_product == blank or addon_product.handle == blank
                  continue
                endif
                assign addon_selected_variant = addon_product.selected_or_first_available_variant
                if addon_selected_variant == blank
                  continue
                endif
                assign addon_has_compare_price = false
                if addon_selected_variant.compare_at_price > addon_selected_variant.price
                  assign addon_has_compare_price = true
                endif
                assign addon_image = addon_selected_variant.featured_image | default: addon_product.featured_image
                assign addon_selected_variant_url = addon_product.url | append: '?variant=' | append: addon_selected_variant.id
                assign addon_color_option_count = 0
                assign addon_non_color_option_count = 0
              %}
              <article class="sb-product-main__addon-item" data-addon-item data-addon-item-id="{{ addon_product.id }}" data-addon-product-url="{{ addon_product.url }}">
                <a class="sb-product-main__addon-image-link" href="{{ addon_selected_variant_url }}" target="_blank" rel="noopener noreferrer" data-addon-product-link>
                  {% if addon_image != blank %}
                    {% assign addon_image_width = addon_image.width | at_most: 384 %}
                    <img
                      class="sb-product-main__addon-image"
                      src="{{ addon_image | image_url: width: addon_image_width }}"
                      alt="{{ addon_image.alt | default: addon_product.title | escape }}"
                      loading="lazy"
                      width="128"
                      height="128"
                      data-addon-image
                    >
                  {% else %}
                    <div class="sb-product-main__addon-image sb-product-main__addon-image--placeholder" data-addon-image aria-hidden="true"></div>
                  {% endif %}
                </a>

                <div class="sb-product-main__addon-details">
                  <a class="sb-product-main__addon-title font-body weight-bold" href="{{ addon_selected_variant_url }}" target="_blank" rel="noopener noreferrer" data-addon-product-link>{{ addon_product.title }}</a>

                  <div class="sb-product-main__addon-price-row" data-addon-price-row>
                    <p class="sb-product-main__addon-price sb-product-main__addon-price--compare font-body weight-regular" data-addon-compare-price{% unless addon_has_compare_price %} hidden{% endunless %}>
                      {{ addon_selected_variant.compare_at_price | money }}
                    </p>
                    <p class="sb-product-main__addon-price sb-product-main__addon-price--current font-body weight-regular" data-addon-current-price>
                      {{ addon_selected_variant.price | money }}
                    </p>
                  </div>

                  {% for addon_option in addon_product.options_with_values %}
                    {% assign addon_option_name_downcase = addon_option.name | downcase %}
                    {% unless addon_option_name_downcase contains 'color' or addon_option_name_downcase contains 'colour' %}
                      {% if addon_option.values.size > 1 %}
                        {% assign addon_non_color_option_count = addon_non_color_option_count | plus: 1 %}
                        {% assign addon_option_index = addon_option.position | minus: 1 %}
                        {% assign addon_selected_option_value = addon_selected_variant.options[addon_option_index] %}
                        <div class="sb-product-main__addon-option-group" data-addon-option-position="{{ addon_option.position }}">
                          <div class="sb-product-main__addon-option-pills">
                            {% for addon_option_value in addon_option.values %}
                              {% assign addon_option_value_label = addon_option_value.name | default: addon_option_value %}
                              <button
                                type="button"
                                class="sb-product-main__addon-option-pill font-caption weight-semibold{% if addon_option_value_label == addon_selected_option_value %} is-active{% endif %}"
                                data-addon-option-value="{{ addon_option_value_label | escape }}"
                                aria-pressed="{% if addon_option_value_label == addon_selected_option_value %}true{% else %}false{% endif %}"
                              >
                                {{ addon_option_value_label }}
                              </button>
                            {% endfor %}
                          </div>
                        </div>
                      {% endif %}
                    {% endunless %}
                  {% endfor %}

                  {% for addon_option in addon_product.options_with_values %}
                    {% assign addon_option_name_downcase = addon_option.name | downcase %}
                    {% if addon_option_name_downcase contains 'color' or addon_option_name_downcase contains 'colour' %}
                      {% if addon_option.values.size > 1 %}
                        {% assign addon_color_option_count = addon_color_option_count | plus: 1 %}
                        {% assign addon_option_index = addon_option.position | minus: 1 %}
                        {% assign addon_selected_option_value = addon_selected_variant.options[addon_option_index] %}
                        <div class="sb-product-main__addon-color-group" data-addon-option-position="{{ addon_option.position }}" data-addon-option-type="color">
                          <div class="sb-product-main__addon-color-swatches">
                            {% for addon_option_value in addon_option.values %}
                              {% assign addon_option_value_label = addon_option_value.name | default: addon_option_value %}
                              {% assign addon_option_value_swatch_color = addon_option_value.swatch.color | default: addon_option_value_label %}
                              <button
                                type="button"
                                class="sb-product-main__addon-color-swatch{% if addon_option_value_label == addon_selected_option_value %} is-selected{% endif %}"
                                style="--sb-swatch-color: {{ addon_option_value_swatch_color }};"
                                data-addon-option-value="{{ addon_option_value_label | escape }}"
                                aria-label="{{ addon_option_value_label }}"
                                aria-pressed="{% if addon_option_value_label == addon_selected_option_value %}true{% else %}false{% endif %}"
                              >
                                <span class="sb-product-main__addon-color-swatch-fill" aria-hidden="true"></span>
                              </button>
                            {% endfor %}
                          </div>
                        </div>
                      {% endif %}
                    {% endif %}
                  {% endfor %}

                  <div class="sb-product-main__addon-actions">
                    <button
                      type="button"
                      class="sb-product-main__addon-add-button sb-button-radiant sb-button-radiant--medium sb-button-radiant--leading-icon font-caption weight-bold"
                      data-addon-add-to-cart
                      data-addon-variant-id="{{ addon_selected_variant.id }}"
                      aria-label="Add"
                    >
                      <span class="sb-button-radiant__icon sb-product-main__addon-add-button-icon" aria-hidden="true">
                        <img src="{{ 'icon-add-to-cart.svg' | asset_url }}" alt="" width="16" height="16">
                      </span>
                      <span class="sb-button-radiant__label" data-addon-add-label>Add</span>
                    </button>
                    <a class="sb-product-main__addon-view-button sb-button-outline-pill-medium font-caption weight-semibold" href="{{ addon_selected_variant_url }}" target="_blank" rel="noopener noreferrer" data-addon-product-link>
                      Learn more
                    </a>
                  </div>
                </div>

                <script type="application/json" data-addon-variants-json>
                  {{ addon_product.variants | json }}
                </script>
                {% if addon_product.options_with_values != blank %}
                  {% assign addon_option_count = addon_product.options_with_values.size %}
                {% else %}
                  {% assign addon_option_count = 0 %}
                {% endif %}
                <script type="application/json" data-addon-media-map-json>
                  {
                    {% for addon_variant in addon_product.variants %}
                      {% liquid
                        assign addon_variant_image = addon_variant.featured_image | default: addon_product.featured_image
                        assign addon_variant_image_url = blank
                        if addon_variant_image != blank
                          assign addon_variant_image_width = addon_variant_image.width | at_most: 384
                          assign addon_variant_image_url = addon_variant_image | image_url: width: addon_variant_image_width
                        endif
                      %}
                      "{{ addon_variant.id }}": {{ addon_variant_image_url | json }}{% unless forloop.last %},{% endunless %}
                    {% endfor %}
                  }
                </script>
                <script type="application/json" data-addon-hover-map-json>
                  {
                    {% for addon_variant in addon_product.variants %}
                      {% liquid
                        assign addon_hover_image = blank
                        assign addon_hover_variant_ref = addon_variant.metafields.custom.sbv2_hover_photo
                        if addon_hover_variant_ref != blank
                          assign addon_hover_image = addon_hover_variant_ref.value
                          if addon_hover_image == blank
                            assign addon_hover_image = addon_hover_variant_ref
                          endif
                        endif
                        if addon_hover_image == blank
                          assign addon_hover_product_ref = addon_product.metafields.custom.sbv2_hover_photo
                          if addon_hover_product_ref != blank
                            assign addon_hover_image = addon_hover_product_ref.value
                            if addon_hover_image == blank
                              assign addon_hover_image = addon_hover_product_ref
                            endif
                          endif
                        endif
                        assign addon_hover_image_url = blank
                        if addon_hover_image != blank
                          assign addon_hover_image_url = addon_hover_image | image_url: width: 384
                        endif
                      %}
                      "{{ addon_variant.id }}": {{ addon_hover_image_url | json }}{% unless forloop.last %},{% endunless %}
                    {% endfor %}
                  }
                </script>
              </article>
              {% assign addon_items_rendered = addon_items_rendered | plus: 1 %}
            {% endfor %}
          {% endcapture %}

          {% for block in section.blocks %}
            {% case block.type %}
              {% when 'delivery_explainer_box' %}
                {% if product_delivery_explainer_title != blank or product_delivery_explainer_body_html != blank or product_delivery_explainer_progress_subtitle != blank %}
                  {% assign delivery_progress_width = product_delivery_explainer_progress_percent | plus: 0 %}
                  {% if delivery_progress_width < 0 %}
                    {% assign delivery_progress_width = 0 %}
                  {% endif %}
                  {% if delivery_progress_width > 100 %}
                    {% assign delivery_progress_width = 100 %}
                  {% endif %}
                  <div class="sb-product-main__delivery-explainer" {{ block.shopify_attributes }}>
                    {% if product_delivery_explainer_title != blank %}
                      <p class="sb-product-main__delivery-explainer-title font-body weight-bold">{{ product_delivery_explainer_title }}</p>
                    {% endif %}
                    {% if product_delivery_explainer_body_html != blank %}
                      <div class="sb-product-main__delivery-explainer-body font-body weight-regular rte">{{ product_delivery_explainer_body_html }}</div>
                    {% endif %}
                    <div class="hProgressBarW">
                      <div class="hProgressBar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{ delivery_progress_width }}">
                        <div class="progress" style="width: {{ delivery_progress_width }}%;"></div>
                      </div>
                      {% if product_delivery_explainer_progress_subtitle != blank %}
                        <p class="sb-product-main__delivery-explainer-subtitle font-body weight-regular">{{ product_delivery_explainer_progress_subtitle }}</p>
                      {% endif %}
                    </div>
                  </div>
                {% endif %}

              {% when 'video_stories' %}
                {% if product_video_story_items != blank %}
                  {% assign video_story_count = 0 %}
                  {% for story_item in product_video_story_items limit: 4 %}
                    {% liquid
                      assign story_entry = story_item.value | default: story_item.reference.value | default: story_item.reference | default: story_item
                      assign story_video = story_entry.video_file.value | default: story_entry.video_file
                      if story_video != blank
                        assign video_story_count = video_story_count | plus: 1
                      endif
                    %}
                  {% endfor %}

                  {% if video_story_count > 0 %}
                    <div class="sb-product-main__video-stories" data-video-stories {{ block.shopify_attributes }}>
                      <div class="sb-product-main__video-stories-list" data-video-story-count="{{ video_story_count }}">
                        {% for story_item in product_video_story_items limit: 4 %}
                          {% liquid
                            assign story_entry = story_item.value | default: story_item.reference.value | default: story_item.reference | default: story_item
                            assign story_video = story_entry.video_file.value | default: story_entry.video_file
                            assign story_video_url = blank
                            if story_video.sources != blank
                              for story_video_source in story_video.sources
                                assign story_source_url = story_video_source.url | default: story_video_source.src
                                assign story_source_format = story_video_source.format | downcase
                                assign story_source_mime = story_video_source.mime_type | downcase
                                if story_source_url != blank
                                  if story_source_format contains 'mp4' or story_source_mime contains 'mp4'
                                    assign story_video_url = story_source_url
                                    break
                                  endif
                                  if story_video_url == blank
                                    assign story_video_url = story_source_url
                                  endif
                                endif
                              endfor
                            endif
                            if story_video_url == blank
                              assign story_video_url = story_video.url | default: story_video
                            endif
                            assign story_poster = story_entry.video_poster.value | default: story_entry.video_poster
                            if story_video_url == blank or story_poster == blank
                              continue
                            endif
                            assign story_poster_url = story_poster | image_url: width: 282
                          %}
                          <button
                            type="button"
                            class="sb-product-main__video-story"
                            data-video-story-trigger
                            data-video-story-url="{{ story_video_url | escape }}"
                            aria-label="Play video"
                          >
                            <span class="sb-product-main__video-story-inner">
                              <img
                                class="sb-product-main__video-story-poster"
                                src="{{ story_poster_url }}"
                                alt=""
                                loading="lazy"
                                width="94"
                                height="94"
                              >
                            </span>
                          </button>
                        {% endfor %}
                      </div>
                    </div>

                    <div class="sb-product-main__video-story-modal" data-video-story-modal hidden>
                      <button
                        type="button"
                        class="sb-product-main__video-story-modal-backdrop"
                        data-video-story-close
                        aria-label="Close video"
                      ></button>
                      <div class="sb-product-main__video-story-modal-panel" role="dialog" aria-modal="true" aria-label="Video story player">
                        <button
                          type="button"
                          class="sb-product-main__video-story-modal-close"
                          data-video-story-close
                          aria-label="Close video"
                        >
                          
                        </button>
                        <video
                          class="sb-product-main__video-story-player"
                          data-video-story-player
                          controls
                          playsinline
                          preload="metadata"
                        ></video>
                      </div>
                    </div>
                  {% endif %}
                {% endif %}

              {% when 'in_the_box' %}
                {% if product.has_only_default_variant == false or product_in_the_box_items != blank %}
                  <div
                    class="sb-product-main__in-the-box"
                    data-in-the-box
                    {% if product_in_the_box_items == blank %}
                      hidden
                    {% endif %}
                    {{ block.shopify_attributes }}
                  >
                    <h2 class="sb-product-main__in-the-box-title font-callout weight-bold">In the box</h2>
                    <div class="sb-product-main__in-the-box-grid" data-in-the-box-grid>
                      {% for in_the_box_item in product_in_the_box_items %}
                        {% liquid
                          assign in_the_box_entry = in_the_box_item.value | default: in_the_box_item.reference.value | default: in_the_box_item.reference | default: in_the_box_item
                          assign in_the_box_media_field = in_the_box_entry.product_media
                          assign in_the_box_media_source = in_the_box_media_field.value | default: in_the_box_media_field.reference.value | default: in_the_box_media_field.reference | default: in_the_box_media_field
                          assign in_the_box_media = blank
                          for in_the_box_media_candidate in in_the_box_media_source limit: 1
                            assign in_the_box_media = in_the_box_media_candidate
                          endfor
                          if in_the_box_media == blank
                            assign in_the_box_media = in_the_box_media_source
                          endif
                          assign in_the_box_title = in_the_box_entry.product_title.value | default: in_the_box_entry.product_title
                          if in_the_box_title == blank
                            continue
                          endif
                          assign in_the_box_media_url = blank
                          if in_the_box_media.url != blank
                            assign in_the_box_media_url = in_the_box_media.url
                          elsif in_the_box_media.src != blank
                            assign in_the_box_media_url = in_the_box_media.src
                          elsif in_the_box_media.preview_image != blank
                            assign in_the_box_media_url = in_the_box_media.preview_image | image_url: width: 480
                          elsif in_the_box_media.image != blank
                            assign in_the_box_media_url = in_the_box_media.image | image_url: width: 480
                          endif
                          if in_the_box_media_url == blank and in_the_box_media != blank
                            assign in_the_box_media_url = in_the_box_media | file_url
                            if in_the_box_media_url contains 'Liquid error' or in_the_box_media_url contains 'MediaListDrop'
                              assign in_the_box_media_url = blank
                            endif
                          endif
                          if in_the_box_media_url != blank and in_the_box_media_url contains 'files/'
                            unless in_the_box_media_url contains '/cdn/shop/' or in_the_box_media_url contains '://'
                              assign in_the_box_media_url_prefix_files = in_the_box_media_url | slice: 0, 6
                              assign in_the_box_media_url_prefix_slash_files = in_the_box_media_url | slice: 0, 7
                              if in_the_box_media_url_prefix_files == 'files/'
                                assign in_the_box_media_url = '/cdn/shop/' | append: in_the_box_media_url
                              elsif in_the_box_media_url_prefix_slash_files == '/files/'
                                assign in_the_box_media_url = '/cdn/shop' | append: in_the_box_media_url
                              endif
                            endunless
                          endif
                        %}
                        <article class="sb-product-main__in-the-box-item">
                          {% if in_the_box_media_url != blank %}
                            <img
                              class="sb-product-main__in-the-box-image"
                              src="{{ in_the_box_media_url }}"
                              alt="{{ in_the_box_title | escape }}"
                              loading="lazy"
                              width="160"
                              height="160"
                            >
                          {% else %}
                            <div class="sb-product-main__in-the-box-image" aria-hidden="true"></div>
                          {% endif %}
                          <p class="sb-product-main__in-the-box-text font-caption weight-regular">{{ in_the_box_title }}</p>
                        </article>
                      {% endfor %}
                    </div>
                    <div
                      class="sb-product-main__in-the-box-divider"
                      data-in-the-box-divider
                      aria-hidden="true"
                      {% if product_in_the_box_items == blank %}
                        hidden
                      {% endif %}
                    ></div>
                  </div>
                {% endif %}

              {% when 'description' %}
                {% if product_has_tagline_override and product.description != blank %}
                  <article class="sb-product-main__description-accordion-item" data-product-description-item {{ block.shopify_attributes }}>
                    <button
                      type="button"
                      class="sb-product-main__description-accordion-trigger"
                      aria-expanded="false"
                      data-product-description-trigger
                    >
                      <span class="sb-product-main__description-accordion-title font-callout weight-bold">Description</span>
                      <span class="sb-product-main__description-accordion-icon" aria-hidden="true">
                        <span class="sb-product-main__description-accordion-icon-plus">{{ 'icon-accordion-add.svg' | inline_asset_content }}</span>
                        <span class="sb-product-main__description-accordion-icon-close">{{ 'icon-accordion-close.svg' | inline_asset_content }}</span>
                      </span>
                    </button>
                    <div class="sb-product-main__description-accordion-answer rte font-body weight-regular" data-product-description-answer>
                      {{ product.description }}
                    </div>
                    <hr class="sb-product-main__description-accordion-divider" aria-hidden="true">
                  </article>
                {% endif %}

              {% when 'popular_add_ons' %}
                {% if addon_items_rendered > 0 %}
                  <section class="sb-product-main__popular-addins" {{ block.shopify_attributes }}>
                    <h2 class="sb-product-main__popular-addins-title font-callout weight-bold">Popular add-ons</h2>
                    <div class="sb-product-main__popular-addins-list">
                      {{ addon_items_markup }}
                    </div>
                  </section>
                {% endif %}
            {% endcase %}
          {% endfor %}

          <div class="sb-product-main__dynamic-checkout">
            {{ form | payment_button }}
          </div>
        {% endform %}
      </div>
    </div>
  </div>

  <script type="application/json" data-product-variants-json>
    {{ product.variants | json }}
  </script>
  {% if use_variant_media_gallery %}
    <script type="application/json" data-product-variant-media-json>
      {
        {% for variant in product.variants %}
          {% liquid
            assign variant_media_tokens = blank
            assign variant_primary_image = blank

            if variant.featured_image != blank
              assign variant_primary_image = variant.featured_image | image_url: width: 1440
            elsif product.featured_image != blank
              assign variant_primary_image = product.featured_image | image_url: width: 1440
            endif

            if variant_primary_image != blank
              assign variant_media_tokens = 'image::' | append: variant_primary_image
            endif

            assign variant_gallery_images = variant.metafields.custom.images.value | default: variant.metafields.custom.images
            if variant_gallery_images != blank
              for variant_gallery_image in variant_gallery_images
                assign variant_gallery_media = variant_gallery_image.value | default: variant_gallery_image
                assign variant_gallery_type = variant_gallery_media.media_type | default: 'image'
                assign variant_gallery_image_url = blank
                assign variant_gallery_video_url = blank
                assign variant_gallery_poster_url = blank

                if variant_gallery_type == 'video'
                  if variant_gallery_media.sources != blank
                    for variant_video_source in variant_gallery_media.sources
                      assign variant_gallery_video_url = variant_video_source.url | default: variant_video_source.src
                      if variant_gallery_video_url != blank
                        break
                      endif
                    endfor
                  endif
                  if variant_gallery_media.preview_image != blank
                    assign variant_gallery_poster_url = variant_gallery_media.preview_image | image_url: width: 1440
                  endif
                else
                  if variant_gallery_media.preview_image != blank
                    assign variant_gallery_image_url = variant_gallery_media.preview_image | image_url: width: 1440
                  elsif variant_gallery_media != blank
                    assign variant_gallery_image_url = variant_gallery_media | image_url: width: 1440
                  endif
                endif

                assign variant_gallery_token = blank
                if variant_gallery_video_url != blank
                  assign variant_gallery_token = 'video::' | append: variant_gallery_video_url
                  if variant_gallery_poster_url != blank
                    assign variant_gallery_token = variant_gallery_token | append: '::' | append: variant_gallery_poster_url
                  endif
                elsif variant_gallery_image_url != blank and variant_gallery_image_url != variant_primary_image
                  assign variant_gallery_token = 'image::' | append: variant_gallery_image_url
                endif

                if variant_gallery_token != blank
                  if variant_media_tokens != blank
                    assign variant_media_tokens = variant_media_tokens | append: '||'
                  endif
                  assign variant_media_tokens = variant_media_tokens | append: variant_gallery_token
                endif
              endfor
            endif
          %}
          {% assign variant_media_array = variant_media_tokens | split: '||' %}
          "{{ variant.id }}": {{ variant_media_array | json }}{% unless forloop.last %},{% endunless %}
        {% endfor %}
      }
    </script>
  {% endif %}
  {% if product.has_only_default_variant == false %}
    <script type="application/json" data-product-variant-in-the-box-json>
      {
        {% for variant in product.variants %}
          {% liquid
            assign variant_box_ref = variant.metafields.custom.sbv2_what_s_in_the_box
            if variant_box_ref == blank
              assign variant_box_ref = product.metafields.custom.sbv2_what_s_in_the_box
            endif
            assign variant_box_root_source = variant_box_ref.value | default: variant_box_ref.reference.value | default: variant_box_ref.reference | default: variant_box_ref
            assign variant_box_root = blank
            for variant_box_root_candidate in variant_box_root_source limit: 1
              assign variant_box_root = variant_box_root_candidate
            endfor
            if variant_box_root == blank
              assign variant_box_root = variant_box_root_source
            endif
            if variant_box_root != blank and variant_box_root.products == blank
              assign variant_box_nested = variant_box_root.sbv2_what_s_in_the_box.value | default: variant_box_root.sbv2_what_s_in_the_box.reference.value | default: variant_box_root.sbv2_what_s_in_the_box.reference | default: variant_box_root.sbv2_what_s_in_the_box
              if variant_box_nested != blank
                assign variant_box_root = variant_box_nested
              endif
            endif
            assign variant_box_items = blank
            if variant_box_root != blank
              assign variant_box_items = variant_box_root.products.value | default: variant_box_root.products.references | default: variant_box_root.products
            endif
          %}
          "{{ variant.id }}": [
            {% assign variant_box_written = 0 %}
            {% for variant_box_item in variant_box_items %}
              {% liquid
                assign variant_box_entry = variant_box_item.value | default: variant_box_item.reference.value | default: variant_box_item.reference | default: variant_box_item
                assign variant_box_media_field = variant_box_entry.product_media
                assign variant_box_media_source = variant_box_media_field.value | default: variant_box_media_field.reference.value | default: variant_box_media_field.reference | default: variant_box_media_field
                assign variant_box_media = blank
                for variant_box_media_candidate in variant_box_media_source limit: 1
                  assign variant_box_media = variant_box_media_candidate
                endfor
                if variant_box_media == blank
                  assign variant_box_media = variant_box_media_source
                endif
                assign variant_box_title = variant_box_entry.product_title.value | default: variant_box_entry.product_title
                if variant_box_title == blank
                  continue
                endif
                assign variant_box_media_url = blank
                if variant_box_media.url != blank
                  assign variant_box_media_url = variant_box_media.url
                elsif variant_box_media.src != blank
                  assign variant_box_media_url = variant_box_media.src
                elsif variant_box_media.preview_image != blank
                  assign variant_box_media_url = variant_box_media.preview_image | image_url: width: 480
                elsif variant_box_media.image != blank
                  assign variant_box_media_url = variant_box_media.image | image_url: width: 480
                endif
                if variant_box_media_url == blank and variant_box_media != blank
                  assign variant_box_media_url = variant_box_media | file_url
                  if variant_box_media_url contains 'Liquid error' or variant_box_media_url contains 'MediaListDrop'
                    assign variant_box_media_url = blank
                  endif
                endif
                if variant_box_media_url != blank and variant_box_media_url contains 'files/'
                  unless variant_box_media_url contains '/cdn/shop/' or variant_box_media_url contains '://'
                    assign variant_box_media_url_prefix_files = variant_box_media_url | slice: 0, 6
                    assign variant_box_media_url_prefix_slash_files = variant_box_media_url | slice: 0, 7
                    if variant_box_media_url_prefix_files == 'files/'
                      assign variant_box_media_url = '/cdn/shop/' | append: variant_box_media_url
                    elsif variant_box_media_url_prefix_slash_files == '/files/'
                      assign variant_box_media_url = '/cdn/shop' | append: variant_box_media_url
                    endif
                  endunless
                endif
              %}
              {% if variant_box_written > 0 %},{% endif %}
              {
                "title": {{ variant_box_title | json }},
                "mediaUrl": {{ variant_box_media_url | json }}
              }
              {% assign variant_box_written = variant_box_written | plus: 1 %}
            {% endfor %}
          ]{% unless forloop.last %},{% endunless %}
        {% endfor %}
      }
    </script>
  {% endif %}
</section>

{% stylesheet %}
  .sb-product-main {
    --sb-product-sticky-bar-height: 0px;
    --sb-product-sticky-offset: 0px;
    --sb-product-gallery-mobile-size: calc((var(--sb-space-128) * 2) + var(--sb-space-4));
    width: 100%;
  }

  .sb-product-main.is-segment-learn-more .sb-product-main__layout {
    display: none;
  }

  .shopify-section.sb-segment-hidden {
    display: none !important;
  }

  .sb-product-main__layout {
    display: grid;
    gap: var(--sb-space-30);
    grid-template-columns: minmax(0, 1fr);
    width: 100%;
  }

  .sb-product-main__sticky-bar-wrap {
    display: none;
  }

  @media (min-width: 750px) {
    .sb-product-main__sticky-bar-wrap {
      --sb-sticky-inline-margin: 60px;
      display: block;
      left: 0;
      position: fixed;
      right: 0;
      top: calc(var(--sb-header-height, 5rem) + var(--sb-space-16));
      width: 100%;
      z-index: 40;
    }

    .sb-product-main__sticky-bar {
      --sb-sticky-segment-max-width: 500px;
      align-items: center;
      background: var(--sb-color-neutral-200);
      border-radius: var(--sb-space-24);
      box-shadow: inset 0 0 0 1px var(--sb-color-neutral-600);
      display: grid;
      gap: var(--sb-space-36);
      grid-template-columns: minmax(0, 1fr) minmax(0, var(--sb-sticky-segment-max-width)) minmax(0, 1fr);
      margin-inline: auto;
      max-width: 1240px;
      padding: var(--sb-space-12) var(--sb-space-24);
      width: min(1240px, calc(100vw - (var(--sb-sticky-inline-margin) * 2)));
    }

    .sb-product-main__sticky-info {
      align-items: center;
      display: flex;
      flex: 1 1 auto;
      gap: var(--sb-space-12);
      min-inline-size: 0;
    }

    .sb-product-main__sticky-image-wrap {
      border-radius: var(--sb-space-12);
      flex: 0 0 auto;
      height: var(--sb-space-48);
      overflow: hidden;
      width: var(--sb-space-48);
    }

    .sb-product-main__sticky-image {
      display: block;
      height: 100%;
      object-fit: cover;
      width: 100%;
    }

    .sb-product-main__sticky-image--placeholder {
      background: var(--sb-color-neutral-300);
    }

    .sb-product-main__sticky-meta {
      min-inline-size: 0;
    }

    .sb-product-main__sticky-meta--no-reviews {
      align-items: center;
      display: flex;
      min-height: var(--sb-space-48);
    }

    .sb-product-main__sticky-price-stack {
      align-items: center;
      display: flex;
      flex-direction: row;
      gap: var(--sb-space-8);
    }

    .sb-product-main__sticky-compare-price {
      color: var(--sb-color-neutral-800);
      text-decoration: line-through;
    }

    .sb-product-main__sticky-current-price {
      color: var(--sb-color-blue-500);
    }

    .sb-product-main__sticky-reviews {
      align-items: center;
      display: flex;
      gap: var(--sb-space-8);
      margin-top: var(--sb-space-4);
    }

    .sb-product-main__sticky-stars {
      display: inline-flex;
      gap: 4px;
      text-decoration: none;
    }

    .sb-product-main__sticky-star {
      display: inline-block;
      height: 12px;
      position: relative;
      width: 12px;
    }

    .sb-product-main__sticky-star::before,
    .sb-product-main__sticky-star::after {
      content: '';
      display: block;
      height: 100%;
      left: 0;
      mask: center / contain no-repeat var(--sb-star-icon-url);
      position: absolute;
      top: 0;
      width: 100%;
      -webkit-mask: center / contain no-repeat var(--sb-star-icon-url);
    }

    .sb-product-main__sticky-star::before {
      background: var(--sb-color-reviews-50);
    }

    .sb-product-main__sticky-star::after {
      background: var(--sb-color-reviews);
      clip-path: inset(0 calc(100% - var(--sb-star-fill)) 0 0);
      -webkit-clip-path: inset(0 calc(100% - var(--sb-star-fill)) 0 0);
    }

    .sb-product-main__sticky-review-count {
      color: var(--sb-color-neutral-900);
      text-decoration: none;
      white-space: nowrap;
    }

    .sb-product-main__sticky-stars:hover,
    .sb-product-main__sticky-stars:focus-visible {
      cursor: pointer;
      opacity: 0.75;
    }

    .sb-product-main__sticky-review-count:hover,
    .sb-product-main__sticky-review-count:focus-visible {
      color: var(--sb-color-primary-500);
      cursor: pointer;
    }

    .sb-product-main__sticky-segmented-wrap {
      display: flex;
      justify-content: center;
      justify-self: center;
      min-width: 0;
      width: 100%;
    }

    .sb-product-main__sticky-segmented-wrap,
    .sb-product-main__sticky-segmented {
      min-inline-size: 0;
    }

    .sb-product-main__sticky-segmented {
      background: var(--sb-color-neutral-100);
      border-radius: var(--sb-space-24);
      --sb-segment-gap: var(--sb-space-8);
      align-items: stretch;
      display: flex;
      gap: var(--sb-space-8);
      height: var(--sb-space-36);
      max-width: none;
      overflow: hidden;
      padding: var(--sb-space-4);
      position: relative;
      width: min(100%, var(--sb-sticky-segment-max-width));
    }

    .sb-product-main__sticky-segment-indicator {
      background: var(--sb-color-neutral-600);
      border-radius: var(--sb-space-24);
      height: calc(100% - (var(--sb-space-4) * 2));
      left: var(--sb-space-4);
      pointer-events: none;
      position: absolute;
      top: var(--sb-space-4);
      transition: left 420ms cubic-bezier(0.22, 1, 0.36, 1), width 420ms cubic-bezier(0.22, 1, 0.36, 1);
      width: calc((100% - (var(--sb-space-4) * 2) - var(--sb-segment-gap)) / 2);
      will-change: left, width;
    }

    .sb-product-main__sticky-segment-pill {
      background: transparent;
      border: 0;
      border-radius: var(--sb-space-24);
      color: var(--sb-color-neutral-900);
      cursor: pointer;
      display: flex;
      flex: 1 1 50%;
      justify-content: center;
      min-height: 0;
      padding: 0 var(--sb-space-12);
      text-align: center;
      align-items: center;
      position: relative;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      z-index: 1;
    }

    .sb-product-main__sticky-segment-pill:hover:not(.is-active),
    .sb-product-main__sticky-segment-pill:focus-visible:not(.is-active) {
      background: var(--sb-color-neutral-700);
    }

    .sb-product-main__sticky-segment-pill.is-active {
      font-weight: 600;
    }

    .sb-product-main__sticky-add-button {
      flex: 0 0 auto;
      justify-self: end;
    }

    @media (max-width: 989px) {
      .sb-product-main__sticky-bar {
        column-gap: var(--sb-space-24);
        grid-template-columns: minmax(0, 1fr) auto;
        row-gap: var(--sb-space-16);
      }

      .sb-product-main__sticky-segmented-wrap {
        display: block;
        grid-column: 1 / -1;
        grid-row: 2;
      }

      .sb-product-main__sticky-segmented {
        max-width: none;
        width: 100%;
      }

      .sb-product-main__sticky-add-button {
        grid-column: 2;
        grid-row: 1;
      }
    }
  }

  .sb-product-main__media-column {
    min-width: 0;
    width: 100%;
  }

  .sb-product-main__media-grid {
    display: grid;
    gap: var(--sb-space-24);
    grid-template-columns: repeat(2, minmax(0, 1fr));
    width: 100%;
  }

  .sb-product-main__media-item {
    background: var(--sb-color-neutral-200);
    border-radius: 24px;
    box-shadow: 0 0 10px 0 var(--sb-color-always-black-12);
    aspect-ratio: 1 / 1;
    overflow: hidden;
    position: relative;
    width: 100%;
  }

  .sb-product-main__media-asset {
    height: 100%;
    object-fit: cover;
    object-position: center;
    width: 100%;
  }

  .sb-product-main__media-video-poster {
    height: 100%;
    left: 0;
    object-fit: cover;
    object-position: center;
    position: absolute;
    top: 0;
    width: 100%;
    z-index: 1;
  }

  .sb-product-main__media-item--video {
    background: var(--sb-color-neutral-200);
  }

  .sb-product-main__media-item--video .sb-product-main__media-asset--video {
    background: var(--sb-color-neutral-200);
    opacity: 0;
    position: relative;
    z-index: 2;
  }

  .sb-product-main__media-item--video.is-video-ready .sb-product-main__media-asset--video {
    opacity: 1;
  }

  .sb-product-main__media-item--video.is-video-ready .sb-product-main__media-video-poster {
    display: none;
  }

  .sb-product-main__info-column {
    align-items: flex-start;
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-36);
    min-width: 0;
    text-align: left;
    width: 100%;
  }

  .sb-product-main__info-top {
    width: 100%;
  }

  .sb-product-main__rating {
    min-height: var(--sb-space-24);
    margin: 0 0 var(--sb-space-24);
  }

  .sb-product-main__info-top--no-badge .sb-product-main__rating {
    margin-bottom: var(--sb-space-20);
  }

  .sb-product-main__badge-wrap {
    margin: 0 0 var(--sb-space-20);
  }

  .sb-product-main__badge {
    border-radius: 12px;
    color: var(--sb-color-always-white);
    display: inline-flex;
    padding: var(--sb-space-8) var(--sb-space-12);
    white-space: nowrap;
  }

  .sb-product-main__badge--bestseller {
    background: var(--sb-color-red-500);
  }

  .sb-product-main__badge--new {
    background: var(--sb-color-primary-500);
  }

  .sb-product-main__title {
    color: var(--sb-color-neutral-900);
    margin: 0;
  }

  .sb-product-main__tagline {
    color: var(--sb-color-neutral-900);
    margin: var(--sb-space-30) 0 0;
  }

  .sb-product-main__tagline > * {
    margin: 0;
  }

  .sb-product-main__tagline > * + * {
    margin-top: var(--sb-space-24);
  }

  .sb-product-main__feature-pills {
    align-items: center;
    display: flex;
    flex-wrap: wrap;
    gap: var(--sb-space-16);
    justify-content: flex-start;
    width: 100%;
  }

  .sb-product-main__feature-pill {
    align-items: center;
    background: var(--sb-color-neutral-200);
    border-radius: 999px;
    display: inline-flex;
    gap: var(--sb-space-4);
    justify-content: flex-start;
    padding: 4px 12px 4px 8px;
  }

  .sb-product-main__feature-pill-icon {
    background: var(--sb-product-usp-gradient, var(--sb-color-neutral-900));
    display: block;
    height: var(--sb-space-36);
    mask-image: var(--sb-product-usp-mask-url);
    mask-position: center;
    mask-repeat: no-repeat;
    mask-size: contain;
    -webkit-mask-image: var(--sb-product-usp-mask-url);
    -webkit-mask-position: center;
    -webkit-mask-repeat: no-repeat;
    -webkit-mask-size: contain;
    width: var(--sb-space-36);
  }

  .sb-product-main__feature-pill-text {
    color: var(--sb-color-neutral-900);
    margin: 0;
  }

  .sb-product-main__purchase {
    width: 100%;
  }

  .sb-product-main__variant-id-select {
    display: none;
  }

  .sb-product-main__variant-picker-groups {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-36);
    width: 100%;
  }

  .sb-product-main__variant-group {
    align-items: flex-start;
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-20);
    margin: 0;
    min-inline-size: 0;
    padding: 0;
    width: 100%;
  }

  .sb-product-main__variant-title {
    color: var(--sb-color-neutral-900);
    font-family: var(--font-display--family);
    margin: 0;
  }

  .sb-product-main__variant-pills {
    display: flex;
    flex-wrap: wrap;
    gap: var(--sb-space-16);
    justify-content: flex-start;
    width: 100%;
  }

  .sb-product-main__selector-list {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-20);
    width: 100%;
  }

  .sb-product-main__selector-list-items {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-16);
    width: 100%;
  }

  .sb-product-main__selector-list-item {
    -webkit-appearance: none;
    appearance: none;
    align-items: flex-start;
    background: transparent;
    border: 0;
    border-radius: 24px;
    box-shadow: inset 0 0 0 1px var(--sb-color-neutral-600);
    color: var(--sb-color-neutral-900);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-8);
    margin: 0;
    padding-block: var(--sb-space-20);
    padding-inline: var(--sb-space-20);
    text-align: left;
    width: 100%;
  }

  .sb-product-main__selector-list-item:hover,
  .sb-product-main__selector-list-item:focus-visible {
    box-shadow: inset 0 0 0 2px var(--sb-color-neutral-800);
  }

  .sb-product-main__selector-list-item.is-selected {
    box-shadow: inset 0 0 0 2px var(--sb-color-primary-500);
  }

  .sb-product-main__selector-list-item-title {
    color: var(--sb-color-neutral-900);
    margin: 0;
  }

  .sb-product-main__selector-list-item-price-row {
    align-items: center;
    display: inline-flex;
    flex-wrap: wrap;
    gap: var(--sb-space-8);
  }

  .sb-product-main__variant-pill {
    -webkit-appearance: none;
    appearance: none;
    align-items: center;
    background: transparent;
    border: 1px solid var(--sb-color-neutral-900);
    border-radius: 999px;
    color: var(--sb-color-neutral-900);
    cursor: pointer;
    display: inline-flex;
    justify-content: center;
    line-height: 1;
    min-height: var(--sb-space-48);
    min-width: var(--sb-space-48);
    padding: 0 var(--sb-space-16);
    text-align: center;
    white-space: nowrap;
  }

  .sb-product-main__variant-pill:hover,
  .sb-product-main__variant-pill:focus-visible {
    background: var(--sb-color-neutral-900);
    color: var(--sb-color-neutral-100);
  }

  .sb-product-main__variant-pill.is-active {
    background: var(--sb-color-neutral-900);
    color: var(--sb-color-neutral-100);
  }

  .sb-product-main__variant-explainer {
    background: var(--sb-color-neutral-200);
    border-radius: 24px;
    color: var(--sb-color-neutral-900);
    margin: 0;
    padding: var(--sb-space-20);
    width: 100%;
  }

  .sb-product-main__color-picker-groups {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-36);
    width: 100%;
  }

  .sb-product-main__color-group {
    align-items: flex-start;
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-20);
    width: 100%;
  }

  .sb-product-main__color-swatches {
    align-items: center;
    display: flex;
    flex-wrap: wrap;
    gap: var(--sb-space-12);
    width: 100%;
  }

  .sb-product-main__color-swatch {
    align-items: center;
    background: transparent;
    border: 0;
    border-radius: 999px;
    box-shadow: inset 0 0 0 2px transparent;
    cursor: pointer;
    display: inline-flex;
    height: var(--sb-space-48);
    justify-content: center;
    padding: 6px;
    width: var(--sb-space-48);
  }

  .sb-product-main__color-swatch:hover,
  .sb-product-main__color-swatch:focus-visible {
    box-shadow: inset 0 0 0 2px var(--sb-color-neutral-800);
  }

  .sb-product-main__color-swatch.is-selected {
    box-shadow: inset 0 0 0 2px var(--sb-color-primary-500);
  }

  .sb-product-main__color-swatch.is-hidden {
    display: none !important;
  }

  .sb-product-main__color-swatch-fill {
    background: var(--sb-swatch-color);
    border-radius: 999px;
    box-shadow: 0 0 8px 0 var(--sb-color-always-white-50) inset;
    display: block;
    height: 100%;
    width: 100%;
  }

  .sb-product-main__form {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-36);
    width: 100%;
  }

  .sb-product-main__price-row {
    align-items: center;
    display: flex;
    flex-wrap: wrap;
    gap: var(--sb-space-12);
    width: 100%;
  }

  .sb-product-main__price-values {
    align-items: center;
    display: inline-flex;
    flex-wrap: wrap;
    gap: var(--sb-space-8);
  }

  .sb-product-main__price {
    margin: 0;
  }

  .sb-product-main__price--compare {
    color: var(--sb-color-neutral-800);
    text-decoration: line-through;
  }

  .sb-product-main__price--current {
    color: var(--sb-color-blue-500);
  }

  .sb-product-main__savings-badge {
    background: var(--sb-color-blue-500);
    border-radius: 4px;
    color: var(--sb-color-always-white);
    display: inline-flex;
    padding: 8px 6px;
    white-space: nowrap;
  }

  .sb-product-main__select {
    background: var(--sb-color-always-white);
    border: 0;
    border-radius: 999px;
    color: var(--sb-color-neutral-900);
    min-height: var(--sb-space-48);
    padding-inline: var(--sb-space-16);
    width: 100%;
  }

  .sb-product-main__add-button {
    align-items: center;
    cursor: pointer;
    display: inline-flex;
    gap: var(--sb-space-8);
    justify-content: center;
    text-align: center;
    width: 100%;
  }

  .sb-product-main__checkout-buttons {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-24);
    width: 100%;
  }

  .sb-product-main__shop-pay-button {
    width: 100%;
  }

  .sb-product-main__shop-pay-button.sb-button-radiant--trailing-icon {
    gap: var(--sb-space-4) !important;
  }

  .sb-product-main__shop-pay-button .sb-button-radiant__icon {
    flex: 0 0 auto;
    height: var(--sb-space-16);
    padding-top: 2px;
    width: auto;
  }

  .sb-product-main__shop-pay-button .sb-button-radiant__icon svg {
    height: var(--sb-space-16);
    width: auto;
    max-width: none;
  }

  .sb-product-main__purchase-guarantees {
    background: var(--sb-color-neutral-200);
    border-radius: 24px;
    padding: var(--sb-space-20);
    width: 100%;
  }

  .sb-product-main__purchase-guarantees-list {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-16);
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .sb-product-main__purchase-guarantee-item {
    align-items: center;
    display: flex;
    gap: var(--sb-space-12);
  }

  .sb-product-main__purchase-guarantee-icon {
    align-items: center;
    display: inline-flex;
    flex: 0 0 auto;
    height: var(--sb-space-24);
    justify-content: center;
    -webkit-user-select: none;
    user-select: none;
    width: var(--sb-space-24);
  }

  .sb-product-main__purchase-guarantee-icon :is(img, svg) {
    color: var(--sb-color-neutral-900);
    display: block;
    height: 100%;
    -webkit-user-select: none;
    user-select: none;
    width: 100%;
  }

  .sb-product-main__purchase-guarantee-icon svg path:not([fill='none']),
  .sb-product-main__purchase-guarantee-icon svg circle:not([fill='none']),
  .sb-product-main__purchase-guarantee-icon svg rect:not([fill='none']) {
    fill: currentColor;
  }

  .sb-product-main__purchase-guarantee-text {
    color: var(--sb-color-neutral-900);
    display: inline;
    margin: 0;
  }

  .sb-product-main__purchase-guarantee-item--shop-pay {
    align-items: flex-start;
  }

  .sb-product-main__purchase-guarantee-shop-pay {
    align-items: center;
    display: inline-flex;
    height: var(--sb-space-16);
    vertical-align: baseline;
    width: auto;
  }

  .sb-product-main__purchase-guarantee-shop-pay svg {
    display: block;
    height: var(--sb-space-16);
    width: auto;
    max-width: none;
  }

  .sb-product-main__delivery-explainer {
    background: var(--sb-color-neutral-200);
    border-radius: 24px;
    color: var(--sb-color-neutral-900);
    font-family: var(--font-body--family) !important;
    font-size: var(--font-size-body) !important;
    font-style: normal;
    font-weight: 400;
    line-height: 1.35 !important;
    padding: var(--sb-space-24);
    width: 100%;
  }

  .sb-product-main__delivery-explainer :is(p, div, span, li, strong, em, a) {
    color: inherit;
    font-family: var(--font-body--family) !important;
    font-size: var(--font-size-body) !important;
    font-style: normal;
    line-height: 1.35 !important;
  }

  .sb-product-main__delivery-explainer-title,
  .sb-product-main__delivery-explainer-subtitle {
    margin: 0;
  }

  .sb-product-main__delivery-explainer-title + .sb-product-main__delivery-explainer-body {
    margin-top: var(--sb-space-12);
  }

  .sb-product-main__delivery-explainer-body :is(p, ul, ol) {
    margin: 0;
  }

  .sb-product-main__delivery-explainer-body :is(p, ul, ol) + :is(p, ul, ol) {
    margin-top: var(--sb-space-24);
  }

  .sb-product-main__delivery-explainer > * {
    margin: 0;
  }

  .sb-product-main__delivery-explainer > * + * {
    margin-top: var(--sb-space-16);
  }

  .sb-product-main__delivery-explainer .hProgressBarW > * {
    margin: 0;
  }

  .sb-product-main__delivery-explainer .hProgressBar {
    background: var(--sb-color-neutral-600);
    border-radius: 999px;
    height: 10px;
    overflow: hidden;
    width: 100%;
  }

  .sb-product-main__delivery-explainer .hProgressBar .progress {
    background: var(--sb-color-red-500);
    border-radius: 999px 0 0 999px;
    height: 100%;
  }

  .sb-product-main__delivery-explainer .hProgressBarW > p {
    color: var(--sb-color-red-500);
    font-weight: 400;
    margin-top: var(--sb-space-16);
  }

  .sb-product-main__video-stories {
    width: 100%;
  }

  .sb-product-main__video-stories-list {
    --sb-video-story-count: 4;
    align-items: center;
    display: flex;
    gap: var(--sb-space-16);
    justify-content: space-between;
    width: 100%;
  }

  .sb-product-main__video-stories-list[data-video-story-count='1'] {
    --sb-video-story-count: 1;
    justify-content: flex-start;
  }

  .sb-product-main__video-stories-list[data-video-story-count='2'] {
    --sb-video-story-count: 2;
  }

  .sb-product-main__video-stories-list[data-video-story-count='3'] {
    --sb-video-story-count: 3;
  }

  .sb-product-main__video-stories-list[data-video-story-count='4'] {
    --sb-video-story-count: 4;
  }

  .sb-product-main__video-story {
    -webkit-appearance: none;
    appearance: none;
    background: transparent;
    border: 0;
    border-radius: 999px;
    box-shadow: inset 0 0 0 3px var(--sb-color-primary-500);
    cursor: pointer;
    flex: 1 1
      max(
        0px,
        calc(
          (100% - ((var(--sb-video-story-count) - 1) * var(--sb-space-16))) / var(--sb-video-story-count)
        )
      );
    margin: 0;
    max-width: var(--sb-space-96);
    overflow: hidden;
    padding: 6px;
    width: 100%;
  }

  .sb-product-main__video-story-inner {
    border-radius: 999px;
    display: block;
    overflow: hidden;
    width: 100%;
  }

  .sb-product-main__video-story-poster {
    aspect-ratio: 1 / 1;
    display: block;
    height: auto;
    object-fit: cover;
    width: 100%;
  }

  .sb-product-main__video-story:hover .sb-product-main__video-story-poster,
  .sb-product-main__video-story:focus-visible .sb-product-main__video-story-poster {
    opacity: 0.75;
  }

  .sb-product-main__video-story-modal {
    inset: 0;
    position: fixed;
    z-index: 60;
  }

  .sb-product-main__video-story-modal[hidden] {
    display: none;
  }

  .sb-product-main__video-story-modal-backdrop {
    background: var(--sb-color-always-black-50);
    border: 0;
    inset: 0;
    margin: 0;
    padding: 0;
    position: absolute;
    width: 100%;
  }

  .sb-product-main__video-story-modal-panel {
    background: var(--sb-color-neutral-900);
    border-radius: 24px;
    inset: 50% auto auto 50%;
    max-width: min(90vw, var(--sb-space-640));
    overflow: hidden;
    position: absolute;
    transform: translate(-50%, -50%);
    width: 100%;
  }

  .sb-product-main__video-story-player {
    display: block;
    height: auto;
    max-height: 80vh;
    width: 100%;
  }

  .sb-product-main__video-story-modal-close {
    align-items: center;
    background: var(--sb-color-always-black-50);
    border: 0;
    border-radius: 999px;
    color: var(--sb-color-always-white);
    cursor: pointer;
    display: inline-flex;
    font-size: var(--font-size-body);
    height: var(--sb-space-32);
    justify-content: center;
    position: absolute;
    right: var(--sb-space-12);
    top: var(--sb-space-12);
    width: var(--sb-space-32);
    z-index: 2;
  }

  .sb-product-main__in-the-box {
    width: 100%;
  }

  .sb-product-main__in-the-box-title {
    color: var(--sb-color-neutral-900);
    font-family: var(--font-display--family);
    margin: 0;
  }

  .sb-product-main__in-the-box-grid {
    display: grid;
    column-gap: var(--sb-space-20);
    grid-template-columns: repeat(3, minmax(0, 1fr));
    margin-top: var(--sb-space-20);
    row-gap: var(--sb-space-20);
    width: 100%;
  }

  .sb-product-main__in-the-box-item {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-12);
    min-width: 0;
    width: 100%;
  }

  .sb-product-main__in-the-box-image {
    aspect-ratio: 1 / 1;
    border-radius: 12px;
    box-shadow: 0 0 10px 0 var(--sb-color-always-black-12);
    display: block;
    height: auto;
    object-fit: cover;
    width: 100%;
  }

  .sb-product-main__in-the-box-text {
    color: var(--sb-color-neutral-900);
    margin: 0;
    width: 100%;
  }

  .sb-product-main__in-the-box-divider {
    border: 0;
    border-top: 1px solid var(--sb-color-neutral-600);
    height: 0;
    margin-top: var(--sb-space-20);
    width: 100%;
  }

  .sb-product-main__description-accordion-item {
    margin-top: calc(var(--sb-space-20) - var(--sb-space-36));
    width: 100%;
  }

  .sb-product-main__description-accordion-trigger {
    align-items: center;
    background: transparent;
    border: 0;
    color: var(--sb-color-neutral-900);
    cursor: pointer;
    display: flex;
    gap: var(--sb-space-16);
    justify-content: space-between;
    padding: 0;
    text-align: left;
    width: 100%;
  }

  .sb-product-main__description-accordion-title {
    color: var(--sb-color-neutral-900);
    font-family: var(--font-display--family);
    margin: 0;
  }

  .sb-product-main__description-accordion-icon {
    color: var(--sb-color-primary-500);
    display: inline-flex;
    flex: 0 0 auto;
    height: var(--sb-space-20);
    line-height: 0;
    position: relative;
    width: var(--sb-space-20);
  }

  .sb-product-main__description-accordion-icon svg {
    display: block;
    height: var(--sb-space-20);
    width: var(--sb-space-20);
  }

  .sb-product-main__description-accordion-icon svg path:not([fill='none']),
  .sb-product-main__description-accordion-icon svg circle:not([fill='none']),
  .sb-product-main__description-accordion-icon svg rect:not([fill='none']) {
    fill: currentColor !important;
  }

  .sb-product-main__description-accordion-icon svg path:not([stroke='none']),
  .sb-product-main__description-accordion-icon svg circle:not([stroke='none']),
  .sb-product-main__description-accordion-icon svg rect:not([stroke='none']) {
    stroke: currentColor !important;
  }

  .sb-product-main__description-accordion-icon-plus,
  .sb-product-main__description-accordion-icon-close {
    display: inline-flex;
    inset: 0;
    position: absolute;
    transition:
      opacity 220ms ease,
      transform 260ms cubic-bezier(0.22, 1, 0.36, 1);
  }

  .sb-product-main__description-accordion-answer {
    color: var(--sb-color-neutral-900);
    display: none;
    margin-top: var(--sb-space-20);
  }

  .sb-product-main__description-accordion-answer > * {
    margin: 0;
  }

  .sb-product-main__description-accordion-answer > * + * {
    margin-top: var(--sb-space-20);
  }

  .sb-product-main__description-accordion-icon-plus {
    opacity: 1;
    transform: rotate(0deg) scale(1);
  }

  .sb-product-main__description-accordion-icon-close {
    opacity: 0;
    transform: rotate(-90deg) scale(0.85);
  }

  .sb-product-main__description-accordion-item.is-open .sb-product-main__description-accordion-answer {
    display: block;
  }

  .sb-product-main__description-accordion-item.is-open .sb-product-main__description-accordion-icon-plus {
    opacity: 0;
    transform: rotate(90deg) scale(0.85);
  }

  .sb-product-main__description-accordion-item.is-open .sb-product-main__description-accordion-icon-close {
    opacity: 1;
    transform: rotate(0deg) scale(1);
  }

  .sb-product-main__description-accordion-divider {
    border: 0;
    border-top: 1px solid var(--sb-color-neutral-600);
    display: block;
    height: 0;
    margin: var(--sb-space-20) 0 0;
    width: 100%;
  }

  .sb-product-main__popular-addins {
    margin-top: calc(var(--sb-space-20) - var(--sb-space-36));
    width: 100%;
  }

  .sb-product-main__popular-addins-title {
    color: var(--sb-color-neutral-900);
    font-family: var(--font-display--family);
    margin: 0;
  }

  .sb-product-main__popular-addins-list {
    display: flex;
    flex-direction: column;
    gap: var(--sb-space-20);
    margin-top: var(--sb-space-20);
    width: 100%;
  }

  .sb-product-main__addon-item {
    align-items: center;
    background: var(--sb-color-neutral-200);
    border-radius: 24px;
    display: flex;
    gap: var(--sb-space-16);
    padding: var(--sb-space-20);
    width: 100%;
  }

  .sb-product-main__addon-image-link {
    align-self: center;
    display: block;
    flex: 0 0 var(--sb-space-128);
    height: var(--sb-space-128);
    overflow: hidden;
    text-decoration: none;
    width: var(--sb-space-128);
  }

  .sb-product-main__addon-image {
    border-radius: 12px;
    display: block;
    height: var(--sb-space-128);
    object-fit: cover;
    object-position: center;
    width: var(--sb-space-128);
  }

  .sb-product-main__addon-image--placeholder {
    background: var(--sb-color-neutral-100);
  }

  .sb-product-main__addon-details {
    display: flex;
    flex: 1 1 auto;
    flex-direction: column;
    gap: var(--sb-space-16);
    min-width: 0;
  }

  .sb-product-main__addon-title {
    color: var(--sb-color-neutral-900);
    margin: 0;
    text-decoration: none;
  }

  .sb-product-main__addon-title:hover,
  .sb-product-main__addon-title:focus-visible {
    color: var(--sb-color-primary-500);
  }

  .sb-product-main__addon-price-row {
    align-items: center;
    display: flex;
    flex-wrap: wrap;
    gap: var(--sb-space-6);
  }

  .sb-product-main__addon-price {
    margin: 0;
  }

  .sb-product-main__addon-price--compare {
    color: var(--sb-color-neutral-800);
    text-decoration: line-through;
  }

  .sb-product-main__addon-price--current {
    color: var(--sb-color-blue-500);
  }

  .sb-product-main__addon-option-pills {
    display: flex;
    flex-wrap: wrap;
    gap: var(--sb-space-12);
  }

  .sb-product-main__addon-option-pill {
    align-items: center;
    background: transparent;
    border: 1px solid var(--sb-color-neutral-900);
    border-radius: 999px;
    color: var(--sb-color-neutral-900);
    cursor: pointer;
    display: inline-flex;
    height: var(--sb-space-36);
    justify-content: center;
    min-height: var(--sb-space-36);
    min-width: var(--sb-space-36);
    padding-inline: var(--sb-space-12);
    white-space: nowrap;
  }

  .sb-product-main__addon-option-pill:hover,
  .sb-product-main__addon-option-pill:focus-visible {
    background: var(--sb-color-neutral-900);
    color: var(--sb-color-neutral-100);
  }

  .sb-product-main__addon-option-pill.is-active {
    background: var(--sb-color-neutral-900);
    color: var(--sb-color-neutral-100);
  }

  .sb-product-main__addon-color-swatches {
    align-items: center;
    display: flex;
    flex-wrap: wrap;
    gap: var(--sb-space-12);
  }

  .sb-product-main__addon-color-swatch {
    align-items: center;
    background: transparent;
    border: 0;
    border-radius: 999px;
    cursor: pointer;
    display: inline-flex;
    flex: 0 0 auto;
    height: var(--sb-space-36);
    justify-content: center;
    padding: 4px;
    width: var(--sb-space-36);
  }

  .sb-product-main__addon-color-swatch-fill {
    background: var(--sb-swatch-color, var(--sb-color-neutral-600));
    border-radius: 999px;
    box-shadow: 0 0 8px 0 var(--sb-color-always-white-50) inset;
    display: block;
    height: 100%;
    width: 100%;
  }

  .sb-product-main__addon-color-swatch:hover,
  .sb-product-main__addon-color-swatch:focus-visible {
    box-shadow: inset 0 0 0 2px var(--sb-color-neutral-800);
  }

  .sb-product-main__addon-color-swatch.is-selected {
    box-shadow: inset 0 0 0 2px var(--sb-color-primary-500);
  }

  .sb-product-main__addon-color-swatch.is-hidden {
    display: none;
  }

  .sb-product-main__addon-actions {
    align-items: center;
    display: flex;
    flex-wrap: wrap;
    gap: var(--sb-space-12);
  }

  .sb-product-main__addon-add-button {
    cursor: pointer;
  }

  .sb-product-main__addon-add-button-icon img {
    display: block;
    filter: brightness(0) invert(1);
    height: var(--sb-space-16);
    -webkit-user-drag: none;
    -webkit-user-select: none;
    user-select: none;
    width: var(--sb-space-16);
  }

  .sb-product-main__addon-add-button-icon::selection,
  .sb-product-main__addon-add-button-icon img::selection {
    background: transparent;
  }

  .sb-product-main__addon-add-button-icon::-moz-selection,
  .sb-product-main__addon-add-button-icon img::-moz-selection {
    background: transparent;
  }

  .sb-product-main__addon-add-button.is-added .sb-button-radiant__label {
    color: var(--sb-color-always-white);
  }

  .sb-product-main__addon-view-button:hover,
  .sb-product-main__addon-view-button:focus-visible {
    background: var(--sb-color-neutral-900);
    color: var(--sb-color-neutral-100);
  }

  .sb-product-main__add-button-icon {
    align-items: center;
    display: inline-flex;
    height: var(--sb-space-16);
    justify-content: center;
    -webkit-user-select: none;
    user-select: none;
    width: var(--sb-space-16);
  }

  .sb-product-main__add-button-icon :is(svg, img) {
    display: block;
    height: 100%;
    -webkit-user-select: none;
    user-select: none;
    width: 100%;
  }

  .sb-product-main__add-button-icon svg path {
    fill: var(--sb-color-always-white);
  }

  .sb-product-main__add-button-icon-image {
    filter: brightness(0) invert(1);
    object-fit: contain;
  }

  .sb-product-main__add-button-label {
    display: inline-block;
  }

  .sb-product-main__add-button:disabled {
    cursor: not-allowed;
    opacity: 0.5;
  }

  .sb-product-main__dynamic-checkout {
    display: none !important;
    width: 100%;
  }

  .sb-product-main__dynamic-checkout :where(.shopify-payment-button, .shopify-payment-button__button) {
    width: 100%;
  }

  @media (min-width: 750px) {
    .sb-product-main__layout {
      align-items: start;
      display: flex;
      flex-wrap: nowrap;
      gap: var(--sb-space-64);
    }

    .sb-product-main__media-column {
      flex: 1 1 720px;
      max-width: 720px;
      width: 100%;
    }

    .sb-product-main__info-column {
      flex: 1 1 456px;
      max-width: 456px;
      min-width: 320px;
      width: auto;
    }
  }

  @media (max-width: 749px) {
    .sb-product-main__media-column {
      margin-inline: calc(var(--page-margin) * -1);
      width: calc(100% + (var(--page-margin) * 2));
    }

    .sb-product-main__media-grid {
      display: flex;
      gap: var(--sb-space-20);
      -ms-overflow-style: none;
      overflow-x: auto;
      overflow-y: hidden;
      padding-inline: var(--page-margin);
      scroll-behavior: auto;
      scroll-snap-type: none;
      scrollbar-width: none;
      -webkit-overflow-scrolling: touch;
    }

    .sb-product-main__media-grid::-webkit-scrollbar {
      display: none;
    }

    .sb-product-main__media-item {
      aspect-ratio: auto;
      flex: 0 0 var(--sb-product-gallery-mobile-size);
      height: var(--sb-product-gallery-mobile-size);
      width: var(--sb-product-gallery-mobile-size);
    }
  }

  @media (min-width: 750px) {
    .sb-product-main__media-grid { overflow: visible; }
  }
{% endstylesheet %}

<script>
  (() => {
    const ThemeEvents = {
      variantSelected: 'variant:selected',
      variantUpdate: 'variant:update',
    };
    const initializedRoots = new WeakSet();
    let isVideoStoryEscapeBound = false;

    const initProductRoot = (root) => {
      if (!root || initializedRoots.has(root)) return;
      initializedRoots.add(root);

      const variantSelect = root.querySelector('[data-product-variant-id]');
      const variantsJsonElement = root.querySelector('[data-product-variants-json]');
      const variantMediaElement = root.querySelector('[data-product-variant-media-json]');
      const variantInTheBoxElement = root.querySelector('[data-product-variant-in-the-box-json]');
      const mediaGrid = root.querySelector('[data-product-media-grid]');
      const inTheBoxContainer = root.querySelector('[data-in-the-box]');
      const inTheBoxGrid = root.querySelector('[data-in-the-box-grid]');
      const inTheBoxDivider = root.querySelector('[data-in-the-box-divider]');
      const productDescriptionTrigger = root.querySelector('[data-product-description-trigger]');
      const productDescriptionItem = root.querySelector('[data-product-description-item]');
      const optionGroups = Array.from(root.querySelectorAll('[data-option-position]'));
      const selectorListItems = Array.from(root.querySelectorAll('[data-selector-list-item]'));
      const videoStoryTriggers = Array.from(root.querySelectorAll('[data-video-story-trigger]'));
      const videoStoryModal = root.querySelector('[data-video-story-modal]');
      const videoStoryPlayer = root.querySelector('[data-video-story-player]');
      const videoStoryCloseButtons = Array.from(root.querySelectorAll('[data-video-story-close]'));
      const selectorListOptionPosition = Number.parseInt(root.dataset.selectorListOptionPosition || '', 10);
      const selectorListOptionIndex =
        Number.isFinite(selectorListOptionPosition) && selectorListOptionPosition > 0
          ? selectorListOptionPosition - 1
          : -1;
      if (!variantSelect || !variantsJsonElement) return;

      let variants = [];
      try {
        variants = JSON.parse(variantsJsonElement.textContent || '[]');
      } catch (error) {
        return;
      }
      if (!Array.isArray(variants) || !variants.length) return;

      let variantMediaMap = null;
      if (variantMediaElement) {
        try {
          variantMediaMap = JSON.parse(variantMediaElement.textContent || '{}');
        } catch (error) {
          variantMediaMap = null;
        }
      }

      let variantInTheBoxMap = null;
      if (variantInTheBoxElement) {
        try {
          variantInTheBoxMap = JSON.parse(variantInTheBoxElement.textContent || '{}');
        } catch (error) {
          variantInTheBoxMap = null;
        }
      }

      const addButton = root.querySelector('.sb-product-main__add-button');
      const addButtonLabel = addButton ? addButton.querySelector('[data-add-button-label]') : null;
      const stickyBarWrap = root.querySelector('.sb-product-main__sticky-bar-wrap');
      const stickyBar = root.querySelector('[data-sticky-buy-bar]');
      const stickyInfo = root.querySelector('.sb-product-main__sticky-info');
      const stickyImage = root.querySelector('[data-sticky-image]');
      const stickyComparePriceElement = root.querySelector('[data-sticky-compare-price]');
      const stickyCurrentPriceElement = root.querySelector('[data-sticky-current-price]');
      const stickyAddButton = root.querySelector('[data-sticky-add-button]');
      const stickyAddButtonLabel = stickyAddButton ? stickyAddButton.querySelector('[data-sticky-add-button-label]') : null;
      const stickyReviewCountElement = root.querySelector('[data-sticky-review-count]');
      const stickySegmentedControls = root.querySelector('[data-sticky-segmented-controls]');
      const stickySegmentIndicator = stickySegmentedControls
        ? stickySegmentedControls.querySelector('.sb-product-main__sticky-segment-indicator')
        : null;
      const stickySegmentButtons = Array.from(root.querySelectorAll('[data-sticky-segment-option]'));
      const headerElement = document.querySelector('.header');
      const priceRow = root.querySelector('[data-product-price-row]');
      const comparePriceElement = root.querySelector('[data-product-compare-price]');
      const currentPriceElement = root.querySelector('[data-product-current-price]');
      const savingsBadgeElement = root.querySelector('[data-product-savings-badge]');
      const monthlyPriceElement = root.querySelector('[data-product-monthly-price]');
      const shopPayButton = root.querySelector('[data-shop-pay-button]');
      const dynamicCheckoutButton = root.querySelector('.shopify-payment-button__button');
      const productTitle = root.dataset.productTitle || '';
      const productId = root.dataset.productId || '';
      const selectedById = variants.find((variant) => `${variant.id}` === `${variantSelect.value}`);
      let selectedOptions = Array.isArray(selectedById?.options) ? [...selectedById.options] : [];
      if (!selectedOptions.length && Array.isArray(variants[0]?.options)) {
        selectedOptions = [...variants[0].options];
      }
      let currentVariantId = selectedById ? `${selectedById.id}` : `${variantSelect.value}`;
      let hasVariantInitialized = false;

      if (shopPayButton) {
        if (!dynamicCheckoutButton) {
          shopPayButton.hidden = true;
        } else {
          shopPayButton.addEventListener('click', () => {
            dynamicCheckoutButton.click();
          });
        }
      }

      if (stickyAddButton && addButton) {
        stickyAddButton.addEventListener('click', () => {
          if (addButton.disabled) return;
          addButton.click();
        });
      }

      if (productDescriptionTrigger && productDescriptionItem) {
        productDescriptionTrigger.addEventListener('click', () => {
          const isOpening = !productDescriptionItem.classList.contains('is-open');
          productDescriptionItem.classList.toggle('is-open', isOpening);
          productDescriptionTrigger.setAttribute('aria-expanded', isOpening ? 'true' : 'false');
        });
      }

      const escapeHtml = (value) =>
        String(value)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');

      const currencyCode = priceRow?.dataset.currency || 'USD';
      const moneyFormatter = new Intl.NumberFormat(undefined, {
        style: 'currency',
        currency: currencyCode,
      });
      const monthlyMoneyFormatter = new Intl.NumberFormat(undefined, {
        style: 'currency',
        currency: currencyCode,
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
      });
      const reviewCountFormatter = new Intl.NumberFormat(undefined, {
        maximumFractionDigits: 0,
      });
      const initialPriceSample = (
        stickyCurrentPriceElement?.textContent ||
        currentPriceElement?.textContent ||
        ''
      ).trim();
      const shouldAppendCurrencyCode = new RegExp(`\\b${currencyCode}\\b`, 'i').test(initialPriceSample);

      const syncStickyReviewCount = () => {
        if (!stickyReviewCountElement) return;
        const rawCount = Number.parseFloat(stickyReviewCountElement.dataset.stickyReviewCountValue || '0') || 0;
        stickyReviewCountElement.textContent = `${reviewCountFormatter.format(Math.round(rawCount))} reviews`;
      };

      const syncVariantUrl = (variantId) => {
        if (!variantId) return;
        const url = new URL(window.location.href);
        url.searchParams.set('variant', `${variantId}`);
        if (url.toString() !== window.location.href) {
          window.history.replaceState({}, '', url.toString());
        }
      };

      const normalizeSegment = (value) => (value === 'buy-now' ? 'buy-now' : 'learn-more');
      const segmentScrollMemory = {
        'learn-more': window.scrollY || window.pageYOffset || 0,
        'buy-now': null,
      };

      const clampScrollTop = (value) => {
        const nextValue = Number.isFinite(value) ? value : 0;
        const maxScroll = Math.max(
          0,
          (document.scrollingElement?.scrollHeight || document.documentElement.scrollHeight || 0) - window.innerHeight
        );
        return Math.min(Math.max(nextValue, 0), maxScroll);
      };

      const captureSegmentScroll = (segmentValue = root.dataset.pageSegment || 'learn-more') => {
        const activeSegment = normalizeSegment(segmentValue);
        segmentScrollMemory[activeSegment] = window.scrollY || window.pageYOffset || 0;
      };

      const captureHeaderNavState = () => {
        if (window.SBHeaderNav && typeof window.SBHeaderNav.captureState === 'function') {
          return window.SBHeaderNav.captureState();
        }
        if (!headerElement) return null;
        return {
          transform: headerElement.style.transform || '',
        };
      };

      const restoreHeaderNavState = (state) => {
        if (!state) return;
        if (
          window.SBHeaderNav &&
          typeof window.SBHeaderNav.restoreState === 'function' &&
          Object.prototype.hasOwnProperty.call(state, 'hiddenOffset')
        ) {
          window.SBHeaderNav.restoreState(state);
          return;
        }
        if (!headerElement || typeof state.transform !== 'string') return;
        headerElement.style.transform = state.transform;
      };

      const syncStickySegmentIndicator = (segmentValue, { immediate = false } = {}) => {
        if (!stickySegmentedControls || !stickySegmentIndicator || !stickySegmentButtons.length) return;
        const activeSegment = normalizeSegment(segmentValue);
        const activeButton = stickySegmentButtons.find(
          (button) => button.dataset.stickySegmentOption === activeSegment
        ) || stickySegmentButtons[0];
        if (!activeButton) return;

        const containerRect = stickySegmentedControls.getBoundingClientRect();
        const buttonRect = activeButton.getBoundingClientRect();
        const nextLeft = buttonRect.left - containerRect.left;
        const nextTop = buttonRect.top - containerRect.top;
        const nextWidth = buttonRect.width;
        const nextHeight = buttonRect.height;

        if (immediate) {
          const currentTransition = stickySegmentIndicator.style.transition;
          stickySegmentIndicator.style.transition = 'none';
          stickySegmentIndicator.style.left = `${nextLeft}px`;
          stickySegmentIndicator.style.top = `${nextTop}px`;
          stickySegmentIndicator.style.width = `${nextWidth}px`;
          stickySegmentIndicator.style.height = `${nextHeight}px`;
          stickySegmentIndicator.offsetHeight;
          stickySegmentIndicator.style.transition = currentTransition;
          return;
        }

        stickySegmentIndicator.style.left = `${nextLeft}px`;
        stickySegmentIndicator.style.top = `${nextTop}px`;
        stickySegmentIndicator.style.width = `${nextWidth}px`;
        stickySegmentIndicator.style.height = `${nextHeight}px`;
      };

      const isVisibleStickyChild = (element) =>
        element instanceof HTMLElement && !element.hidden && element.getClientRects().length > 0;

      const measureStickyInfoContentWidth = () => {
        if (!stickyInfo) return 0;
        const visibleChildren = Array.from(stickyInfo.children).filter(isVisibleStickyChild);
        if (!visibleChildren.length) return 0;
        const stickyInfoStyles = window.getComputedStyle(stickyInfo);
        const gap = Number.parseFloat(stickyInfoStyles.columnGap || stickyInfoStyles.gap || '0') || 0;

        let totalWidth = 0;
        visibleChildren.forEach((child) => {
          totalWidth += child.getBoundingClientRect().width || 0;
        });
        totalWidth += gap * Math.max(0, visibleChildren.length - 1);
        return totalWidth;
      };

      const syncStickySegmentWidth = () => {
        if (!stickyBar || !stickySegmentedControls || !stickyInfo || !stickyAddButton) return;

        if (window.matchMedia('(max-width: 989px)').matches) {
          stickyBar.style.removeProperty('--sb-sticky-segment-max-width');
          return;
        }

        const rootStyles = window.getComputedStyle(document.documentElement);
        const minSideGap = Number.parseFloat(rootStyles.getPropertyValue('--sb-space-36')) || 36;
        const maxSegmentWidth = 500;
        const barWidth = stickyBar.getBoundingClientRect().width || 0;
        if (!barWidth) return;

        const leftContentWidth = measureStickyInfoContentWidth();
        const rightContentWidth = stickyAddButton.getBoundingClientRect().width || 0;
        const dominantSideWidth = Math.max(leftContentWidth, rightContentWidth);
        const availableWidth = barWidth - (dominantSideWidth * 2) - (minSideGap * 2);
        const nextSegmentWidth = Math.max(0, Math.min(maxSegmentWidth, Math.floor(availableWidth)));
        stickyBar.style.setProperty('--sb-sticky-segment-max-width', `${nextSegmentWidth}px`);
      };

      const getSegmentManagedSections = (productSection) => {
        const mainContent = document.querySelector('#MainContent');
        const mainSections = Array.from(
          (mainContent || document).querySelectorAll('.shopify-section[id*="template--"]')
        );
        if (productSection && mainSections.includes(productSection)) return mainSections;
        return Array.from(document.querySelectorAll('.shopify-section[id*="template--"]'));
      };

      const applyPageSegmentVisibility = (segmentValue) => {
        const activeSegment = normalizeSegment(segmentValue);
        const productSection = root.closest('.shopify-section[id*="template--"]');
        root.classList.toggle('is-segment-learn-more', activeSegment === 'learn-more');
        document.querySelectorAll('.shopify-section.sb-segment-hidden').forEach((section) => {
          section.classList.remove('sb-segment-hidden');
          section.removeAttribute('aria-hidden');
        });
        if (!productSection) return;

        const orderedSections = getSegmentManagedSections(productSection);
        const productSectionIndex = orderedSections.indexOf(productSection);
        if (productSectionIndex < 0) return;

        orderedSections.forEach((section, index) => {
          if (section === productSection) return;

          const shouldHide = activeSegment === 'buy-now'
            ? index < productSectionIndex
            : index > productSectionIndex;

          section.classList.toggle('sb-segment-hidden', shouldHide);
          if (shouldHide) {
            section.setAttribute('aria-hidden', 'true');
          } else {
            section.removeAttribute('aria-hidden');
          }
        });
      };

      const applyStickySegment = (
        segmentValue,
        {
          syncUrl = false,
          immediateIndicator = false,
          restoreScroll = false,
        } = {}
      ) => {
        const activeSegment = normalizeSegment(segmentValue);
        const previousSegment = normalizeSegment(root.dataset.pageSegment || 'learn-more');
        const segmentChanged = previousSegment !== activeSegment;
        if (previousSegment !== activeSegment) {
          captureSegmentScroll(previousSegment);
        }
        root.dataset.pageSegment = activeSegment;
        document.documentElement.setAttribute('data-sb-page-segment', activeSegment);

        stickySegmentButtons.forEach((button) => {
          const isActive = button.dataset.stickySegmentOption === activeSegment;
          button.classList.toggle('is-active', isActive);
          button.classList.toggle('weight-semibold', isActive);
          button.classList.toggle('weight-medium', !isActive);
          button.setAttribute('aria-pressed', isActive ? 'true' : 'false');
        });
        syncStickySegmentIndicator(activeSegment, { immediate: immediateIndicator });

        try {
          applyPageSegmentVisibility(activeSegment);
        } catch (error) {
          // Keep segmented controls usable even if section visibility fails.
        }
        try {
          syncStickyBarMetrics({ immediateIndicator });
          syncStickyBarTop();
        } catch (error) {
          // Keep segmented controls usable even if sticky metrics fail.
        }

        if (restoreScroll && segmentChanged) {
          const previousHeaderState = captureHeaderNavState();
          const savedScroll = segmentScrollMemory[activeSegment];
          const nextScrollTop = clampScrollTop(Number.isFinite(savedScroll) ? savedScroll : 0);
          window.requestAnimationFrame(() => {
            window.requestAnimationFrame(() => {
              window.scrollTo({
                top: nextScrollTop,
                behavior: 'auto',
              });
              syncStickyBarTop();
              captureSegmentScroll(activeSegment);
              window.requestAnimationFrame(() => {
                restoreHeaderNavState(previousHeaderState);
                try {
                  syncStickyBarTop();
                } catch (error) {
                  // Keep segment switching usable even if sticky top sync fails.
                }
              });
            });
          });
        } else {
          captureSegmentScroll(activeSegment);
        }

        if (!syncUrl) return;
        const url = new URL(window.location.href);
        if (activeSegment === 'buy-now') {
          url.searchParams.set('p', 'buy-now');
        } else {
          url.searchParams.delete('p');
        }
        window.history.replaceState({}, '', url.toString());
      };

      syncStickyReviewCount();
      if (stickySegmentedControls && stickySegmentButtons.length) {
        const segmentFromUrl = normalizeSegment(new URL(window.location.href).searchParams.get('p') || '');
        applyStickySegment(segmentFromUrl, { immediateIndicator: true });

        let segmentRefreshFrame = 0;
        const refreshSegmentVisibility = () => {
          if (segmentRefreshFrame) return;
          segmentRefreshFrame = window.requestAnimationFrame(() => {
            segmentRefreshFrame = 0;
            const activeSegment = normalizeSegment(root.dataset.pageSegment || segmentFromUrl);
            applyPageSegmentVisibility(activeSegment);
            syncStickyBarMetrics({ immediateIndicator: true });
            syncStickyBarTop();
          });
        };

        const segmentObserverRoot = document.querySelector('#MainContent') || document.body;
        if (segmentObserverRoot) {
          const segmentMutationObserver = new MutationObserver((mutations) => {
            const hasTemplateSectionInsertion = mutations.some((mutation) =>
              Array.from(mutation.addedNodes).some(
                (node) =>
                  node instanceof HTMLElement &&
                  (
                    (node.classList.contains('shopify-section') && node.id.includes('template--')) ||
                    Boolean(node.querySelector('.shopify-section[id*="template--"]'))
                  )
              )
            );
            if (hasTemplateSectionInsertion) {
              refreshSegmentVisibility();
            }
          });
          segmentMutationObserver.observe(segmentObserverRoot, {
            childList: true,
            subtree: true,
          });
        }
        refreshSegmentVisibility();

        stickySegmentButtons.forEach((button) => {
          button.addEventListener('click', () => {
            applyStickySegment(button.dataset.stickySegmentOption || 'learn-more', {
              syncUrl: true,
              restoreScroll: true,
            });
          });
        });

        window.addEventListener('popstate', () => {
          const nextSegment = normalizeSegment(new URL(window.location.href).searchParams.get('p') || '');
          applyStickySegment(nextSegment, { restoreScroll: true });
        });
      }

      const dispatchVariantSelectedEvent = (variant, sourceId = 'product-main') => {
        if (!variant?.id) return;
        root.dispatchEvent(
          new CustomEvent(ThemeEvents.variantSelected, {
            bubbles: true,
            detail: {
              resource: { id: `${variant.id}` },
              sourceId,
            },
          })
        );
      };

      const dispatchVariantUpdateEvent = (variant, sourceId = 'product-main') => {
        if (!variant?.id) return;
        root.dispatchEvent(
          new CustomEvent(ThemeEvents.variantUpdate, {
            bubbles: true,
            detail: {
              resource: variant,
              sourceId,
              data: {
                productId,
              },
            },
          })
        );
      };

      const closeVideoStoryModal = () => {
        if (!videoStoryModal || !videoStoryPlayer) return;
        videoStoryPlayer.pause();
        videoStoryPlayer.removeAttribute('src');
        videoStoryPlayer.load();
        videoStoryModal.hidden = true;
        document.body.classList.remove('sb-video-story-modal-open');
      };

      if (videoStoryModal && videoStoryPlayer && videoStoryTriggers.length) {
        if (videoStoryModal.parentElement !== document.body) {
          document.body.appendChild(videoStoryModal);
        }

        videoStoryTriggers.forEach((trigger) => {
          trigger.addEventListener('click', () => {
            const videoUrl = trigger.dataset.videoStoryUrl || '';
            if (!videoUrl) return;
            videoStoryPlayer.src = videoUrl;
            videoStoryModal.hidden = false;
            document.body.classList.add('sb-video-story-modal-open');
            const playPromise = videoStoryPlayer.play();
            if (playPromise && typeof playPromise.catch === 'function') {
              playPromise.catch(() => {});
            }
          });
        });

        videoStoryCloseButtons.forEach((button) => {
          button.addEventListener('click', closeVideoStoryModal);
        });

        if (!isVideoStoryEscapeBound) {
          document.addEventListener('keydown', (event) => {
            if (event.key !== 'Escape') return;
            const openModal = document.querySelector('[data-video-story-modal]:not([hidden])');
            if (!openModal) return;
            const closeButton = openModal.querySelector('[data-video-story-close]');
            if (closeButton instanceof HTMLElement) {
              closeButton.click();
            }
          });
          isVideoStoryEscapeBound = true;
        }
      }

      const formatMoney = (centsValue) => {
        const amount = Number(centsValue) || 0;
        const formatted = moneyFormatter.format(amount / 100);
        if (!shouldAppendCurrencyCode) return formatted;
        return `${formatted} ${currencyCode}`;
      };

      const getStickyImageFromVariant = (variant) => {
        if (!variant) return '';

        const featuredImageSource = variant?.featured_image?.src || variant?.featured_image?.url || '';
        if (featuredImageSource) return featuredImageSource;

        const tokens = variantMediaMap?.[`${variant.id}`];
        if (!Array.isArray(tokens)) return '';

        for (const token of tokens) {
          if (typeof token !== 'string') continue;
          const parts = token.split('::');
          const type = parts[0] || '';
          const source = parts[1] || '';
          const poster = parts[2] || '';
          if (type === 'image' && source) return source;
          if (type === 'video' && poster) return poster;
        }
        return '';
      };

      const applyStickyImage = (variant) => {
        if (!stickyImage) return;
        const nextSource = getStickyImageFromVariant(variant);
        if (!nextSource) return;
        if (stickyImage.tagName === 'IMG') {
          if (stickyImage.src !== nextSource) stickyImage.src = nextSource;
          return;
        }
        stickyImage.style.backgroundImage = `url("${nextSource}")`;
        stickyImage.style.backgroundPosition = 'center';
        stickyImage.style.backgroundSize = 'cover';
      };

      function syncStickyBarTop() {
        if (!stickyBarWrap || !headerElement) return;
        const space16Value = window.getComputedStyle(document.documentElement).getPropertyValue('--sb-space-16');
        const spacing = Number.parseFloat(space16Value) || 16;
        const headerBottom = headerElement.getBoundingClientRect().bottom;
        const nextTop = Math.max(headerBottom + spacing, spacing);
        stickyBarWrap.style.top = `${nextTop}px`;
      }

      const getFirstVisibleTemplateSection = () => {
        const templateSections = Array.from(document.querySelectorAll('.shopify-section[id*="template--"]'));
        return templateSections.find((section) => {
          if (!(section instanceof HTMLElement)) return false;
          if (section.offsetHeight <= 0) return false;
          return Array.from(section.children).some((child) => {
            if (!(child instanceof HTMLElement)) return false;
            const tag = child.tagName;
            return tag !== 'SCRIPT' && tag !== 'STYLE';
          });
        }) || null;
      };

      function syncStickyBarMetrics({ immediateIndicator = true } = {}) {
        if (!stickyBarWrap) return;
        const stickyHeight = stickyBarWrap.getBoundingClientRect().height || 0;
        const space16Value = window.getComputedStyle(document.documentElement).getPropertyValue('--sb-space-16');
        const space96Value = window.getComputedStyle(document.documentElement).getPropertyValue('--sb-space-96');
        const stickyTopGap = Number.parseFloat(space16Value) || 16;
        const headingOffset = Number.parseFloat(space96Value) || 96;
        const firstSectionOffset = stickyHeight + stickyTopGap;
        const pageStickyOffset = firstSectionOffset + headingOffset;
        root.style.setProperty('--sb-product-sticky-bar-height', `${stickyHeight}px`);
        root.style.setProperty('--sb-product-sticky-offset', `${firstSectionOffset}px`);
        document.documentElement.style.setProperty('--sb-page-sticky-offset', `${pageStickyOffset}px`);
        syncStickySegmentWidth();
        syncStickySegmentIndicator(root.dataset.pageSegment || 'learn-more', { immediate: immediateIndicator });

        const templateSections = Array.from(document.querySelectorAll('.shopify-section[id*="template--"]'));
        const firstTemplateSection = getFirstVisibleTemplateSection();
        templateSections.forEach((section) => {
          if (firstTemplateSection && section === firstTemplateSection) {
            section.style.paddingTop = `${firstSectionOffset}px`;
          } else if (section.style.paddingTop) {
            section.style.paddingTop = '';
          }
        });
        if (!firstTemplateSection) return;
      }

      const getReviewsScrollOffset = (targetAbsoluteTop) => {
        const currentScrollTop = window.scrollY || window.pageYOffset || 0;
        const isScrollingDown = targetAbsoluteTop > currentScrollTop;
        const space96Value = window.getComputedStyle(document.documentElement).getPropertyValue('--sb-space-96');
        const space16Value = window.getComputedStyle(document.documentElement).getPropertyValue('--sb-space-16');
        const stickyTopGap = Number.parseFloat(space16Value) || 16;
        const headingGap = Number.parseFloat(space96Value) || 96;
        const stickyHeight = stickyBarWrap?.getBoundingClientRect().height || 0;
        const expandedHeaderTop = headerElement
          ? Math.max((headerElement.getBoundingClientRect().height || 0) + stickyTopGap, stickyTopGap)
          : stickyTopGap;
        const stickyTop = isScrollingDown ? stickyTopGap : expandedHeaderTop;
        return stickyTop + stickyHeight + headingGap;
      };

      const scrollToReviewsHeading = ({ ensureBuyNow = false } = {}) => {
        if (ensureBuyNow && normalizeSegment(root.dataset.pageSegment || 'learn-more') !== 'buy-now') {
          applyStickySegment('buy-now', { syncUrl: true });
        }

        const performScroll = () => {
          const target = document.querySelector('.sb-reviews-heading');
          if (!target) return;
          const hiddenWrapper = target.closest('.shopify-section.sb-segment-hidden');
          if (hiddenWrapper) return;

          syncStickyBarTop();
          syncStickyBarMetrics();
          const targetAbsoluteTop = target.getBoundingClientRect().top + window.scrollY;
          const targetTop = targetAbsoluteTop - getReviewsScrollOffset(targetAbsoluteTop);

          window.scrollTo({
            top: Math.max(targetTop, 0),
            behavior: 'smooth',
          });
        };

        if (ensureBuyNow) {
          window.requestAnimationFrame(() => {
            window.requestAnimationFrame(performScroll);
          });
          return;
        }

        performScroll();
      };

      root.querySelectorAll('[data-sticky-reviews-link]').forEach((link) => {
        link.addEventListener('click', (event) => {
          event.preventDefault();
          event.stopPropagation();
          scrollToReviewsHeading({ ensureBuyNow: true });
        });
      });

      root.addEventListener(
        'click',
        (event) => {
          const ratingTrigger = event.target.closest('.sb-product-main__rating .kl_reviews__star_rating_widget');
          if (!ratingTrigger) return;
          event.preventDefault();
          event.stopPropagation();
          scrollToReviewsHeading({ ensureBuyNow: true });
        },
        true
      );

      syncStickyBarMetrics({ immediateIndicator: true });
      syncStickyBarTop();
      window.setTimeout(() => syncStickyBarMetrics({ immediateIndicator: true }), 80);
      window.setTimeout(() => syncStickyBarMetrics({ immediateIndicator: true }), 300);
      window.setTimeout(syncStickyBarTop, 300);

      window.addEventListener(
        'scroll',
        () => {
          captureSegmentScroll();
          syncStickyBarTop();
        },
        { passive: true }
      );
      window.addEventListener('resize', () => {
        syncStickyBarMetrics({ immediateIndicator: true });
        syncStickyBarTop();
      });

      const mainContent = document.querySelector('#MainContent');
      if (mainContent) {
        const sectionObserver = new MutationObserver(() => {
          syncStickyBarMetrics({ immediateIndicator: true });
          syncStickyBarTop();
        });
        sectionObserver.observe(mainContent, {
          childList: true,
          subtree: false,
        });
      }

      const initGalleryVideos = () => {
        if (!mediaGrid) return;
        const videos = Array.from(mediaGrid.querySelectorAll('video.sb-product-main__media-asset--video'));
        if (!videos.length) return;

        videos.forEach((video) => {
          const mediaItem = video.closest('.sb-product-main__media-item--video');
          if (!mediaItem) return;
          if (video.dataset.galleryVideoInit === 'true') return;
          video.dataset.galleryVideoInit = 'true';
          mediaItem.classList.remove('is-video-ready');

          const markReady = () => {
            mediaItem.classList.add('is-video-ready');
          };

          video.addEventListener('playing', markReady, { once: true });
          video.addEventListener('timeupdate', markReady, { once: true });
          video.addEventListener('error', markReady, { once: true });

          if (video.readyState >= 2 && !video.paused) {
            markReady();
          }

          const playPromise = video.play();
          if (playPromise && typeof playPromise.catch === 'function') {
            playPromise.catch(() => {});
          }
        });
      };

      const renderMediaGallery = (tokens) => {
        if (!mediaGrid || !Array.isArray(tokens)) return;
        const normalizedTokens = tokens
          .map((token) => (typeof token === 'string' ? token.trim() : ''))
          .filter(Boolean);
        if (!normalizedTokens.length) return;

        const nextMarkup = normalizedTokens
          .map((token) => {
            const parts = token.split('::');
            const type = parts[0] || '';
            const source = parts[1] || '';
            const poster = parts[2] || '';
            if (!source) return '';

            if (type === 'video') {
              const posterMarkup = poster
                ? `<img class=\"sb-product-main__media-video-poster\" data-gallery-video-poster src=\"${escapeHtml(poster)}\" alt=\"${escapeHtml(productTitle)}\" loading=\"lazy\" width=\"720\" height=\"720\">`
                : '';
              const posterAttribute = poster ? ` poster=\"${escapeHtml(poster)}\"` : '';
              return `<div class=\"sb-product-main__media-item sb-product-main__media-item--video\" data-sb-reveal-item>${posterMarkup}<video class=\"sb-product-main__media-asset sb-product-main__media-asset--video\" data-gallery-video style=\"background: var(--sb-color-neutral-200);\" autoplay loop muted playsinline preload=\"metadata\"${posterAttribute} src=\"${escapeHtml(source)}\"></video></div>`;
            }

            return `<div class=\"sb-product-main__media-item\" data-sb-reveal-item><img class=\"sb-product-main__media-asset\" src=\"${escapeHtml(source)}\" alt=\"${escapeHtml(productTitle)}\" loading=\"lazy\" width=\"720\" height=\"720\"></div>`;
          })
          .join('');

        if (nextMarkup) {
          mediaGrid.innerHTML = nextMarkup;
          initGalleryVideos();
        }
      };

      const renderVariantMediaById = (variantId) => {
        if (!variantMediaMap || !variantId) return;
        const tokens = variantMediaMap[`${variantId}`];
        if (tokens) {
          renderMediaGallery(tokens);
        }
      };

      const renderInTheBoxByVariantId = (variantId) => {
        if (!inTheBoxContainer || !inTheBoxGrid || !variantInTheBoxMap || !variantId) return;
        const items = Array.isArray(variantInTheBoxMap[`${variantId}`]) ? variantInTheBoxMap[`${variantId}`] : [];
        if (!items.length) {
          inTheBoxContainer.hidden = true;
          return;
        }

        const nextMarkup = items
          .map((item) => {
            const title = typeof item?.title === 'string' ? item.title : '';
            const mediaUrl = typeof item?.mediaUrl === 'string' ? item.mediaUrl : '';
            if (!title) return '';
            if (mediaUrl) {
              return `<article class="sb-product-main__in-the-box-item"><img class="sb-product-main__in-the-box-image" src="${escapeHtml(mediaUrl)}" alt="${escapeHtml(title)}" loading="lazy" width="160" height="160"><p class="sb-product-main__in-the-box-text font-caption weight-regular">${escapeHtml(title)}</p></article>`;
            }
            return `<article class="sb-product-main__in-the-box-item"><div class="sb-product-main__in-the-box-image" aria-hidden="true"></div><p class="sb-product-main__in-the-box-text font-caption weight-regular">${escapeHtml(title)}</p></article>`;
          })
          .join('');

        if (!nextMarkup) {
          inTheBoxContainer.hidden = true;
          return;
        }

        inTheBoxGrid.innerHTML = nextMarkup;
        if (inTheBoxDivider) inTheBoxDivider.hidden = false;
        inTheBoxContainer.hidden = false;
      };

      const formatAddonPrice = (centsValue) => {
        const amount = Number(centsValue) || 0;
        return moneyFormatter.format(amount / 100);
      };

      const initAddonItem = (item) => {
        if (!item) return;

        const variantsElement = item.querySelector('[data-addon-variants-json]');
        const mediaMapElement = item.querySelector('[data-addon-media-map-json]');
        const hoverMapElement = item.querySelector('[data-addon-hover-map-json]');
        const addButtonElement = item.querySelector('[data-addon-add-to-cart]');
        const addButtonLabelElement = item.querySelector('[data-addon-add-label]');
        const imageElement = item.querySelector('[data-addon-image]');
        const imageLinkElement = item.querySelector('.sb-product-main__addon-image-link');
        const productLinkElements = Array.from(item.querySelectorAll('[data-addon-product-link]'));
        const comparePriceElement = item.querySelector('[data-addon-compare-price]');
        const currentPriceElement = item.querySelector('[data-addon-current-price]');
        const optionGroups = Array.from(item.querySelectorAll('[data-addon-option-position]'));
        if (!variantsElement || !addButtonElement) return;

        let addonVariants = [];
        try {
          addonVariants = JSON.parse(variantsElement.textContent || '[]');
        } catch (error) {
          return;
        }
        if (!Array.isArray(addonVariants) || !addonVariants.length) return;

        let addonMediaMap = {};
        if (mediaMapElement) {
          try {
            addonMediaMap = JSON.parse(mediaMapElement.textContent || '{}') || {};
          } catch (error) {
            addonMediaMap = {};
          }
        }
        let addonHoverMap = {};
        if (hoverMapElement) {
          try {
            addonHoverMap = JSON.parse(hoverMapElement.textContent || '{}') || {};
          } catch (error) {
            addonHoverMap = {};
          }
        }

        const selectedFromMarkup = addonVariants.find(
          (variant) => `${variant.id}` === `${addButtonElement.dataset.addonVariantId || ''}`
        );
        const selectedVariant = selectedFromMarkup || addonVariants[0];
        let selectedOptions = Array.isArray(selectedVariant?.options) ? [...selectedVariant.options] : [];
        let isAddonImageHovering = false;
        let previewBaseImageUrl = '';
        let currentBaseImageUrl = '';
        let currentHoverImageUrl = '';
        const addonImagePromiseCache = new Map();
        let addonImageSwapToken = 0;
        let addonImagePoolWarmed = false;

        const ensureAddonImageReady = (source) => {
          const normalizedSource = `${source || ''}`.trim();
          if (!normalizedSource) return Promise.resolve();
          if (addonImagePromiseCache.has(normalizedSource)) return addonImagePromiseCache.get(normalizedSource);

          const promise = new Promise((resolve) => {
            const image = new Image();
            const done = () => resolve();
            image.decoding = 'async';
            image.onload = done;
            image.onerror = done;
            image.src = normalizedSource;
            if (image.complete) resolve();
          });

          addonImagePromiseCache.set(normalizedSource, promise);
          return promise;
        };

        const preloadAddonImage = (source) => {
          void ensureAddonImageReady(source);
        };

        const warmAddonImagePool = () => {
          if (addonImagePoolWarmed) return;
          addonImagePoolWarmed = true;
          Object.values(addonMediaMap || {}).forEach((source) => preloadAddonImage(source));
          Object.values(addonHoverMap || {}).forEach((source) => preloadAddonImage(source));
        };

        const buildAddonVariantUrl = (variantId) => {
          const baseUrl = item.dataset.addonProductUrl || '';
          if (!baseUrl || !variantId) return baseUrl;
          return `${baseUrl}${baseUrl.includes('?') ? '&' : '?'}variant=${variantId}`;
        };

        const applyAddonLinks = (variantId) => {
          const nextUrl = buildAddonVariantUrl(variantId);
          if (!nextUrl || !productLinkElements.length) return;
          productLinkElements.forEach((link) => {
            link.href = nextUrl;
          });
        };

        const applyAddonImageState = () => {
          if (!imageElement || imageElement.tagName !== 'IMG') return;
          const baseImageSource = previewBaseImageUrl || currentBaseImageUrl;
          const nextSource = isAddonImageHovering && currentHoverImageUrl ? currentHoverImageUrl : baseImageSource;
          if (!nextSource || imageElement.src === nextSource) return;

          const swapToken = `${++addonImageSwapToken}`;
          ensureAddonImageReady(nextSource).then(() => {
            if (`${addonImageSwapToken}` !== swapToken) return;
            if (imageElement.src !== nextSource) {
              imageElement.src = nextSource;
            }
          });
        };

        const getGroupOptionIndex = (group) => {
          const optionPosition = Number.parseInt(group.dataset.addonOptionPosition || '', 10);
          if (!Number.isFinite(optionPosition) || optionPosition < 1) return -1;
          return optionPosition - 1;
        };

        const setGroupSelection = (group, selectedValue) => {
          const isColorGroup = group.dataset.addonOptionType === 'color';
          group.querySelectorAll('[data-addon-option-value]').forEach((button) => {
            const isSelected = button.dataset.addonOptionValue === selectedValue;
            button.classList.toggle('is-active', !isColorGroup && isSelected);
            button.classList.toggle('is-selected', isColorGroup && isSelected);
            button.setAttribute('aria-pressed', isSelected ? 'true' : 'false');
          });
        };

        const colorGroups = optionGroups.filter((group) => group.dataset.addonOptionType === 'color');
        const nonColorGroups = optionGroups.filter((group) => group.dataset.addonOptionType !== 'color');
        const optionCount = Array.isArray(addonVariants[0]?.options) ? addonVariants[0].options.length : 0;

        const updateColorAvailability = () => {
          colorGroups.forEach((colorGroup) => {
            const colorIndex = getGroupOptionIndex(colorGroup);
            if (colorIndex < 0) return;

            const nonColorSelections = [];
            for (let optionIndex = 0; optionIndex < optionCount; optionIndex += 1) {
              if (optionIndex === colorIndex) continue;
              const selectedValue = selectedOptions[optionIndex];
              if (!selectedValue) continue;
              nonColorSelections.push({ index: optionIndex, value: selectedValue });
            }

            const buttons = Array.from(colorGroup.querySelectorAll('[data-addon-option-value]'));
            let firstVisibleColorValue = '';

            buttons.forEach((button) => {
              const colorValue = button.dataset.addonOptionValue || '';
              const hasMatchingVariant = addonVariants.some((variant) => {
                if (!Array.isArray(variant.options)) return false;
                if (variant.options[colorIndex] !== colorValue) return false;
                if (!variant.available) return false;
                return nonColorSelections.every(
                  ({ index, value }) => !value || variant.options[index] === value
                );
              });

              button.hidden = !hasMatchingVariant;
              button.classList.toggle('is-hidden', !hasMatchingVariant);
              button.setAttribute('aria-hidden', hasMatchingVariant ? 'false' : 'true');

              if (hasMatchingVariant && !firstVisibleColorValue) {
                firstVisibleColorValue = colorValue;
              }
            });

            const selectedColorValue = selectedOptions[colorIndex] || '';
            const selectedVisible = buttons.some(
              (button) => !button.hidden && button.dataset.addonOptionValue === selectedColorValue
            );
            if (!selectedVisible) {
              selectedOptions[colorIndex] = firstVisibleColorValue || '';
            }
            setGroupSelection(colorGroup, selectedOptions[colorIndex] || '');
          });
        };

        const applyAddonVariant = (variant) => {
          if (!variant) return;
          addButtonElement.dataset.addonVariantId = `${variant.id}`;
          addButtonElement.disabled = !variant.available;
          addButtonElement.setAttribute('aria-label', variant.available ? 'Add' : 'Sold out');
          if (addButtonLabelElement) {
            addButtonLabelElement.textContent = variant.available ? 'Add' : 'Sold out';
          }

          const hasComparePrice = Number(variant.compare_at_price) > Number(variant.price);
          if (comparePriceElement) {
            if (hasComparePrice) {
              comparePriceElement.textContent = formatAddonPrice(variant.compare_at_price);
              comparePriceElement.hidden = false;
            } else {
              comparePriceElement.hidden = true;
            }
          }
          if (currentPriceElement) {
            currentPriceElement.textContent = formatAddonPrice(variant.price);
          }

          const nextImageUrl = addonMediaMap?.[`${variant.id}`] || '';
          if (nextImageUrl) {
            currentBaseImageUrl = nextImageUrl;
          } else if (imageElement && imageElement.tagName === 'IMG') {
            currentBaseImageUrl = imageElement.currentSrc || imageElement.src || '';
          }
          previewBaseImageUrl = '';
          currentHoverImageUrl = addonHoverMap?.[`${variant.id}`] || '';
          preloadAddonImage(currentBaseImageUrl);
          preloadAddonImage(currentHoverImageUrl);
          applyAddonImageState();
          applyAddonLinks(variant.id);

          if (Array.isArray(variant.options)) {
            selectedOptions = [...variant.options];
            optionGroups.forEach((group) => {
              const optionIndex = getGroupOptionIndex(group);
              if (optionIndex < 0) return;
              setGroupSelection(group, selectedOptions[optionIndex] || '');
            });
            updateColorAvailability();
          }
        };

        const findAddonVariantByOptions = (optionsSnapshot, { allowNonColorFallback = false } = {}) => {
          if (!Array.isArray(optionsSnapshot) || !optionsSnapshot.length) return null;

          const exactMatch = addonVariants.find((variant) => {
            if (!Array.isArray(variant.options) || variant.options.length !== optionsSnapshot.length) return false;
            return variant.options.every((optionValue, index) => optionValue === optionsSnapshot[index]);
          });
          if (exactMatch) return exactMatch;

          if (!allowNonColorFallback) return null;

          return addonVariants.find((variant) => {
            if (!Array.isArray(variant.options) || !variant.available) return false;
            return nonColorGroups.every((nonColorGroup) => {
              const nonColorIndex = getGroupOptionIndex(nonColorGroup);
              if (nonColorIndex < 0) return true;
              return variant.options[nonColorIndex] === optionsSnapshot[nonColorIndex];
            });
          });
        };

        optionGroups.forEach((group) => {
          const optionIndex = getGroupOptionIndex(group);
          if (optionIndex < 0) return;
          const buttons = Array.from(group.querySelectorAll('[data-addon-option-value]'));
          if (!buttons.length) return;

          const defaultValue = selectedOptions[optionIndex] || buttons[0].dataset.addonOptionValue || '';
          selectedOptions[optionIndex] = defaultValue;
          setGroupSelection(group, defaultValue);

            buttons.forEach((button) => {
              button.addEventListener('click', () => {
                if (button.hidden) return;
                warmAddonImagePool();

              const nextValue = button.dataset.addonOptionValue || '';
              selectedOptions[optionIndex] = nextValue;
              setGroupSelection(group, nextValue);

              if (group.dataset.addonOptionType !== 'color') {
                updateColorAvailability();
              }

              const matchedVariant = findAddonVariantByOptions(selectedOptions, {
                allowNonColorFallback: group.dataset.addonOptionType !== 'color',
              });

              if (matchedVariant) {
                applyAddonVariant(matchedVariant);
              }
              });

              button.addEventListener('mouseenter', () => {
                if (button.hidden) return;
                warmAddonImagePool();
                const hoveredValue = button.dataset.addonOptionValue || '';
                if (!hoveredValue) return;
                const previewOptions = [...selectedOptions];
                previewOptions[optionIndex] = hoveredValue;
                const previewVariant = findAddonVariantByOptions(previewOptions, {
                  allowNonColorFallback: group.dataset.addonOptionType !== 'color',
                });
                const previewUrl = previewVariant ? addonMediaMap?.[`${previewVariant.id}`] : '';
                previewBaseImageUrl = previewUrl || '';
                applyAddonImageState();
              });

              button.addEventListener('mouseleave', () => {
                previewBaseImageUrl = '';
                applyAddonImageState();
              });
            });
          });

        addButtonElement.addEventListener('click', async () => {
          const variantId = Number(addButtonElement.dataset.addonVariantId || '0');
          if (!variantId || addButtonElement.disabled) return;

          addButtonElement.disabled = true;
          if (addButtonLabelElement) addButtonLabelElement.textContent = 'Added';

          try {
            if (window.SBCart && typeof window.SBCart.add === 'function') {
              await window.SBCart.add(variantId, {
                sourceId: `pdp-addon-${variantId}`,
                sourceData: {
                  source: 'product-popular-addins',
                },
              });
            } else {
              throw new Error('SBCart unavailable');
            }
          } catch (error) {
            if (addButtonLabelElement) addButtonLabelElement.textContent = 'Add';
            addButtonElement.disabled = false;
            return;
          }

          window.setTimeout(() => {
            addButtonElement.disabled = false;
            if (addButtonLabelElement) addButtonLabelElement.textContent = 'Add';
          }, 1200);
        });

        if (imageLinkElement) {
          imageLinkElement.addEventListener('mouseenter', () => {
            warmAddonImagePool();
            isAddonImageHovering = true;
            applyAddonImageState();
          });
          imageLinkElement.addEventListener('focusin', () => {
            warmAddonImagePool();
          });
          imageLinkElement.addEventListener('mouseleave', () => {
            isAddonImageHovering = false;
            applyAddonImageState();
          });
        }

        applyAddonVariant(selectedVariant);
      };

      const setSelectorListSelection = (selectedItem) => {
        if (!selectorListItems.length) return;
        selectorListItems.forEach((item) => {
          const isSelected = item === selectedItem;
          item.classList.toggle('is-selected', isSelected);
          item.setAttribute('aria-pressed', isSelected ? 'true' : 'false');
        });
      };

      const setSelectorListSelectionByOptionValue = (selectedValue) => {
        if (!selectorListItems.length) return;
        selectorListItems.forEach((item) => {
          const isSelected = item.dataset.selectorOptionValue === selectedValue;
          item.classList.toggle('is-selected', isSelected);
          item.setAttribute('aria-pressed', isSelected ? 'true' : 'false');
        });
      };

      const applyPurchaseState = (purchaseData) => {
        if (!purchaseData) return;
        const hasComparePrice = Number(purchaseData.compare_at_price) > Number(purchaseData.price);
        if (currentPriceElement) {
          currentPriceElement.textContent = formatMoney(purchaseData.price);
        }
        if (comparePriceElement) {
          if (hasComparePrice) {
            comparePriceElement.textContent = formatMoney(purchaseData.compare_at_price);
            comparePriceElement.hidden = false;
          } else {
            comparePriceElement.hidden = true;
          }
        }
        if (savingsBadgeElement) {
          if (hasComparePrice) {
            const compareAt = Number(purchaseData.compare_at_price) || 0;
            const savingsPercent = compareAt > 0
              ? Math.round(((compareAt - Number(purchaseData.price || 0)) / compareAt) * 100)
              : 0;
            savingsBadgeElement.textContent = `Save ${savingsPercent}%`;
            savingsBadgeElement.hidden = false;
          } else {
            savingsBadgeElement.hidden = true;
          }
        }
        if (monthlyPriceElement) {
          monthlyPriceElement.textContent = monthlyMoneyFormatter.format(((Number(purchaseData.price) || 0) / 100) / 4);
        }

        if (addButton) {
          addButton.disabled = !purchaseData.available;
          const nextLabel = purchaseData.available ? 'Add to cart' : 'Sold out';
          if (addButtonLabel) addButtonLabel.textContent = nextLabel;
          addButton.setAttribute('aria-label', nextLabel);
        }

        if (stickyCurrentPriceElement) {
          stickyCurrentPriceElement.textContent = formatMoney(purchaseData.price);
        }
        if (stickyComparePriceElement) {
          if (hasComparePrice) {
            stickyComparePriceElement.textContent = formatMoney(purchaseData.compare_at_price);
            stickyComparePriceElement.hidden = false;
          } else {
            stickyComparePriceElement.hidden = true;
          }
        }
        if (stickyAddButton) {
          stickyAddButton.disabled = !purchaseData.available;
          const nextLabel = purchaseData.available ? 'Add to cart' : 'Sold out';
          if (stickyAddButtonLabel) stickyAddButtonLabel.textContent = nextLabel;
          stickyAddButton.setAttribute('aria-label', nextLabel);
        }

        const stickyVariant = variants.find((variant) => `${variant.id}` === `${purchaseData.id}`);
        if (stickyVariant) {
          applyStickyImage(stickyVariant);
        }
      };

      const setGroupSelection = (group, selectedValue) => {
        const isColorGroup = group.dataset.optionType === 'color';
        const colorLabel = group.querySelector('[data-color-selected-label]');
        if (isColorGroup && colorLabel) {
          colorLabel.textContent = selectedValue || '';
        }
        group.querySelectorAll('[data-option-value]').forEach((button) => {
          const isSelected = button.dataset.optionValue === selectedValue;
          if (isColorGroup) {
            button.classList.toggle('is-selected', isSelected);
          } else {
            button.classList.toggle('is-active', isSelected);
          }
          button.setAttribute('aria-pressed', isSelected ? 'true' : 'false');
        });
      };

      const getGroupOptionIndex = (group) => {
        const optionPosition = Number.parseInt(group.dataset.optionPosition || '', 10);
        if (!Number.isFinite(optionPosition) || optionPosition < 1) return -1;
        return optionPosition - 1;
      };

      const colorGroups = optionGroups.filter((group) => group.dataset.optionType === 'color');
      const nonColorGroups = optionGroups.filter((group) => group.dataset.optionType !== 'color');
      const optionCount = Array.isArray(variants[0]?.options) ? variants[0].options.length : 0;

      const updateColorAvailability = () => {
        colorGroups.forEach((colorGroup) => {
          const colorIndex = getGroupOptionIndex(colorGroup);
          if (colorIndex < 0) return;

          const nonColorSelections = [];
          for (let optionIndex = 0; optionIndex < optionCount; optionIndex += 1) {
            if (optionIndex === colorIndex) continue;
            const selectedValue = selectedOptions[optionIndex];
            if (!selectedValue) continue;
            nonColorSelections.push({ index: optionIndex, value: selectedValue });
          }

          const buttons = Array.from(colorGroup.querySelectorAll('[data-option-value]'));
          let firstVisibleColorValue = '';

          buttons.forEach((button) => {
            const colorValue = button.dataset.optionValue || '';
            const hasMatchingVariant = variants.some((variant) => {
              if (!Array.isArray(variant.options)) return false;
              if (!variant.available) return false;
              if (variant.options[colorIndex] !== colorValue) return false;
              return nonColorSelections.every(
                ({ index, value }) => !value || variant.options[index] === value
              );
            });

            button.hidden = !hasMatchingVariant;
            button.classList.toggle('is-hidden', !hasMatchingVariant);
            button.setAttribute('aria-hidden', hasMatchingVariant ? 'false' : 'true');

            if (hasMatchingVariant && !firstVisibleColorValue) {
              firstVisibleColorValue = colorValue;
            }
          });

          const selectedColorValue = selectedOptions[colorIndex] || '';
          const selectedIsVisible = buttons.some(
            (button) => !button.hidden && !button.classList.contains('is-hidden') && button.dataset.optionValue === selectedColorValue
          );

          if (!selectedIsVisible) {
            selectedOptions[colorIndex] = firstVisibleColorValue || '';
          }

          setGroupSelection(colorGroup, selectedOptions[colorIndex] || '');
        });
      };

      const handleVariantUpdate = (variant) => {
        if (!variant) return;

        applyPurchaseState(variant);

        if (Array.isArray(variant.options)) {
          selectedOptions = [...variant.options];
          optionGroups.forEach((group) => {
            const optionPosition = Number.parseInt(group.dataset.optionPosition || '', 10);
            if (!Number.isFinite(optionPosition) || optionPosition < 1) return;
            const optionValue = selectedOptions[optionPosition - 1] || '';
            setGroupSelection(group, optionValue);
          });
          updateColorAvailability();
        }

        renderVariantMediaById(variant.id);
        renderInTheBoxByVariantId(variant.id);

        if (selectorListOptionIndex >= 0 && Array.isArray(variant.options)) {
          const selectedOptionValue = variant.options[selectorListOptionIndex] || '';
          setSelectorListSelectionByOptionValue(selectedOptionValue);
        } else {
          const matchingSelectorItem = selectorListItems.find((item) => item.dataset.variantId === `${variant.id}`);
          if (matchingSelectorItem) setSelectorListSelection(matchingSelectorItem);
        }
      };

      root.addEventListener(ThemeEvents.variantUpdate, (event) => {
        const variant = event?.detail?.resource;
        if (!variant) return;
        handleVariantUpdate(variant);
      });

      const applyVariant = (variant, options = {}) => {
        if (!variant) return;
        const {
          sourceId = 'product-main',
          syncUrl = true,
        } = options;

        if (hasVariantInitialized && `${variant.id}` === `${currentVariantId}`) {
          if (syncUrl) syncVariantUrl(variant.id);
          return;
        }

        hasVariantInitialized = true;
        currentVariantId = `${variant.id}`;
        if (Array.isArray(variant.options)) {
          selectedOptions = [...variant.options];
        }
        variantSelect.value = `${variant.id}`;
        dispatchVariantSelectedEvent(variant, sourceId);
        dispatchVariantUpdateEvent(variant, sourceId);
        if (syncUrl) {
          syncVariantUrl(variant.id);
        }
      };

      variantSelect.addEventListener('change', () => {
        const matchedVariant = variants.find((variant) => `${variant.id}` === `${variantSelect.value}`);
        if (!matchedVariant) return;
        if (`${matchedVariant.id}` === `${currentVariantId}`) return;
        applyVariant(matchedVariant, {
          sourceId: 'product-form-input',
        });
      });

      optionGroups.forEach((group) => {
        const optionPosition = Number.parseInt(group.dataset.optionPosition || '', 10);
        if (!Number.isFinite(optionPosition) || optionPosition < 1) return;
        const optionIndex = optionPosition - 1;
        const buttons = Array.from(group.querySelectorAll('[data-option-value]'));
        if (!buttons.length) return;

        const defaultValue = selectedOptions[optionIndex] || buttons[0].dataset.optionValue || '';
        selectedOptions[optionIndex] = defaultValue;
        setGroupSelection(group, defaultValue);

        buttons.forEach((button) => {
          button.addEventListener('click', () => {
            if (button.hidden) return;
            const nextValue = button.dataset.optionValue || '';
            selectedOptions[optionIndex] = nextValue;
            setGroupSelection(group, nextValue);

            if (group.dataset.optionType !== 'color') {
              updateColorAvailability();
            }

            const matchedVariant = variants.find((variant) => {
              if (!Array.isArray(variant.options) || variant.options.length !== selectedOptions.length) return false;
              return variant.options.every((optionValue, index) => optionValue === selectedOptions[index]);
            });

            if (matchedVariant) {
                applyVariant(matchedVariant, {
                  sourceId: 'product-options',
                });
                return;
            }

            if (group.dataset.optionType !== 'color') {
              const fallbackVariant = variants.find((variant) => {
                if (!Array.isArray(variant.options)) return false;
                return nonColorGroups.every((nonColorGroup) => {
                  const nonColorIndex = getGroupOptionIndex(nonColorGroup);
                  if (nonColorIndex < 0) return true;
                  return variant.options[nonColorIndex] === selectedOptions[nonColorIndex];
                });
              });
              if (fallbackVariant) {
                applyVariant(fallbackVariant, {
                  sourceId: 'product-options-fallback',
                });
              }
            }
          });
        });
      });

      if (selectorListItems.length) {
        const applySelectorListItemSelection = (item, { sourceId = 'selector-list', syncUrl = true } = {}) => {
          if (!item) return;
          const variantId = item.dataset.variantId || '';
          if (!variantId) return;
          const variantMode = item.dataset.selectorListMode || '';
          setSelectorListSelection(item);

          if (variantMode === 'variant') {
            const selectedOptionValue = item.dataset.selectorOptionValue || '';
            let variant = null;

            if (selectedOptionValue && selectorListOptionIndex >= 0) {
              const nextOptions = [...selectedOptions];
              nextOptions[selectorListOptionIndex] = selectedOptionValue;
              variant = variants.find((entry) => {
                if (!Array.isArray(entry.options) || entry.options.length !== nextOptions.length) return false;
                return entry.options.every((optionValue, index) => optionValue === nextOptions[index]);
              });
              if (!variant) {
                variant = variants.find((entry) => {
                  if (!Array.isArray(entry.options)) return false;
                  return entry.options[selectorListOptionIndex] === selectedOptionValue;
                });
              }
            }

            if (!variant) {
              variant = variants.find((entry) => `${entry.id}` === variantId);
            }
            if (variant) {
              applyVariant(variant, {
                sourceId,
                syncUrl,
              });
            }
            return;
          }

          const purchaseData = {
            id: Number(variantId),
            available: item.dataset.variantAvailable === 'true',
            price: Number(item.dataset.variantPrice || '0'),
            compare_at_price: Number(item.dataset.variantComparePrice || '0'),
          };
          variantSelect.value = `${purchaseData.id}`;
          applyPurchaseState(purchaseData);
        };

        selectorListItems.forEach((item) => {
          item.addEventListener('click', () => {
            applySelectorListItemSelection(item);
          });
        });

        const selectedListItem =
          selectorListItems.find((item) => item.classList.contains('is-selected')) || selectorListItems[0];
        if (selectedListItem) {
          applySelectorListItemSelection(selectedListItem, {
            sourceId: 'selector-list-initial',
            syncUrl: false,
          });
        }
      }

      const initialVariant = variants.find((variant) => `${variant.id}` === `${currentVariantId}`) || variants[0];
      const hasMultipackSelectorList = selectorListItems.some((item) => item.dataset.selectorListMode === 'multipack');
      if (initialVariant && !hasMultipackSelectorList && !hasVariantInitialized) {
        applyVariant(initialVariant, {
          sourceId: 'initial',
          rerender: false,
          syncUrl: false,
        });
      } else {
        updateColorAvailability();
        if (variantInTheBoxMap && currentVariantId) {
          renderInTheBoxByVariantId(currentVariantId);
        }
      }

      initGalleryVideos();

      const addonItems = Array.from(root.querySelectorAll('[data-addon-item]'));
      addonItems.forEach((item) => initAddonItem(item));
    };

    const roots = document.querySelectorAll('.sb-product-main');
    if (!roots.length) return;
    roots.forEach((root) => initProductRoot(root));
  })();
</script>

{% schema %}
{
  "name": "t:general.product",
  "settings": [
    {
      "type": "select",
      "id": "add_to_cart_icon",
      "label": "Add to cart icon",
      "default": "cart",
      "options": [
        {
          "value": "cart",
          "label": "Add to cart icon"
        },
        {
          "value": "arrow",
          "label": "Arrow icon"
        }
      ]
    }
  ],
  "blocks": [
    {
      "type": "media_gallery",
      "name": "Media gallery",
      "limit": 1
    },
    {
      "type": "variant_explainer_box",
      "name": "Variant explainer box",
      "limit": 1
    },
    {
      "type": "delivery_explainer_box",
      "name": "Delivery explainer box",
      "limit": 1
    },
    {
      "type": "video_stories",
      "name": "Video stories",
      "limit": 1
    },
    {
      "type": "in_the_box",
      "name": "In the box",
      "limit": 1
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1
    },
    {
      "type": "popular_add_ons",
      "name": "Popular add-ons",
      "limit": 1
    },
    {
      "type": "@app"
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
